:date: 2017-04-20

========================
Thursday, April 20, 2017
========================

Advancing for Welfare Chatelet
==============================

Today I worked on the following subtle optimizations for cpaschatelet and
updated their production site.

DONE:

- Quand U1 crée un "prompt event" pour un bénéficiaire chez un
  assistant U2 (afin de le mettre en file d'attente), alors U2 ne
  reçoit pas de notification.

  La notification reprend maintenant le nom/prénom de la personne.

- De même quand U1 crée un rdv pour un autre utilisateur U2, alors U2
  ne reçoit pas de notification.

  --> :ticket:`1765` (Calendar entries are now ChangeObservable)

- Activer "duration_text" pour les trois tables dans l'onglet "Parcours"

- Mes RDV à confirmer n'apparait pas pour Richard E.  Non
  reproductible. J'ai enlevé la condition
  `kw.update(show_appointments=dd.YesNo.yes)` de
  :class:`MyUnconfirmedAppointments`.

- On peut maintenant dire à Lino dans Site
  parameters d'ignorer tout ce qui est avant une certaine date.
  Notamment dans "Mes rdv dépassés".

- EntriesByClient failed to show entries which had a presence of that
  client but whose client was empty.
  
- the first column of EntriesByClient is clickable, but clicking there
  showed all the entries of that day. Now it shows the detail.

- Added esf.StatisticalFields to Explorer menu.  

- Kathy (#2487) a bien été présente le 31 mars 2017 (séance d'info)
  Course id 150 calendar entry 34637, mais Lino ne l'affiche pas dans
  le champ FSE en question. Probablement parce que sa présence est à
  l'état "Quitté" au lieu de "Présent". Mais on avait déjà dit que
  "Quitté" équivaut à "Présent" pour les statistiques FSE

  Yes, `esf.GuestHoursEvent` took only Guest rows having state equal
  to "present"

- :ticket:`1226` - Permission de modifier le participant d'un atelier
  : Toujours d’actualité avec le profil 120. Pour l'instant tout le
  monde est en profil "administrateur" car ca ne va pas autrement.

  --> Enrolment.manager_roles_required = dd.login_required()

  Cela devrait être résolu. à vérifier.

Side effects:

- (:ticket:`1788`) The notification messages "{user} created {what}"
  and "{user} modified {what}" generated by [py
  lino.modlib.notify.mixins.ChangeObservable] no longer use
  `ar.get_user()` but `ar.user`.  The difference appears when you are
  acting as another user.

