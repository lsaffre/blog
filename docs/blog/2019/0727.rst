:date: 2019-07-27

=======================
Saturday, July 27, 2019
=======================

WebDAV support
==============

I pushed my work on :ticket:`3036`. Summary of the changes:


.. program:: getlino configure

I added a new option :option:`--webdav` which causes the nginx conf file to have
a webdav location.

I reviewed the docs (:ref:`webdav`, :ref:`getlino`).

The default value for :option:`--repositories-root` is now an empty string.

Running :cmd:`getlino startsite` on a server with a shared env (i.e. a
non-empty value for :option:`--shared-env`) must never update existing packages
in a shared env, but it should add new repositories. We don't want one site to
potentially break the shared environment. But automatically adding new
repositories is handy when setting up a development environment.

If you have a shared-env but an empty repositories-root, Lino
will install new repositories below the shared env (root path is built by
appending :option:`--env-link` to the shared env).

You can have an empty shared-env and a non-empty repositories-root. The new
site has its own env, but uses repositories from your work directories. Useful
on a development machine.

New option :option:`--local-prefix` which defaults to 'lino_local'. This is the
top-level package name for importable code. On a server with
:file:`/usr/local/lino/` as :option:`--projects-root`  we will have the
following layout::

    /usr/local/lino/lino_local/mysite1      # a the mysite1 project
    /usr/local/lino/lino_local/settings.py  # server-wide default settings

The projects-root will be added to the :envvar:`PYTHON_PATH` when a project
runs. The :xfile:`settings.py` of a new site says ``from lino_local.settings
import ``, and the :xfile:`manage.py` sets :settings:`DJANGO_SETTINGS_MODULE`
to ``'lino_local.mysite1.settings'``.

The "project directory" of a project "mysite1" is now
:file:`/usr/local/lino/lino_local/mysite1` (no longer
:file:`/usr/local/lino/mysite1`).

The default for :option:`--shared-env` is an empty string.


  - :option:`shared-env`      /usr/local/lino/env/

Why do we have an option :option:`--repositories-root`? Can't we simply say
that this is always built from :option:`--shared-env` by appending
:option:`--env-link`?  Because on a development machine you may have e.g.::

    projects_root = /usr/local/lino
    repositories_root = /home/luc/dell1tb/work
    shared_env = /home/luc/dell1tb/virtualenvs/py3



I merged KNOWN_LIBS and KNOWN_APPS

TODO:

- The lino_*.js files generated by nginx for the first request are not group
  writable. Which means that umask is not set correctly for the nginx service.