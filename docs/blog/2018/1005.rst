:date: 2018-10-05

=======================
Friday, October 5, 2018
=======================


In :ref:`book.specs.cal` I added a test to cover whether the help text
of the :meth:`update_guests <lino_xl.lib.cal.Event.update_guests>` action has been
installed and translated correctly:

>>> with translation.override('de'):
...     print(cal.Event.update_guests.help_text)
... #doctest: +NORMALIZE_WHITESPACE +REPORT_CDIFF -SKIP
Teilnehmerliste für diesen Kalendereintrag füllen entsprechend der Vorschläge.

The test failed saying::

    File "...docs/specs/cal.rst", line 426, in cal.rst
    Failed example:
        with translation.override('de'):
            print(cal.Event.update_guests.help_text)
        #doctest: +NORMALIZE_WHITESPACE +REPORT_CDIFF -SKIP
    Expected:
        Teilnehmerliste für diesen Kalendereintrag füllen entsprechend der Vorschläge.
    Got:
        Teilnehmerliste für diesen Kalendereintrag füllen entsprechend der Vorschläge.

And I wanted to understand why.  As a hint I had a warning being
issued by the doctest module::

   /usr/lib/python2.7/doctest.py:1556: UnicodeWarning: Unicode equal comparison failed to convert both arguments to Unicode - interpreting them as being unequal

The solution was to explicitly call :func:`str` on the translatable
text::
  
    print(str(cal.Event.update_guests.help_text))

That's needed because :attr:`help_text` is lazy (it becomes a string
only when you use it), and because doctest cannot guess this.
