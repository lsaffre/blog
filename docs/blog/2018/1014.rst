:date: 2018-10-14

========================
Sunday, October 14, 2018
========================

Undid a change in :mod:`lino.core.elems`
========================================

I undid the following change in
:class:`lino.core.elems.CharFieldElement` (which I committed
20180828)::

    -        self.preferred_width = 1 + min(20, max(3, self.field.max_length or 0))
    +        if self.preferred_width is None:  # 20180828
    +            self.preferred_width = 1 + min(
    +                20, max(3, self.field.max_length or 0))


Because that change now turned out to be the cause for :ticket:`2583`
(Wrong column widths in MySessionsByDate).  I vaguely remember that
the change was an attempt to fix the column widths in the accounting
report before I changed from appypdf to weasyprint.

Pushing code
============

Today I pushed several changes I did on :doc:`1010` :doc:`1011`.  I
didn't commit them earlier because I have chaotic working times. 

:xfile:`make_screenshots.py` failing
====================================

After removing users.rst from docs_de in welfare I had a problem
because this file was being referred to in `tours/index.rst`, the
source code for :ref:`welfare.de.tour` which is generated by
:xfile:`make_screenshots.py`.

I updated the script and then ran it, but got::       

  selenium.common.exceptions.WebDriverException: Message: connection refused

Here is the content of my :file:`geckodriver.log` file::


    1539544204768   geckodriver     INFO    Listening on 127.0.0.1:52897
    1539544205769   mozprofile::profile     INFO    Using profile path /tmp/rust_mozprofile.8bNMgCtdva0T
    1539544205771   geckodriver::marionette INFO    Starting browser /usr/bin/firefox
    1539544205774   geckodriver::marionette INFO    Connecting to Marionette on localhost:44507

    (firefox:5955): Gtk-WARNING **: 21:10:05.819: Theme parsing error: gtk-main.css:73:38: Failed to import: Error opening file /usr/share/themes/Radiance/gtk-3.20/apps/gnome-builder.css: No such file or directory

    (firefox:5955): Gtk-WARNING **: 21:10:06.410: Theme parsing error: <data>:1:34: Expected ')' in color definition

    (firefox:5955): Gtk-WARNING **: 21:10:06.410: Theme parsing error: <data>:1:77: Expected ')' in color definition

    (/usr/lib/firefox/firefox:6040): Gtk-WARNING **: 21:10:06.911: Theme parsing error: gtk-main.css:73:38: Failed to import: Error opening file /usr/share/themes/Radiance/gtk-3.20/apps/gnome-builder.css: No such file or directory
    1539544207404   Marionette      INFO    Listening on port 2828

    (/usr/lib/firefox/firefox:6117): Gtk-WARNING **: 21:10:07.988: Theme parsing error: gtk-main.css:73:38: Failed to import: Error opening file /usr/share/themes/Radiance/gtk-3.20/apps/gnome-builder.css: No such file or directory


I did `pip install -U selenium`.  No change.

Firefox version is 62.0.3.

I read `this thread
<https://stackoverflow.com/questions/39547598/selenium-common-exceptions-webdriverexception-message-connection-refused>`__

No change after installing `xvfb`.  Neither after ``export
DISPLAY=:99``.

Okay I give up once more...
