<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>20090310 &mdash; Luc&#39;s website</title>
    
    <link rel="stylesheet" href="../../_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/centeredlogo.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/taglist.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/taglist_tags.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/sidebar.js"></script>
    <link rel="search" type="application/opensearchdescription+xml"
          title="Search within Luc&#39;s website"
          href="../../_static/opensearch.xml"/>
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
    <link rel="top" title="Luc&#39;s website" href="../../index.html" />
    <link rel="up" title="2009" href="index.html" />
    <link rel="next" title="20090328" href="0328.html" />
    <link rel="prev" title="20090309" href="0309.html" />
   
<script src="../../.htmldata/lightbox/js/jquery-1.11.0.min.js"></script>
<script src="../../.htmldata/lightbox/js/lightbox.min.js"></script>
<link href="../../.htmldata/lightbox/css/lightbox.css" rel="stylesheet" />

  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="0328.html" title="20090328"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="0309.html" title="20090309"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Home</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Blog</a> &raquo;</li>
          <li class="nav-item nav-item-2"><a href="index.html" accesskey="U">2009</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="id1">
<h1>20090310<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h1>
<p>Working on <code class="xref py py-class docutils literal"><span class="pre">Report</span></code>.</p>
<p>The primary key field of a model is set to <code class="docutils literal"><span class="pre">editable</span></code>,
but it is rendered with a hidden field.</p>
<p><a class="reference external" href="http://docs.djangoproject.com/en/dev/topics/forms/modelforms/#topics-forms-modelforms">http://docs.djangoproject.com/en/dev/topics/forms/modelforms/#topics-forms-modelforms</a></p>
</div>
<div class="section" id="id2">
<h1>20090315<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h1>
<p>Mit der momentanen URL-Struktur kriege ich zwar schön einen Report
angezeigt in Listen- und Seitenansicht, mit Auf- und Abblätterei...
aber für Unter-Reports ist das eine Sackgasse. Zum Beispiel das
folgende URL zeigt eine Rechnung in Vollbild:</p>
<blockquote>
<div>/docs/invoices?flt=2009&amp;pgl=5pgn=3&amp;row=2</div></blockquote>
<p>Wenn diese Rechnung jetzt außerdem mehrere Seite an Inhalt hat, dann
muss man ja auch im Inhalt blättern können. Und auch im Inhalt einen
Filter setzen können. Also müsste ich die GET-Variablen mit einem
Präfix versehen, um URLs wie die folgende zu kriegen:</p>
<blockquote>
<div>/docs/invoices?flt=2009&amp;pgl=5pgn=3&amp;row=2&amp;items_flt=a&amp;items_pgl=5items_pgn=3&amp;items_row=2</div></blockquote>
<p>Stattdessen gibt es vielleicht eine bessere Lösung:
Report.view() behält die drei momentanen Variablen flt, pgl und pgn,
aber schon <code class="xref py py-meth docutils literal"><span class="pre">Row.links()</span></code> in <code class="xref std std-xfile docutils literal"><span class="pre">grid.html</span></code> verlässt diesen
Report, verweist direkt auf die betreffende Rechnung:</p>
<blockquote>
<div>/by_pk/igen_invoice/&lt;pk&gt;</div></blockquote>
<p>Das Blättern machen wir dann über eine Session-Variable:</p>
<div class="highlight-python"><div class="highlight"><pre>nav = []
if page.has_next()
    nav.append(html.A(
      &quot;~Next&quot;,href=again(request,row=page.number+1)))
if page.has_previous()
    nav.append(html.A(
      &quot;~Previous&quot;,href=again(request,row=page.number-1)))
...
request.session.navigation = nav
</pre></div>
</div>
<p>Also das, was die Templates momentan im <code class="docutils literal"><span class="pre">{%</span> <span class="pre">block</span> <span class="pre">navigation</span> <span class="pre">%}</span></code>
konstruieren, wird dann im Code konstruiert und in der Session
gespeichert, und die Templates machen nur noch ein generelles</p>
<blockquote>
<div><code class="docutils literal"><span class="pre">{{</span> <span class="pre">nav.as_ul()</span> <span class="pre">}}</span></code></div></blockquote>
<p>Und wenn ich jemandem den Permalink einer Rechnung schicke, z.B. <cite>/docs/invoices/7</cite>,
dann sieht der Empfänger nicht mehr, wie ich diese Rechnung gefunden habe.</p>
<p>Korrektur: Statt des oben erwähnten <code class="docutils literal"><span class="pre">request.session.navigation</span> <span class="pre">=</span> <span class="pre">nav</span></code> brauche
ich eine <code class="xref py py-class docutils literal"><span class="pre">Navigator</span></code>.</p>
<blockquote>
<div>nav = Navigator(page)
request.session[&#8216;navigator&#8217;] = nav</div></blockquote>
<p>Mal sehen, ob es klappt.</p>
<p>Och nee, das geht nicht, dadurch verliere ich das Feature, im Vollbild durch einen Report
blättern zu können. Denn wenn ich auf Vollbild schalte und dann auch Next klicke, wie soll er da
den Navigator machen, ohne das Queryset selber in der Session zu speichern?</p>
<p>Aber es geht anders: um einen Unterreport zu bearbeiten, verwendet das URL den pk der Rechnung,
also wenn der Inhalt einer Rechnung &#8220;offen&#8221; ist, dann kann man eben nicht auf die nächste
Rechnung blättern. Ist ja logisch. Und wenn man den Inhalt speichert, ruft er einfach die
Listenansicht Rechnungen wieder neu auf, mit Positionierung am Ende.</p>
<p>Eine andere Frage ist die URL-Strukur.
Bisher war es ja schön einfach: alle URLs entstehen automatisch aus dem Hauptmenü.
Aber jetzt brauche ich was Neues,
denn ich muss ja den primary key aus der URL holen, <em>ohne</em> dafür die
GET-Variablen zu benutzen.</p>
<p>Also entweder alle Models verfügbar machen:</p>
<blockquote>
<div>/_models/&lt;db_table&gt;/&lt;pk&gt;</div></blockquote>
<p>Oder aber für Reports wie InvoiceItems, die einen variablen obligatorischen Parameter
<code class="docutils literal"><span class="pre">invoice</span></code> haben (Signatur des Konstruktors analysieren, um die URL zu generieren?)</p>
<blockquote>
<div>/_reports/ItemsByInvoice/&lt;invoice_id&gt;
/_reports/InvoicesByPartner/&lt;partner_id&gt;</div></blockquote>
<p>Letzteres scheint mir richtig. Aber wie kriege ich das generiert?
Das Menü könnte die Actors abfragen, und wenn der Actor ein Report ist,
gibt er die URLs zu seinen Unter-Reports zurück.
Also ein Report müssrw sich selbst nach Methoden durchsuchen...
Hm...</p>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../index.html">
              <img class="logo" src="../../_static/logo.png" alt="Logo"/>
            </a></p>
<h3><a href="../../index.html">Table Of Contents</a></h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../index.html">Blog</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../about/index.html">About me</a></li>
</ul>

<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script><p align="center">
<a href="https://github.com/lsaffre" target="_blank">GitHub</a>
<br/><a href="http://www.lino-framework.org" target="_blank">Lino</a>
<br/><a href="http://www.saffre-rumma.net" target="_blank">Rumma & Ko</a>
</p>

        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="0328.html" title="20090328"
             >next</a> |</li>
        <li class="right" >
          <a href="0309.html" title="20090309"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Home</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Blog</a> &raquo;</li>
          <li class="nav-item nav-item-2"><a href="index.html" >2009</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">

<a rel="license" href="http://creativecommons.org/licenses/by-sa/2.5/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-sa/2.5/88x31.png" /></a>
This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-sa/2.5/">Creative Commons Attribution-ShareAlike 2.5 Generic License</a>.<br />
      Last updated on 2015-03-31.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.3.
<a href="../../_sources/blog/2009/0315.txt">Show Source</a> 
    <a href="http://luc.lino-framework.org/blog/2009/0315.html">Online Link</a>
    </div>
  </body>
</html>