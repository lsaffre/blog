<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Tuesday, April 29, 2014 &mdash; Luc&#39;s website</title>
    
    <link rel="stylesheet" href="../../_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/centeredlogo.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/taglist.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/taglist_tags.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/sidebar.js"></script>
    <link rel="search" type="application/opensearchdescription+xml"
          title="Search within Luc&#39;s website"
          href="../../_static/opensearch.xml"/>
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
    <link rel="top" title="Luc&#39;s website" href="../../index.html" />
    <link rel="up" title="2014" href="index.html" />
    <link rel="next" title="Wednesday, April 30, 2014" href="0430.html" />
    <link rel="prev" title="Monday, April 28, 2014" href="0428.html" />
   
<script src="../../.htmldata/lightbox/js/jquery-1.11.0.min.js"></script>
<script src="../../.htmldata/lightbox/js/lightbox.min.js"></script>
<link href="../../.htmldata/lightbox/css/lightbox.css" rel="stylesheet" />

  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="0430.html" title="Wednesday, April 30, 2014"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="0428.html" title="Monday, April 28, 2014"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Home</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Blog</a> &raquo;</li>
          <li class="nav-item nav-item-2"><a href="index.html" accesskey="U">2014</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="tuesday-april-29-2014">
<h1>Tuesday, April 29, 2014<a class="headerlink" href="#tuesday-april-29-2014" title="Permalink to this headline">¶</a></h1>
<div class="section" id="formatting-iban-numbers">
<h2>Formatting IBAN numbers<a class="headerlink" href="#formatting-iban-numbers" title="Permalink to this headline">¶</a></h2>
<p>Lino now renders IBAN numbers as it should:
&#8220;EE87 2200 2210 1206 7904&#8221; instead of &#8220;EE872200221012067904&#8221;.</p>
<p>The first challenge was a decision: should we store the spaces in the
database or not?  My current answer is: we don&#8217;t store the spaces, we
use a renderer to insert them dynamically.</p>
<p>This is more or less compatible to <a class="reference external" href="https://github.com/benkonrath/django-iban">django-iban</a> who currently just
accepts spaces and removes them forever (but does not render them
formatted).</p>
<p>The second challenge was how to implement this.  The <a class="reference external" href="https://github.com/lsaffre/lino/commit/3748768ed9d8b3e0f4e616d4378562cb7d787078">commit</a>
shows what I did.  I made changes in <code class="xref py py-mod docutils literal"><span class="pre">lino.modlib.iban.fields</span></code>
and <a class="reference external" href="https://github.com/lsaffre/lino/blob/master//lino/modlib/iban/config/uppercasetextfield.js">/lino/modlib/iban/config/uppercasetextfield.js</a> (those in
<code class="xref py py-mod docutils literal"><span class="pre">lino.ui.elems</span></code> are rather cosmetic).  Thanks to <a class="reference external" href="http://stackoverflow.com/questions/17260238/how-to-insert-space-every-4-characters-for-iban-registering">How to insert
space every 4 characters for IBAN registering?</a>
asked in March 2014 by <a class="reference external" href="http://stackoverflow.com/users/2354926/jackyto">Jackyto</a> and answered by
<a class="reference external" href="http://stackoverflow.com/users/82548/david-thomas">David Thomas</a></p>
<p>The current solution has some drawbacks:</p>
<ul class="simple">
<li>Works only in a grid (IBAN fields in a Detail window are not
formatted. Which is not a problem since we currently have no
occurence of this case).</li>
<li>Pressing F2 to start editing causes the formatting to disappear
(waiting for user feedback on this).</li>
<li>We will also need a renderer for plain HTML and plain text.</li>
</ul>
</div>
<div class="section" id="parameterstore-on-pcsw-clients-expects-a-list-of-12-values-but-got-16">
<h2>ParameterStore on pcsw.Clients expects a list of 12 values but got 16<a class="headerlink" href="#parameterstore-on-pcsw-clients-expects-a-list-of-12-values-but-got-16" title="Permalink to this headline">¶</a></h2>
<p>I discovered an urgent bug:</p>
<ul>
<li><p class="first">Wenn ich eine Klientenliste über ein RequestField (von
UsersWithClients aus) öffne und dort auf einem Klienten
doppelklicke, kriege ich:</p>
<div class="highlight-python"><div class="highlight"><pre>Exception
ParameterStore of LayoutHandle for ParamsLayout on pcsw.Clients expected a list of 12 values, but got [u&#39;30&#39;, u&#39;200096&#39;, u&#39;&#39;, u&#39;29.04.2014&#39;, u&#39;29.04.2014&#39;, u&#39;&#39;, u&#39;&#39;, u&#39;&#39;, u&#39;&#39;, u&#39;&#39;, u&#39;false&#39;, u&#39;&#39;, u&#39;&#39;, u&#39;1&#39;, u&#39;false&#39;, u&#39;false&#39;]

TRACEBACK:
File &quot;/usr/local/django/testlino/env/lib/python2.6/site-packages/django/core/handlers/base.py&quot;, line 114, in get_response
(...)
File &quot;/home/lsaffre/repositories/lino/lino/core/requests.py&quot;, line 822, in __init__
request))
File &quot;/home/lsaffre/repositories/lino/lino/ui/store.py&quot;, line 949, in parse_params
self, len(self.param_fields), pv))
</pre></div>
</div>
</li>
</ul>
<p>Worked several hours on it, without success until now.  I encapsulated
some code into <cite>install_layout</cite> in order to use the same logic for
<cite>params_layout</cite> where this was not yet done. But that was not the reason.</p>
<p>Why does a GET to <code class="docutils literal"><span class="pre">/api/integ/Clients/177</span></code> use the ParameterStore
defined on <cite>pcsw.Clients</cite>!?  Yes, <cite>integ.Clients</cite> inherits from
<cite>pcsw.Clients</cite>, but it even specifies its own <cite>parameters</cite> and
<cite>params_layout</cite> (so my <cite>install_layout</cite> above was of course useless).</p>
<p>Started new tested document <a class="reference external" href="http://welfare.lino-framework.org/tested/integ.html#welfare-tested-integ" title="(in Lino Welfare Reference Manual v1.1)"><span>Integration Service</span></a> which
reproduces the problem.</p>
<p>The problematic code was this:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">elems</span> <span class="o">+=</span> <span class="p">[</span>
    <span class="n">E</span><span class="o">.</span><span class="n">br</span><span class="p">(),</span> <span class="n">ar</span><span class="o">.</span><span class="n">instance_action_button</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">create_household</span><span class="p">)]</span>
</pre></div>
</div>
<p>Here <cite>obj.create_household</cite> instantiates an <cite>InstanceAction</cite> on a
Person&#8217;s <cite>create_household</cite>.  The application code is okay, but we
must decide whether or not <cite>ar.instance_action_button</cite> should parse
<cite>ar.request</cite> (i.e. the web request which caused the current request).
In the above case it may not.  But here be dragons. Not sure whether
this will cause problems elsewhere.  The API for rendering action
buttons is not yet what I would call &#8220;stable&#8221;.</p>
<p>Cool: I added a <cite>get_slave_summary</cite> method to
<cite>UploadsByController</cite>. This will make our &#8220;quick upload buttons&#8221;
needless! Not yet finished, but promising.</p>
<p>Checkin wegen Feierabend.</p>
<p>More bugs to fix:</p>
<ul class="simple">
<li>IBAN numbers don&#8217;t seem to get validated.</li>
<li>The Insert window of an Upload has a layout problem.  I guess that
the <cite>Lino.FileUploadField</cite> doesn&#8217;t collaborate well with the auto
height.</li>
<li>Inserting in UploadsByClient sets the <cite>owner</cite> but not the <cite>client</cite>.</li>
</ul>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../index.html">
              <img class="logo" src="../../_static/logo.png" alt="Logo"/>
            </a></p>
<h3><a href="../../index.html">Table Of Contents</a></h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../index.html">Blog</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../about/index.html">About me</a></li>
</ul>

<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script><p align="center">
<a href="https://github.com/lsaffre" target="_blank">GitHub</a>
<br/><a href="http://www.lino-framework.org" target="_blank">Lino</a>
<br/><a href="http://www.saffre-rumma.net" target="_blank">Rumma & Ko</a>
</p>

        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="0430.html" title="Wednesday, April 30, 2014"
             >next</a> |</li>
        <li class="right" >
          <a href="0428.html" title="Monday, April 28, 2014"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Home</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Blog</a> &raquo;</li>
          <li class="nav-item nav-item-2"><a href="index.html" >2014</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">

<a rel="license" href="http://creativecommons.org/licenses/by-sa/2.5/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-sa/2.5/88x31.png" /></a>
This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-sa/2.5/">Creative Commons Attribution-ShareAlike 2.5 Generic License</a>.<br />
      Last updated on 2015-03-31.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.3.
<a href="../../_sources/blog/2014/0429.txt">Show Source</a> 
    <a href="http://luc.lino-framework.org/blog/2014/0429.html">Online Link</a>
    </div>
  </body>
</html>