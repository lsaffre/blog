<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>20130114 &mdash; Luc&#39;s website</title>
    
    <link rel="stylesheet" href="../../_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/centeredlogo.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/taglist.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/taglist_tags.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/sidebar.js"></script>
    <link rel="search" type="application/opensearchdescription+xml"
          title="Search within Luc&#39;s website"
          href="../../_static/opensearch.xml"/>
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
    <link rel="top" title="Luc&#39;s website" href="../../index.html" />
    <link rel="up" title="2013" href="index.html" />
    <link rel="next" title="20130115" href="0115.html" />
    <link rel="prev" title="20130113" href="0113.html" />
   
<script src="../../.htmldata/lightbox/js/jquery-1.11.0.min.js"></script>
<script src="../../.htmldata/lightbox/js/lightbox.min.js"></script>
<link href="../../.htmldata/lightbox/css/lightbox.css" rel="stylesheet" />

  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="0115.html" title="20130115"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="0113.html" title="20130113"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Home</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Blog</a> &raquo;</li>
          <li class="nav-item nav-item-2"><a href="index.html" accesskey="U">2013</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="id1">
<h1>20130114<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h1>
<div class="section" id="sales-invoices">
<h2>Sales invoices<a class="headerlink" href="#sales-invoices" title="Permalink to this headline">¶</a></h2>
<p>Today I had a bug-hunting tour in <code class="xref py py-mod docutils literal"><span class="pre">lino.projects.cosi</span></code>,
more precisely at the sales invoices.</p>
<p>Saving a
<a class="reference external" href="http://www.lino-framework.org/api/lino.modlib.sales.models.html#lino.modlib.sales.models.Invoice" title="(in Lino v1.6)"><code class="xref py py-class docutils literal"><span class="pre">sales.Invoice</span></code></a>
whose state is
<a class="reference external" href="http://www.lino-framework.org/api/lino.modlib.sales.models.html#lino.modlib.sales.models.InvoiceStates" title="(in Lino v1.6)"><code class="xref py py-class docutils literal"><span class="pre">draft</span></code></a>
returned no available actions (&#8220;&lt;p&gt;&lt;b&gt;Draft&lt;/b&gt;&lt;/p&gt;&#8221;)
in <code class="xref py py-meth docutils literal"><span class="pre">workflow_buttons</span></code>
while after clicking the <cite>Refresh</cite> button they showed up correctly.</p>
<p>This was because
<code class="xref py py-meth docutils literal"><span class="pre">get_workflow_actions</span></code>
called
<code class="xref py py-meth docutils literal"><span class="pre">get_actions</span></code>
with the requesting <cite>ar.bound_action.action</cite>
(for the <cite>Refresh</cite> button this is a <cite>ShowDetailAction</cite>
while for the <cite>Save</cite> button it&#8217;s a  SubmitDetail` instance).</p>
<p>Solution:
Changed <code class="xref py py-meth docutils literal"><span class="pre">lino.core.actors.Actor.get_workflow_actions()</span></code></p>
<p>But, oops I almost forgot that we&#8217;re in guinea pig testing mode.
And that&#8217;s again a change to the framework which is not
allowed until the definitive release.
Bend the rules once more and let this change pass?
Go back in time and release yesterday?
None of both: since the change is only one line of code,
I manually restore the previous state,
do the official releases, then continue.</p>
</div>
<div class="section" id="official-release">
<h2>Official release<a class="headerlink" href="#official-release" title="Permalink to this headline">¶</a></h2>
<p>So here they are:
Lino <a class="reference external" href="http://www.lino-framework.org/releases/1.5.4.html">/releases/1.5.4</a> is there:</p>
<div class="highlight-python"><div class="highlight"><pre>running upload
Submitting docs/dl\lino-1.5.4.tar.gz to http://pypi.python.org/pypi
Server response (200): OK
Submitting docs/dl\lino-1.5.4.zip to http://pypi.python.org/pypi
Server response (200): OK
</pre></div>
</div>
<p>Oops, <a class="reference external" href="http://welfare.lino-framework.org/releases/1.0.8.html">Lino-Welfare 1.0.8</a>
didn&#8217;t pass at the first attempt:</p>
<div class="highlight-python"><div class="highlight"><pre>Submitting ../lino/docs/dl\lino_welfare-1.0.8.tar.gz to http://pypi.python.org/pypi
Upload failed (403): You are not allowed to edit &#39;lino_welfare&#39; package information
Submitting ../lino/docs/dl\lino_welfare-1.0.8.zip to http://pypi.python.org/pypi
Upload failed (403): You are not allowed to edit &#39;lino_welfare&#39; package information
</pre></div>
</div>
<p>This was because I called <cite>setuptools.setup()</cite> with a <cite>name</cite> of
<cite>&#8220;lino_welfare&#8221;</cite> instead of <cite>&#8220;lino-welfare&#8221;</cite>.</p>
<p>After the release, besides restoring
<code class="xref py py-meth docutils literal"><span class="pre">lino.core.actors.Actor.get_workflow_actions()</span></code>,
I fiddled again with <a class="reference external" href="http://www.lino-framework.org/ref/files.html#xfile-setup.py" title="(in Lino v1.6)"><code class="xref std std-xfile docutils literal"><span class="pre">setup.py</span></code></a>.
Opened <a class="reference external" href="https://github.com/lsaffre/lino/blob/master/docs/tickets/69">docs/tickets/69</a>.</p>
</div>
<div class="section" id="sales-invoices-continued">
<h2>Sales invoices (continued)<a class="headerlink" href="#sales-invoices-continued" title="Permalink to this headline">¶</a></h2>
<p>Another subtle problem solved:
the total fields of a
<a class="reference external" href="http://www.lino-framework.org/api/lino.modlib.sales.models.html#lino.modlib.sales.models.Invoice" title="(in Lino v1.6)"><code class="xref py py-class docutils literal"><span class="pre">sales.Invoice</span></code></a>
shouldn&#8217;t be editable.</p>
<p>The total fields of a sales invoice should of course always
be the sum of the invoice&#8217;s items.
Opened new ticket <a class="reference external" href="https://github.com/lsaffre/lino/blob/master/docs/tickets/68">docs/tickets/68</a>.
Currently, users must hit the Save button of their invoice in
order to see the updated totals.</p>
<p>Changed execution order of
<code class="xref py py-meth docutils literal"><span class="pre">full_clean</span></code>
and
<a class="reference external" href="http://www.lino-framework.org/api/lino.core.model.html#lino.core.model.Model.before_ui_save" title="(in Lino v1.6)"><code class="xref py py-meth docutils literal"><span class="pre">before_ui_save</span></code></a>
because it makes a difference when
<strong>saving non-dirty records</strong>.
We agree that <cite>before_ui_save</cite> should <strong>not</strong> run in this case,
but it was counter-intuitive that <cite>full_clean</cite> wasn&#8217;t called either.</p>
<p>What should happen when the user hits the <cite>Save</cite> button
of a detail form which has no modifications?
The intuitive meaning of this is &#8220;to make sure everything is really
okay with that record&#8221;.</p>
<p>Why should users doubt about whether &#8220;everything is okay&#8221;?
One case where this makes sense is to update the totals
of a sales invoice when you have modified some item.
At least as long as Lino doesn&#8217;t do this automatically.</p>
<p>Added a new parameter
<a class="reference external" href="http://www.lino-framework.org/api/lino.core.tables.html#lino.core.tables.AbstractTable.auto_fit_column_widths" title="(in Lino v1.6)"><code class="xref py py-attr docutils literal"><span class="pre">auto_fit_column_widths</span></code></a>
which will set the <cite>forceFit</cite> config option
of ExtJS&#8217;s <cite>Ext.grid.GridView</cite>.</p>
<p>Added <cite>.x-form-num-field { text-align: right;}</cite> to
<a class="reference external" href="https://github.com/lsaffre/lino/blob/master//media/extjs/lino.css">/media/extjs/lino.css</a> after reading
<a class="reference external" href="http://www.sencha.com/forum/showthread.php?70195-NumberField-and-Right-Alignment">NumberField and Right Alignment</a></p>
<p>[23:00] I start to be satisfied. Some quick screenshots:</p>
<a class="reference internal image-reference" href="../../_images/0114a.jpg"><img alt="../../_images/0114a.jpg" src="../../_images/0114a.jpg" style="width: 789.6px; height: 596.0px;" /></a>
<a class="reference internal image-reference" href="../../_images/0114b.jpg"><img alt="../../_images/0114b.jpg" src="../../_images/0114b.jpg" style="width: 789.6px; height: 596.0px;" /></a>
<a class="reference internal image-reference" href="../../_images/0114c.jpg"><img alt="../../_images/0114c.jpg" src="../../_images/0114c.jpg" style="width: 789.6px; height: 596.0px;" /></a>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../index.html">
              <img class="logo" src="../../_static/logo.png" alt="Logo"/>
            </a></p>
<h3><a href="../../index.html">Table Of Contents</a></h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../index.html">Blog</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../about/index.html">About me</a></li>
</ul>

<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script><p align="center">
<a href="https://github.com/lsaffre" target="_blank">GitHub</a>
<br/><a href="http://www.lino-framework.org" target="_blank">Lino</a>
<br/><a href="http://www.saffre-rumma.net" target="_blank">Rumma & Ko</a>
</p>

        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="0115.html" title="20130115"
             >next</a> |</li>
        <li class="right" >
          <a href="0113.html" title="20130113"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Home</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Blog</a> &raquo;</li>
          <li class="nav-item nav-item-2"><a href="index.html" >2013</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">

<a rel="license" href="http://creativecommons.org/licenses/by-sa/2.5/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-sa/2.5/88x31.png" /></a>
This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-sa/2.5/">Creative Commons Attribution-ShareAlike 2.5 Generic License</a>.<br />
      Last updated on 2015-03-31.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.3.
<a href="../../_sources/blog/2013/0114.txt">Show Source</a> 
    <a href="http://luc.lino-framework.org/blog/2013/0114.html">Online Link</a>
    </div>
  </body>
</html>