<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>20130708 (Monday, 08 July 2013) &mdash; Luc&#39;s website</title>
    
    <link rel="stylesheet" href="../../_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/centeredlogo.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/taglist.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/taglist_tags.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/sidebar.js"></script>
    <link rel="search" type="application/opensearchdescription+xml"
          title="Search within Luc&#39;s website"
          href="../../_static/opensearch.xml"/>
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
    <link rel="top" title="Luc&#39;s website" href="../../index.html" />
    <link rel="up" title="2013" href="index.html" />
    <link rel="next" title="20130709 (Tuesday, 09 July 2013)" href="0709.html" />
    <link rel="prev" title="20130706 (Saturday, 06 July 2013)" href="0706.html" />
   
<script src="../../.htmldata/lightbox/js/jquery-1.11.0.min.js"></script>
<script src="../../.htmldata/lightbox/js/lightbox.min.js"></script>
<link href="../../.htmldata/lightbox/css/lightbox.css" rel="stylesheet" />

  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="0709.html" title="20130709 (Tuesday, 09 July 2013)"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="0706.html" title="20130706 (Saturday, 06 July 2013)"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Home</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Blog</a> &raquo;</li>
          <li class="nav-item nav-item-2"><a href="index.html" accesskey="U">2013</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="monday-08-july-2013">
<h1>20130708 (Monday, 08 July 2013)<a class="headerlink" href="#monday-08-july-2013" title="Permalink to this headline">¶</a></h1>
<div class="section" id="no-launcher-defined-for-extension-odt">
<h2>No launcher defined for extension &#8216;odt&#8217;<a class="headerlink" href="#no-launcher-defined-for-extension-odt" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="http://www.lino-framework.org/davlink/index.html#davlink" title="(in Lino v1.6)"><span>DavLink</span></a> doesn&#8217;t work (out of the box) on an Ubuntu client.
It says &#8220;No launcher defined for extension &#8216;odt&#8217;&#8221; even though
libreoffice is installed.
Re-learning to develop and maintain a Java applet.</p>
<p>How to have DavLink re-scan your system for launchers:</p>
<div class="highlight-python"><div class="highlight"><pre>$ rm /etc/.java/.systemPrefs/lino/davlink/prefs.xml
</pre></div>
</div>
<p>(This will later cause a warning &#8220;Prefs file removed in background
/etc/.java/.systemPrefs/lino/davlink/prefs.xml&#8221;, but I didn&#8217;t
observe other problems than this)</p>
<p>Added a main method to DavLink applet so I can run it from a
command line like this:</p>
<div class="highlight-python"><div class="highlight"><pre>$ cd ~/hgwork/lino/java
$ java davlink.DavLink file:///path/to/document.odt
</pre></div>
</div>
<p>Enhanced <a class="reference external" href="https://github.com/lsaffre/lino/blob/master/java/Makefile">java/Makefile</a> so that it reads my keystore password
from a file <code class="file docutils literal"><span class="pre">~/.keystore_password</span></code> to avoid typing it again and
again when working on the DavLink applet.</p>
<p>One question was: how to make error messages more evident?
I tried displaying them in a <cite>javax.swing.JOptionPane</cite> but didn&#8217;t
like the result. Want to get a standard Javascript alert message.</p>
<p>Solution: The applet method <cite>DavLink.open</cite> now returns the error
message as a string. A return value f <cite>null</cite> means that there was no
error. And <cite>Lino.davlink_open</cite> then calls alert on this.
Learned that I cannot return the plain Exception object,
it must be some simple data type like String.</p>
<p>The actual problem is still not solved: how can I configure my
machine so that DavLink has permission to do what I want it to do?
When the applet&#8217;s init method calls
<a class="reference external" href="http://docs.oracle.com/javase/7/docs/api/java/lang/System.html#setSecurityManager(java.lang.SecurityManager)">setSecurityManager</a>
to install my own security manager, then I get (client using IcedTea):</p>
<div class="highlight-python"><div class="highlight"><pre>java.lang.SecurityException: Changing the SecurityManager is not allowed.
    at net.sourceforge.jnlp.runtime.JNLPSecurityManager.checkPermission(JNLPSecurityManager.java:270)
    at java.lang.System.setSecurityManager0(System.java:295)
    at java.lang.System.setSecurityManager(System.java:286)
    at davlink.DavLink.init(DavLink.java:229)
    at sun.applet.AppletPanel.run(AppletPanel.java:436)
    at java.lang.Thread.run(Thread.java:722)
</pre></div>
</div>
<p>A customer (client using Oracle JRE) reports a similar message:</p>
<div class="highlight-python"><div class="highlight"><pre>java.lang.SecurityException: JVM Shared, not allowed to set security manager
    at sun.plugin2.applet.SecurityManagerHelper.checkPermissionHelper(Unknown Source)
    at sun.plugin2.applet.AWTAppletSecurityManager.checkPermission(Unknown Source)
    at java.lang.System.setSecurityManager0(Unknown Source)
    at java.lang.System.setSecurityManager(Unknown Source)
    at davlink.DavLink.init(DavLink.java:215)
    at com.sun.deploy.uitoolkit.impl.awt.AWTAppletAdapter.init(Unknown Source)
    at sun.plugin2.applet.Plugin2Manager$AppletExecutionRunnable.run(Unknown Source)
    at java.lang.Thread.run(Unknown Source)
</pre></div>
</div>
<p>This problem has appeared after upgrading from Java 6 to 7.</p>
<p>Note that the visible result varies heavily depending
on the circumstances
because exceptions during the init method are silently
ignored (don&#8217;t ask me why).</p>
<p>Note: <a class="reference external" href="http://docs.oracle.com/javase/7/docs/technotes/guides/jweb/client-security.html">Setting the Security Level of the Java Client</a></p>
<p>Some docs
(e.g. <a class="reference external" href="http://forum.jogamp.org/JOGL-not-launching-on-Ubuntu-12-04-LTS-td4005531.html">JOGL not launching on Ubuntu 12.04 LTS</a>)
indicate that the answer must be to add something like the following to your
<code class="file docutils literal"><span class="pre">java.policy</span></code> file:</p>
<div class="highlight-python"><div class="highlight"><pre>grant codeBase &quot;http://127.0.0.1:8000/-&quot; {
        permission java.security.AllPermission;
};
</pre></div>
</div>
<p>One difficulty is to find the location of your <code class="file docutils literal"><span class="pre">java.policy</span></code>
file. A <cite>ps aux | grep icedtea</cite> says:</p>
<div class="highlight-python"><div class="highlight"><pre>luc      12676  4.5  0.7 1382728 60392 ?       Sl   19:11   0:02 /usr/lib/jvm/java-7-openjdk-i386/bin/java -Xbootclasspath/a:/usr/share/icedtea-web/netx.jar:/usr/share/icedtea-web/plugin.jar -classpath /usr/lib/jvm/java-7-openjdk-i386/lib/rt.jar sun.applet.PluginMain /tmp/icedteaplugin-luc/12666-icedteanp-plugin-to-appletviewer /tmp/icedteaplugin-luc/12666-icedteanp-appletviewer-to-plugin
</pre></div>
</div>
<p>So I guessed that my file is
<code class="file docutils literal"><span class="pre">/usr/lib/jvm/java-7-openjdk-i386/jre/lib/security/java.policy</span></code>
or its link
<code class="file docutils literal"><span class="pre">/etc/java-7-openjdk/security/java.policy</span></code>.</p>
<p>Yes, this is a solution, the DavLink applet now works
from an Ubuntu 12.04 LTS using IcedTea and Java7.</p>
<p>Note that the &#8220;Changing the SecurityManager is not allowed.&#8221;
exception still comes. But the whole init method has become
useless.</p>
<p>Explanation:
It was a security bug in Java6 to not raise this exception...
Users <em>must</em> edit their <code class="file docutils literal"><span class="pre">java.policy</span></code>
file in order to allow DavLink to work.</p>
</div>
<div class="section" id="downgrading-java-7-to-6">
<h2>Downgrading Java 7 to 6<a class="headerlink" href="#downgrading-java-7-to-6" title="Permalink to this headline">¶</a></h2>
<p>A last proof of the above explanation would be to switch back to Java 6:</p>
<div class="highlight-python"><div class="highlight"><pre>$ sudo aptitude remove openjdk-7-jre
</pre></div>
</div>
<p>Now Chromium said
&#8220;Java(TM) is required to display some elements on this page&#8221;,
and an &#8220;Install plugins&#8221; button leads me to
<a class="reference external" href="http://java.com/en/download/index.jsp">http://java.com/en/download/index.jsp</a>
which suggests &#8220;Version 7 Update 25&#8221;.
Not exactly what I want.</p>
<p>Ah, this one is better:</p>
<div class="highlight-python"><div class="highlight"><pre>$ sudo aptitude remove openjdk-7-jre icedtea-7-jre-jamvm icedtea-7-plugin
</pre></div>
</div>
<p>But there are still two automatic packages remaining:</p>
<div class="highlight-python"><div class="highlight"><pre>i A openjdk-7-jre-headless                                              - OpenJDK Java runtime, using Hotspot JIT (headless)
i A openjdk-7-jre-lib                                                   - OpenJDK Java runtime (architecture independent libraries)
</pre></div>
</div>
<p>How to find out which package(s) caused a given
package to install automatically?</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../index.html">
              <img class="logo" src="../../_static/logo.png" alt="Logo"/>
            </a></p>
<h3><a href="../../index.html">Table Of Contents</a></h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../index.html">Blog</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../about/index.html">About me</a></li>
</ul>

<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script><p align="center">
<a href="https://github.com/lsaffre" target="_blank">GitHub</a>
<br/><a href="http://www.lino-framework.org" target="_blank">Lino</a>
<br/><a href="http://www.saffre-rumma.net" target="_blank">Rumma & Ko</a>
</p>

        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="0709.html" title="20130709 (Tuesday, 09 July 2013)"
             >next</a> |</li>
        <li class="right" >
          <a href="0706.html" title="20130706 (Saturday, 06 July 2013)"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Home</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Blog</a> &raquo;</li>
          <li class="nav-item nav-item-2"><a href="index.html" >2013</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2001-2015 Luc Saffre.
      Last updated on 2015-03-31.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.3.
    <a href="https://raw.github.com/lsaffre/blog/master/docs/blog/2013/0708.rst"
           rel="nofollow">Show Source</a>.
    <a href="http://luc.lino-framework.org/blog/2013/0708.html">Online Link</a>
    </div>
  </body>
</html>