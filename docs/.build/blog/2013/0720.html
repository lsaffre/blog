<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>20130720 (Saturday, 20 July 2013) &mdash; Luc&#39;s website</title>
    
    <link rel="stylesheet" href="../../_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/centeredlogo.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/taglist.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/taglist_tags.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/sidebar.js"></script>
    <link rel="search" type="application/opensearchdescription+xml"
          title="Search within Luc&#39;s website"
          href="../../_static/opensearch.xml"/>
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
    <link rel="top" title="Luc&#39;s website" href="../../index.html" />
    <link rel="up" title="2013" href="index.html" />
    <link rel="next" title="20130721 (Sunday, 21 July 2013)" href="0721.html" />
    <link rel="prev" title="20130719 (Friday, 19 July 2013)" href="0719.html" />
   
<script src="../../.htmldata/lightbox/js/jquery-1.11.0.min.js"></script>
<script src="../../.htmldata/lightbox/js/lightbox.min.js"></script>
<link href="../../.htmldata/lightbox/css/lightbox.css" rel="stylesheet" />

  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="0721.html" title="20130721 (Sunday, 21 July 2013)"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="0719.html" title="20130719 (Friday, 19 July 2013)"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Home</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Blog</a> &raquo;</li>
          <li class="nav-item nav-item-2"><a href="index.html" accesskey="U">2013</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="saturday-20-july-2013">
<h1>20130720 (Saturday, 20 July 2013)<a class="headerlink" href="#saturday-20-july-2013" title="Permalink to this headline">¶</a></h1>
<div class="section" id="two-subtle-bugs">
<h2>Two subtle bugs<a class="headerlink" href="#two-subtle-bugs" title="Permalink to this headline">¶</a></h2>
<p><code class="xref py py-mod docutils literal"><span class="pre">lino_welfare.fixtures.demo</span></code> had a problem when it was together
with <a class="reference external" href="http://www.lino-framework.org/api/lino.modlib.countries.fixtures.be.html#module-lino.modlib.countries.fixtures.be" title="(in Lino v1.6)"><code class="xref py py-mod docutils literal"><span class="pre">lino.modlib.countries.fixtures.be</span></code></a>. It said
&#8220;MultipleObjectsReturned:
get() returned more than one City &#8211;
it returned 2! Lookup parameters were {&#8216;zip_code__exact&#8217;: u&#8216;4780&#8217;}&#8221;
because both Recht and Sankt Vith have the same zip code 4780.</p>
<p>And another rather subtle pitfall which took me some time to find:</p>
<p>Users complained that when
clicking on one of the RequestFields in
<span class="xref std std-ref">UsersWithClients</span>
to open the correspondingly filtered list of
<span class="xref std std-ref">Clients</span>,
Lino sometimes used some date in the past for the observed period.
This was because the columns of this table are being dynamically
built when <cite>database_ready</cite>, and in that signal handler I use a
variable <cite>today</cite> which holds the current date.
And that variable, I initialized it only once at the beginning of
the handler. But of course I must evaluate it for each request.</p>
</div>
<div class="section" id="migration">
<h2>Migration<a class="headerlink" href="#migration" title="Permalink to this headline">¶</a></h2>
<p>Updated <code class="xref py py-func docutils literal"><span class="pre">lino_welfare.migrate.migrate_from_1_1_7()</span></code>.</p>
<p>WARNING Abandoning with 57 unsaved instances from north.dpy_tmp_70496696:
- pcsw.Coaching [u&#8217;Begleitungsperiode endet bevor sie startet.&#8217;] (57 object(s) with primary key 3639, 6145, 6172, 6178, 6181, 6192, 6201, 6236, 6242, 6243, 7155, 7167, 7171, 7267, 7290, 7297, 7327, 7336, 7338, 7349, 7352, 7356, 7359, 7360, 7362, 7364, 7365, 7366, 7372, 7373, 7374, 7375, 7376, 7377, 7378, 7379, 7380, 7381, 7382, 7383, 7384, 7385, 7386, 7387, 7388, 7389, 7390, 7391, 7392, 7393, 7395, 7396, 7397, 7398, 7400, 7521, 7522)</p>
<p>This was because watch_tim set
<cite>end_date</cite> of the primary coaching of non-coached clients
to <cite>1990-01-01</cite> instead of <cite>Coaching.start_date</cite>.</p>
<p>Updated the documentation about <a class="reference external" href="http://www.lino-framework.org/topics/dpy.html#dpy" title="(in Lino v1.6)"><span>The Python serializer</span></a> which was very scattered.</p>
</div>
<div class="section" id="permission-problem-for-theresia">
<h2>Permission problem for Theresia<a class="headerlink" href="#permission-problem-for-theresia" title="Permalink to this headline">¶</a></h2>
<p>A third subtle bug.</p>
<p>When logging in as Theresia on the Lino-Welfare demo, then I got
a traceback</p>
<blockquote>
<div>No view permission for main panel of reception.ExpectedGuests.InsertFormPanel :
main requires {&#8216;auth&#8217;: True, &#8216;user_groups&#8217;: u&#8217;office&#8217;},
but actor cal.Guests requires {&#8216;user_level&#8217;: u&#8217;admin&#8217;, &#8216;auth&#8217;: True, &#8216;user_groups&#8217;: u&#8217;office&#8217;})</div></blockquote>
<p>When I disabled this security check, then it generated the following code:</p>
<div class="highlight-python"><div class="highlight"><pre>Lino.reception.ExpectedGuests.insertPanel = Ext.extend(Lino.reception.ExpectedGuests.InsertFormPanel,{
  empty_title: &quot;Neu Expected Guests&quot;,
  hide_navigator: true,
  ls_bbar_actions: [ { &quot;itemId&quot;: &quot;post&quot;, &quot;menu_item_text&quot;: &quot;Erstellen&quot;, &quot;tooltip&quot;: &quot;Datensatz erstellen und dann im Detail-Fenster \u00f6ffnen&quot;, &quot;panel_btn_handler&quot;: function(panel){panel.save(null,true,&#39;post&#39;)}, &quot;text&quot;: &quot;Erstellen&quot;, &quot;overflowText&quot;: &quot;Erstellen&quot;, &quot;auto_save&quot;: false }, { &quot;itemId&quot;: &quot;poststay&quot;, &quot;menu_item_text&quot;: &quot;Erstellen ohne Detail&quot;, &quot;tooltip&quot;: &quot;Nach Erstellen des Datensatzes kein Detail-Fenster \u00f6ffnen&quot;, &quot;panel_btn_handler&quot;: function(panel){panel.save(null,false,&#39;poststay&#39;)}, &quot;text&quot;: &quot;Erstellen ohne Detail&quot;, &quot;overflowText&quot;: &quot;Erstellen ohne Detail&quot;, &quot;auto_save&quot;: false } ],
  ls_url: &quot;/reception/ExpectedGuests&quot;,
  action_name: &quot;insert&quot;,
  initComponent : function() {
    this.ls_detail_handler = Lino.reception.ExpectedGuests.detail;
    this.ls_insert_handler = Lino.reception.ExpectedGuests.insert;
    Lino.reception.ExpectedGuests.insertPanel.superclass.initComponent.call(this);
  }
});
</pre></div>
</div>
<p>which failed because a <cite>Lino.reception.ExpectedGuests.InsertFormPanel</cite>
has not been defined.</p>
<p>The reason was a bug in Lino&#8217;s requirement arithmethics:
<code class="xref py py-meth docutils literal"><span class="pre">lino.ui.elems.LayoutElement.loosen_requirements()</span></code>
must treat <cite>user_groups</cite> differently than <cite>user_level</cite>.
There are probably more bugs like this, and the
only real solution will be a class
<code class="xref py py-class docutils literal"><span class="pre">lino.utils.auth.Requirements</span></code>.
But that&#8217;s not urgent.</p>
<p>And finally Theresia revealed another bug: the <span class="menuselection">Calendar</span>
menu didn&#8217;t suppress separators when they were useless
(because there were no items to separate,
which may happen due to permission requirements).</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../index.html">
              <img class="logo" src="../../_static/logo.png" alt="Logo"/>
            </a></p>
<h3><a href="../../index.html">Table Of Contents</a></h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../index.html">Blog</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../about/index.html">About me</a></li>
</ul>

<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script><p align="center">
<a href="https://github.com/lsaffre" target="_blank">GitHub</a>
<br/><a href="http://www.lino-framework.org" target="_blank">Lino</a>
<br/><a href="http://www.saffre-rumma.net" target="_blank">Rumma & Ko</a>
</p>

        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="0721.html" title="20130721 (Sunday, 21 July 2013)"
             >next</a> |</li>
        <li class="right" >
          <a href="0719.html" title="20130719 (Friday, 19 July 2013)"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Home</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Blog</a> &raquo;</li>
          <li class="nav-item nav-item-2"><a href="index.html" >2013</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2001-2015 Luc Saffre.
      Last updated on 2015-03-31.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.3.
    <a href="https://raw.github.com/lsaffre/blog/master/docs/blog/2013/0720.rst"
           rel="nofollow">Show Source</a>.
    <a href="http://luc.lino-framework.org/blog/2013/0720.html">Online Link</a>
    </div>
  </body>
</html>