<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>20130816 (Friday, 16 August 2013) &mdash; Luc&#39;s website</title>
    
    <link rel="stylesheet" href="../../_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/centeredlogo.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/taglist.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/taglist_tags.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/sidebar.js"></script>
    <link rel="search" type="application/opensearchdescription+xml"
          title="Search within Luc&#39;s website"
          href="../../_static/opensearch.xml"/>
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
    <link rel="top" title="Luc&#39;s website" href="../../index.html" />
    <link rel="up" title="2013" href="index.html" />
    <link rel="next" title="20130817 (Saturday, 17 August 2013)" href="0817.html" />
    <link rel="prev" title="20130815 (Thursday, 15 August 2013)" href="0815.html" />
   
<script src="../../.htmldata/lightbox/js/jquery-1.11.0.min.js"></script>
<script src="../../.htmldata/lightbox/js/lightbox.min.js"></script>
<link href="../../.htmldata/lightbox/css/lightbox.css" rel="stylesheet" />

  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="0817.html" title="20130817 (Saturday, 17 August 2013)"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="0815.html" title="20130815 (Thursday, 15 August 2013)"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Home</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Blog</a> &raquo;</li>
          <li class="nav-item nav-item-2"><a href="index.html" accesskey="U">2013</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="friday-16-august-2013">
<h1>20130816 (Friday, 16 August 2013)<a class="headerlink" href="#friday-16-august-2013" title="Permalink to this headline">¶</a></h1>
<div class="section" id="reading-the-picture-from-a-belgian-eid-card">
<h2>Reading the picture from a Belgian eID card<a class="headerlink" href="#reading-the-picture-from-a-belgian-eid-card" title="Permalink to this headline">¶</a></h2>
<p>Johan has fixed issue #5
(<a class="reference external" href="http://code.google.com/p/eid-javascript-lib/issues/detail?id=5">getPicture() works in FF 16 but not in Chrome 23</a>)
and asks me to verify it.</p>
<p>Using a development server and either Chrome or Firefox on my Ubuntu 12.04,
there seems to
be another problem: getPicture() doesn&#8217;t return any picture at all.</p>
<p>Since nobody except me can see my development server, I first
must get it running on the public demo site
(<a class="reference external" href="http://welfare-demo.lino-framework.org/">http://welfare-demo.lino-framework.org/</a>).
And since we have been working on the user interface,
I first updated to the latest development version of
Lino-Welfare and wrote the following
updated instructions on how to reproduce the problem:</p>
<ul class="simple">
<li>Go to <a class="reference external" href="http://welfare-demo.lino-framework.org">http://welfare-demo.lino-framework.org</a></li>
<li>Log in as robin (password &#8220;1234&#8221;)</li>
<li>Open the Javascript console of your browser</li>
<li>In the menu, select <span class="menuselection">Reception ‣ Clients</span>
(or use the permalink <a class="reference external" href="http://welfare-demo.lino-framework.org/api/reception/Clients">http://welfare-demo.lino-framework.org/api/reception/Clients</a>).
Lino shows a list of fictive clients.
In the top toolbar there&#8217;s a button &#8220;Read eID card&#8221;.</li>
<li>Insert some Belgian eID card. Click the button.</li>
</ul>
<p>But the above instructions don&#8217;t yet work.</p>
</div>
<div class="section" id="csrf-cookie-not-set">
<h2>CSRF cookie not set<a class="headerlink" href="#csrf-cookie-not-set" title="Permalink to this headline">¶</a></h2>
<p>First of all, clicking the button activated the loadMask (&#8220;Please wait...&#8221;)
and remained there. The server log said:</p>
<div class="highlight-python"><div class="highlight"><pre>201308-16 05:21:22 WARNING csrf : Forbidden (CSRF cookie not set.): /api/reception/Clients/116
</pre></div>
</div>
<p>Obviously I unconsiously somehow had activated Django&#8217;s latest security
evolutions <a class="reference external" href="https://docs.djangoproject.com/en/dev/ref/contrib/csrf/">CSRF middleware</a>.
I say &#8220;unconsiously&#8221; because according to the docs
CSRF should not be activated since I don&#8217;t include the
<cite>django.middleware.csrf.CsrfViewMiddleware</cite>.
I suppose that Django in a motherly way decided that
<em>not</em> protecting against CSRF is just too dangerous and thus
protects me against my will...
Okay... anyway one day I would have had to face this.
And the solution wasn&#8217;t too difficult.
I just added to <a class="reference external" href="http://www.lino-framework.org/ref/javascript.html#xfile-linoweb.js" title="(in Lino v1.6)"><code class="xref std std-xfile docutils literal"><span class="pre">linoweb.js</span></code></a>  a snippet found on
<a class="reference external" href="http://stackoverflow.com/questions/3764589/how-do-i-include-django-1-2s-csrf-token-in-a-javascript-generated-html-form/5485616#5485616">How do I include Django 1.2&#8217;s CSRF token in a Javascript-generated HTML form?</a>
(thanks to
<a class="reference external" href="http://stackoverflow.com/users/10040/huuuze">huuze</a> for the question
and to
<a class="reference external" href="http://stackoverflow.com/users/683808/chrisv">chrisv</a>
for the answer):</p>
<div class="highlight-python"><div class="highlight"><pre>Ext.Ajax.on(&#39;beforerequest&#39;, function (conn, options) {
   if (!(/^http:.*/.test(options.url) || /^https:.*/.test(options.url))) {
     if (typeof(options.headers) == &quot;undefined&quot;) {
       options.headers = {&#39;X-CSRFToken&#39;: Ext.util.Cookies.get(&#39;csrftoken&#39;)};
     } else {
       options.headers.extend({&#39;X-CSRFToken&#39;: Ext.util.Cookies.get(&#39;csrftoken&#39;)});
     }
   }
}, this);
</pre></div>
</div>
</div>
<div class="section" id="applet-not-found">
<h2>Applet not found!<a class="headerlink" href="#applet-not-found" title="Permalink to this headline">¶</a></h2>
<p>The first problem (appearently) solved, now it is saying
&#8220;Applet not found!&#8221;.
I guess that this is another security problem, since my Java
console says:</p>
<div class="highlight-python"><div class="highlight"><pre>$ less ~/.icedtea/log/java.stderr
Gonna disable the security manager...
java.lang.SecurityException: Changing the SecurityManager is not allowed.
    at net.sourceforge.jnlp.runtime.JNLPSecurityManager.checkPermission(JNLPSecurityManager.java:270)
    at java.lang.System.setSecurityManager0(System.java:295)
    at java.lang.System.setSecurityManager(System.java:286)
    at davlink.DavLink.init(DavLink.java:228)
    at sun.applet.AppletPanel.run(AppletPanel.java:436)
    at java.lang.Thread.run(Thread.java:722)
</pre></div>
</div>
<p>I have to tell my client that it can trust this site by adding the
following lines to my
<code class="file docutils literal"><span class="pre">/etc/java-7-openjdk/security/java.policy</span></code> file:</p>
<div class="highlight-python"><div class="highlight"><pre>grant codeBase &quot;http://welfare-demo.lino-framework.org/-&quot; {
        permission java.security.AllPermission;
};
</pre></div>
</div>
<p>Now it appearently gets the requested permission, but freezes the
browser:</p>
<img alt="../../_images/0816.png" src="../../_images/0816.png" />
<p>to be continued...</p>
</div>
<div class="section" id="newcomers-are-green">
<h2>Newcomers are green<a class="headerlink" href="#newcomers-are-green" title="Permalink to this headline">¶</a></h2>
<p>A customer request aas to use colors in the
<span class="xref std std-ref">welfare.reception.Clients</span> table to visually enhance
newcomers.</p>
<p>Furthermore I&#8217;d like to find an interface for doing this
in a GUI-transparent manner.
We have already <code class="xref py py-attr docutils literal"><span class="pre">lino.core.actors.Actor.apply_cell_format</span></code>
but this works only in plain html and cannot easily be rendered
to ExtJS.</p>
<p>Solution: new actor attribute
<code class="xref py py-attr docutils literal"><span class="pre">get_row_class</span></code>
(EDIT: renamed to <cite>get_row_classes</cite> on <a class="reference external" href="oops">2013-08-19</a>)</p>
<p>TODO: have plain renderer use it too, deprecate
<a class="reference external" href="http://www.lino-framework.org/api/lino.core.actors.html#lino.core.actors.Actor.apply_cell_format" title="(in Lino v1.6)"><code class="xref py py-meth docutils literal"><span class="pre">lino.core.actors.Actor.apply_cell_format()</span></code></a>
and convert existing application code.</p>
</div>
<div class="section" id="the-not-enough-rows-bug">
<h2>The &#8220;Not enough rows&#8221; bug<a class="headerlink" href="#the-not-enough-rows-bug" title="Permalink to this headline">¶</a></h2>
<p>Fixed an old bug which Joe described as follows:</p>
<ul class="simple">
<li>When you open table, only 15 rows are loaded and if the table is large
enough (screen big enough), there is white space at the bottom. When you
resize or reload the grid, the problem is gone. This happens every time.</li>
</ul>
<p>The reason was that Lino tries to retrieve exactly the right number
of data rows when displaying an ExtJS <cite>EditorGridPanel</cite>
(which is the main element of the window).
But the height of an individual row is known only when at least one row
is present.
Which is not the case before the first load of the grid&#8217;s store.
So <cite>Lino.GridPanel.calculatePageSize</cite>
(defined in <a class="reference external" href="http://www.lino-framework.org/ref/javascript.html#xfile-linoweb.js" title="(in Lino v1.6)"><code class="xref std std-xfile docutils literal"><span class="pre">linoweb.js</span></code></a>)
now constructs a fake row with one
empty data cell using the grid&#8217;s HTML templates and CSS styles, just to
call it&#8217;s getHeight() before throwing it away.
That&#8217;s brute force but I didn&#8217;t yet see any other solution.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../index.html">
              <img class="logo" src="../../_static/logo.png" alt="Logo"/>
            </a></p>
<h3><a href="../../index.html">Table Of Contents</a></h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../index.html">Blog</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../about/index.html">About me</a></li>
</ul>

<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script><p align="center">
<a href="https://github.com/lsaffre" target="_blank">GitHub</a>
<br/><a href="http://www.lino-framework.org" target="_blank">Lino</a>
<br/><a href="http://www.saffre-rumma.net" target="_blank">Rumma & Ko</a>
</p>

        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="0817.html" title="20130817 (Saturday, 17 August 2013)"
             >next</a> |</li>
        <li class="right" >
          <a href="0815.html" title="20130815 (Thursday, 15 August 2013)"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Home</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Blog</a> &raquo;</li>
          <li class="nav-item nav-item-2"><a href="index.html" >2013</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">

<a rel="license" href="http://creativecommons.org/licenses/by-sa/2.5/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-sa/2.5/88x31.png" /></a>
This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-sa/2.5/">Creative Commons Attribution-ShareAlike 2.5 Generic License</a>.<br />
      Last updated on 2015-03-31.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.3.
<a href="../../_sources/blog/2013/0816.txt">Show Source</a> 
    <a href="http://luc.lino-framework.org/blog/2013/0816.html">Online Link</a>
    </div>
  </body>
</html>