<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>20130314 (Thursday, 14 March 2013) &mdash; Luc&#39;s website</title>
    
    <link rel="stylesheet" href="../../_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/centeredlogo.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/taglist.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/taglist_tags.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/sidebar.js"></script>
    <link rel="search" type="application/opensearchdescription+xml"
          title="Search within Luc&#39;s website"
          href="../../_static/opensearch.xml"/>
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
    <link rel="top" title="Luc&#39;s website" href="../../index.html" />
    <link rel="up" title="2013" href="index.html" />
    <link rel="next" title="20130315 (Friday, 15 March 2013)" href="0315.html" />
    <link rel="prev" title="20130313 (Wednesday, 13 March 2013)" href="0313.html" />
   
<script src="../../.htmldata/lightbox/js/jquery-1.11.0.min.js"></script>
<script src="../../.htmldata/lightbox/js/lightbox.min.js"></script>
<link href="../../.htmldata/lightbox/css/lightbox.css" rel="stylesheet" />

  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="0315.html" title="20130315 (Friday, 15 March 2013)"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="0313.html" title="20130313 (Wednesday, 13 March 2013)"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Home</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Blog</a> &raquo;</li>
          <li class="nav-item nav-item-2"><a href="index.html" accesskey="U">2013</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="thursday-14-march-2013">
<h1>20130314 (Thursday, 14 March 2013)<a class="headerlink" href="#thursday-14-march-2013" title="Permalink to this headline">¶</a></h1>
<p>Still working on the &#8220;pip install lino&#8221; problem.
Which takes so much time because I also work on
the &#8220;better automated testing&#8221; problem.</p>
<ul class="simple">
<li>Moved the uiless tutorial from lino to north where it is
called The Polls tutorial. This caused yet another testing
method <code class="xref py py-func docutils literal"><span class="pre">run_bash_tests</span></code>.</li>
<li>Trying the solution to move the <cite>media</cite> directory
one level down into the <cite>lino</cite> package:
<code class="docutils literal"><span class="pre">hg</span> <span class="pre">mv</span> <span class="pre">media</span> <span class="pre">lino</span></code> and one line in <code class="xref py py-mod docutils literal"><span class="pre">lino.ui.urls</span></code> to change
(todo: instructions for existing servers to move their symbolic link)</li>
<li>Deleted and re-uploaded once more the &#8220;official&#8221; PyPI releases
(django-site and Nort 0.0.4, Lino 1.6.2).</li>
</ul>
<div class="section" id="how-to-include-data-files-to-a-python-egg">
<h2>How to include data files to a Python egg<a class="headerlink" href="#how-to-include-data-files-to-a-python-egg" title="Permalink to this headline">¶</a></h2>
<p>I&#8217;d like that <code class="docutils literal"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">lino</span></code> also installs the
files under <cite>/media</cite> so that Lino users can use it out of the box.</p>
<p>It wasn&#8217;t enough to just move the <cite>/media</cite> source directory
to <cite>/lino/media</cite>.
Why does it work for files like <a class="reference external" href="https://github.com/lsaffre/lino/blob/master//lino/ui/linoweb.js">/lino/ui/linoweb.js</a>?
Because they are in a Python package, and because
MANIFEST.in has an <cite>global-include</cite> instruction to include
<cite>*.js</cite> files.</p>
<p>Should I have to turn it (and all the subdirectories!)
into Python packages?
One of them is e.g. <cite>lino/media/extjs/images/default/grid</cite>.
That would be a few dozen of otherwise useless <cite>__init__.py</cite> files.
No, there must be a better way.</p>
<ul class="simple">
<li>Distribute is a fork of the Setuptools project:
<a class="reference external" href="http://pythonhosted.org/distribute/">Documentation</a>
<a class="reference external" href="https://bitbucket.org/tarek/distribute/wiki/Home">Bitbucket</a>
<a class="reference external" href="https://pypi.python.org/pypi/distribute">PyPI entry</a></li>
</ul>
<p>The documentation section
<a class="reference external" href="http://pythonhosted.org/distribute/setuptools.html#accessing-data-files-at-runtime">Accessing Data Files at Runtime</a>
says clearly what I&#8217;m doing wrong:</p>
<blockquote>
<div>Typically, existing programs manipulate a package’s __file__ attribute in order to find the location of data files. However, this manipulation isn’t compatible with PEP 302-based import hooks, including importing from zip files and Python Eggs. It is strongly recommended that, if you are using data files, you should use the Resource Management API of pkg_resources to access them.</div></blockquote>
<p>And the
<a class="reference external" href="http://peak.telecommunity.com/DevCenter/PythonEggs#accessing-package-resources">Accessing Package Resources</a>
link explains how to make it better.</p>
<p>Note that we are not yet trying to convert the <cite>linoweb.js</cite> file into
a package resource because that&#8217;s an even more sophisticated case
because Lino also maintains an automatically generated messages file
<cite>linoweb.js.py</cite> to handle translation messages from this template.</p>
<p>In <code class="xref py py-mod docutils literal"><span class="pre">lino.ui.urls</span></code>, instead of saying...</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">setup_media_link</span><span class="p">(</span><span class="s">&#39;lino&#39;</span><span class="p">,</span><span class="n">source</span><span class="o">=</span><span class="n">join</span><span class="p">(</span><span class="n">dirname</span><span class="p">(</span><span class="n">lino</span><span class="o">.</span><span class="n">__file__</span><span class="p">),</span><span class="s">&#39;..&#39;</span><span class="p">,</span><span class="s">&#39;media&#39;</span><span class="p">))</span>
</pre></div>
</div>
<p>... I must say:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">pkg_resources</span> <span class="kn">import</span> <span class="n">Requirement</span><span class="p">,</span> <span class="n">resource_filename</span>
<span class="n">setup_media_link</span><span class="p">(</span><span class="s">&#39;lino&#39;</span><span class="p">,</span><span class="n">source</span><span class="o">=</span><span class="n">resource_filename</span><span class="p">(</span><span class="n">Requirement</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="s">&quot;lino&quot;</span><span class="p">),</span><span class="s">&quot;media&quot;</span><span class="p">))</span>
</pre></div>
</div>
<p>This works on the development server of my machine
where Lino is installed in editable mode using <code class="docutils literal"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">-e</span></code>.
The <cite>resource_filename</cite> function correctly returns the name
of that directory (I added a new INFO message to verify this):</p>
<div class="highlight-python"><div class="highlight"><pre>INFO django.views.static serving /lino from t:\hgwork\lino\media
</pre></div>
</div>
<p>But will it work from a zipped egg?
If <cite>resource_filename</cite> unzips these files to a new temporary directory
each time, then we must expect problems. The development server would
just need longer to start and fill the temporaty folder, but on a
production server Lino creates a symbolic link to that directory,
which is probably not what we want.</p>
<p>Maybe I should leave <cite>zip_safe</cite> to <cite>False</cite> because of this.
Anyway it must remain False as long as the <cite>linoweb.js</cite> file
is being read using <cite>__file__</cite>.</p>
<p>Of course I must also use either specify <cite>package_data</cite>
or <cite>include_package_data</cite>
in <a class="reference external" href="https://github.com/lsaffre/lino/blob/master//lino/setup_info.py">/lino/setup_info.py</a>
so that these files get distributed.</p>
<p><cite>include_package_data</cite> :
if set to True, this tells setuptools to automatically include
any data files it finds inside your package directories, that
are either under CVS or Subversion control, or which are specified
by your MANIFEST.in file.</p>
<p>While working at these things I used the occasion to start splitting
off the ExtJS UI into a separate project.</p>
<p>Once more I removed and replaced the Lino 1.6.2, North 0.0.4 and
djangosite 0.0.4 releases at PyPI.</p>
<p>But when I try this on rose, I get:</p>
<div class="highlight-python"><div class="highlight"><pre>Exception: /home/luc/luc/lib/python2.7/site-packages/media does not exist
</pre></div>
</div>
<p>The media directory with all these files <em>is</em>
contained in the <cite>lino-1.6.2.tar.gz</cite> file,
and the <cite>resource_filename</cite> function <em>did</em>
return a string with a full path,
but obviously there is no such directory
<cite>.../python2.7/site-packages/media</cite>,
and anyway it should be rather
<cite>.../python2.7/site-packages/lino/media</cite>.</p>
<p>Maybe I must use <cite>package_data</cite> instead of <cite>include_package_data</cite>.
Or maybe it&#8217;s enough to just move the <cite>media</cite> directory one level down to <cite>lino</cite> (again).</p>
<p>But stop here now!
A customer is waiting for a Lino-Welfare release,
and I decided to have the eggability problem wait
now until the customer is satisfied.
Lino cannot yet be used from a Python egg because of the above problems.
I updated <a class="reference external" href="http://www.lino-framework.org/tutorials/quickstart.html">/tutorials/quickstart</a> accordingly.</p>
</div>
<div class="section" id="preparing-a-release-for-lino-welfare">
<h2>Preparing a release for Lino-Welfare<a class="headerlink" href="#preparing-a-release-for-lino-welfare" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>Fixed a bug &#8220;global name &#8216;PermissionDenied&#8217; is not defined&#8221;
which occured on demo4</li>
<li>Removed the css style <cite>x-grid3-cell-inner</cite> which defined a hard-coded height of 18px.
So I restored ExtJS&#8217;s default behaviour.
That&#8217;s needed for <code class="xref py py-class docutils literal"><span class="pre">lino_welfare.modlib.jobs.models.NewJobsOverview</span></code>.</li>
</ul>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../index.html">
              <img class="logo" src="../../_static/logo.png" alt="Logo"/>
            </a></p>
<h3><a href="../../index.html">Table Of Contents</a></h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../index.html">Blog</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../about/index.html">About me</a></li>
</ul>

<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script><p align="center">
<a href="https://github.com/lsaffre" target="_blank">GitHub</a>
<br/><a href="http://www.lino-framework.org" target="_blank">Lino</a>
<br/><a href="http://www.saffre-rumma.net" target="_blank">Rumma & Ko</a>
</p>

        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="0315.html" title="20130315 (Friday, 15 March 2013)"
             >next</a> |</li>
        <li class="right" >
          <a href="0313.html" title="20130313 (Wednesday, 13 March 2013)"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Home</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Blog</a> &raquo;</li>
          <li class="nav-item nav-item-2"><a href="index.html" >2013</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">

<a rel="license" href="http://creativecommons.org/licenses/by-sa/2.5/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-sa/2.5/88x31.png" /></a>
This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-sa/2.5/">Creative Commons Attribution-ShareAlike 2.5 Generic License</a>.<br />
      Last updated on 2015-03-31.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.3.
<a href="../../_sources/blog/2013/0314.txt">Show Source</a> 
    <a href="http://luc.lino-framework.org/blog/2013/0314.html">Online Link</a>
    </div>
  </body>
</html>