<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>20131004 (Friday, 04 October 2013) &mdash; Luc&#39;s website</title>
    
    <link rel="stylesheet" href="../../_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/centeredlogo.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/taglist.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/taglist_tags.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/sidebar.js"></script>
    <link rel="search" type="application/opensearchdescription+xml"
          title="Search within Luc&#39;s website"
          href="../../_static/opensearch.xml"/>
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
    <link rel="top" title="Luc&#39;s website" href="../../index.html" />
    <link rel="up" title="2013" href="index.html" />
    <link rel="next" title="20131005 (Saturday, 05 October 2013)" href="1005.html" />
    <link rel="prev" title="20131003 (Thursday, 03 October 2013)" href="1003.html" />
   
<script src="../../.htmldata/lightbox/js/jquery-1.11.0.min.js"></script>
<script src="../../.htmldata/lightbox/js/lightbox.min.js"></script>
<link href="../../.htmldata/lightbox/css/lightbox.css" rel="stylesheet" />

  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="1005.html" title="20131005 (Saturday, 05 October 2013)"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="1003.html" title="20131003 (Thursday, 03 October 2013)"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Home</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Blog</a> &raquo;</li>
          <li class="nav-item nav-item-2"><a href="index.html" accesskey="U">2013</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="friday-04-october-2013">
<h1>20131004 (Friday, 04 October 2013)<a class="headerlink" href="#friday-04-october-2013" title="Permalink to this headline">¶</a></h1>
<div class="section" id="movements">
<h2>Movements<a class="headerlink" href="#movements" title="Permalink to this headline">¶</a></h2>
<p>Added parameters to <a class="reference external" href="http://www.lino-framework.org/api/lino.modlib.ledger.models.html#lino.modlib.ledger.models.Movements" title="(in Lino v1.6)"><code class="xref py py-class docutils literal"><span class="pre">lino.modlib.ledger.models.Movements</span></code></a>.</p>
<p>Discovered a bug : the HTML button didn&#8217;t work because it generated a
wrong url (forgot to adapt this place when I changed the meaning of
<code class="xref std std-setting docutils literal"><span class="pre">plain_prefix</span></code>.</p>
<p>Added new setting <code class="xref std std-setting docutils literal"><span class="pre">start_year</span></code>.</p>
</div>
<div class="section" id="neuzugang-ablehnen-fuhrt-zu-internal-server-error">
<h2>&#8220;Neuzugang ablehnen&#8221; führt zu Internal Server Error<a class="headerlink" href="#neuzugang-ablehnen-fuhrt-zu-internal-server-error" title="Permalink to this headline">¶</a></h2>
<p>Fixed a bug reported by Gerd:</p>
<blockquote>
<div>Man geht bei den Neuzugängen auf Partner 23995 und versucht ihn
abzulehnen ... Paf kommt der Internal Server Error:
Expected a list of 12 values, but got [u&#8216;04.09.2013&#8217;, u&#8217;false&#8217;, u&#8217;false&#8217;, u&#8217;&#8216;]</div></blockquote>
<p>This was quite subtle:</p>
<p>The application code defines that action as follows:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">RefuseClient</span><span class="p">(</span><span class="n">dd</span><span class="o">.</span><span class="n">ChangeStateAction</span><span class="p">):</span>
    <span class="o">...</span>
    <span class="n">label</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s">&quot;Refuse&quot;</span><span class="p">)</span>
    <span class="n">parameters</span> <span class="o">=</span> <span class="o">...</span>
    <span class="o">...</span>

<span class="o">...</span>

<span class="n">ClientStates</span><span class="o">.</span><span class="n">refused</span><span class="o">.</span><span class="n">add_transition</span><span class="p">(</span><span class="n">RefuseClient</span><span class="p">)</span>
</pre></div>
</div>
<p>Since this <a class="reference external" href="http://welfare.lino-framework.org/api/lino_welfare.modlib.pcsw.models.html#lino_welfare.modlib.pcsw.models.RefuseClient" title="(in Lino Welfare Reference Manual v1.1)"><code class="xref py py-class docutils literal"><span class="pre">RefuseClient</span></code></a>
is an action with parameters,
Lino generates a Window to be displayed by the client before actually sending
the AJAX request.
The generated definition of that action looks like this:</p>
<div class="highlight-python"><div class="highlight"><pre>Lino.pcsw.Clients.wf1_ActionFormPanel = Ext.extend(Lino.ActionFormPanel,{
  ...
  action_name: &#39;wf1&#39;,
  ls_url: &quot;/pcsw/Clients&quot;,
  window_title: &quot;Ablehnen&quot;,
  initComponent : function() {
    var containing_panel = this;
    var reason27 = new Lino.ChoicesFieldElement({ &quot;autoHeight&quot;: true, &quot;forceSelection&quot;: true, &quot;fieldLabel&quot;: &quot;reason&quot;, &quot;allowBlank&quot;: false, &quot;hiddenName&quot;: &quot;reasonHidden&quot;, &quot;listeners&quot;: { &quot;render&quot;: Lino.quicktip_renderer(&quot;reason&quot;,&quot;(&lt;RefuseClient wf1 (u&#39;Refuse&#39;)&gt;.reason) &quot;) }, &quot;selectOnFocus&quot;: true, &quot;anchor&quot;: &quot;-20&quot;, &quot;store&quot;: Lino.pcsw.RefusalReasons, &quot;name&quot;: &quot;reason&quot; });
    var remark28 = new Ext.form.TextArea({ &quot;listeners&quot;: { &quot;render&quot;: Lino.quicktip_renderer(&quot;Remark&quot;,&quot;(&lt;RefuseClient wf1 (u&#39;Refuse&#39;)&gt;.remark) &quot;) }, &quot;fieldLabel&quot;: &quot;Bemerkung&quot;, &quot;name&quot;: &quot;remark&quot;, &quot;growMax&quot;: 2000, &quot;selectOnFocus&quot;: true, &quot;anchor&quot;: &quot;-20 -10&quot; });
    this.items = [ { &quot;items&quot;: reason27, &quot;autoHeight&quot;: true, &quot;layout&quot;: &quot;form&quot;, &quot;xtype&quot;: &quot;panel&quot;, &quot;labelAlign&quot;: &quot;top&quot; }, { &quot;items&quot;: remark28, &quot;labelAlign&quot;: &quot;top&quot;, &quot;layout&quot;: &quot;form&quot;, &quot;xtype&quot;: &quot;panel&quot;, &quot;flex&quot;: 83 } ];
    this.fields = [ reason27, remark28 ];
    Lino.pcsw.Clients.wf1_ActionFormPanel.superclass.initComponent.call(this);
  }
});

Lino.pcsw.ClientStates.wf1 = new Lino.WindowAction({ &quot;draggable&quot;: true, &quot;width&quot;: Lino.chars2width(50), &quot;maximizable&quot;: true, &quot;modal&quot;: true, &quot;maximized&quot;: false, &quot;height&quot;: Lino.rows2height(15) },function(){
  var p = { &quot;is_main_window&quot;: true, &quot;hide_top_toolbar&quot;: true };
  return new Lino.pcsw.Clients.wf1_ActionFormPanel({});
});
</pre></div>
</div>
<p>and (when the action is available on a Client) the HTML returned by
<cite>workflow_buttons</cite> contains the following tag</p>
<div class="highlight-python"><div class="highlight"><pre>&lt;a href=&quot;javascript:Lino.pcsw.ClientStates.wf1.run(&amp;quot;ext-comp-1572&amp;quot;,
{ &amp;quot;field_values&amp;quot;: { &amp;quot;reason&amp;quot;: null,
&amp;quot;reasonHidden&amp;quot;: null, &amp;quot;remark&amp;quot;: &amp;quot;&amp;quot; } })&quot;
title=&quot;Diesen Neuantrag ablehnen.&quot;&gt;Ablehnen&lt;/a&gt;&lt;/p&gt;&quot;
</pre></div>
</div>
<p>Okay until now? Anyway this shows we can be glad that Lino does
these things for us, can&#8217;t we?</p>
<p>Now the problem came because that action was available on different tables.
At least on <cite>integ.Clients</cite> and <cite>newcomers.NewClients</cite>.
And fortunately Lino doesn&#8217;t generate a new Lino.ActionFormPanel subclass
for each table.
But note that these two tables have different filter parameters.
And the action correctly sends also the parameter values of that table
when calling the action.
But unfortunately the action used a generated variable (and always
the same) to determine the url of the AJAX call.
It caused <cite>integ.Clients</cite> to parse these parameter values even when the
action was being called from <cite>newcomers.NewClients</cite>.
That was not correct (and correctly caused the internal server error).</p>
<p>The fix seems easy and sympathic because it reduces the generated
JS code. I simply replaced in <a class="reference external" href="http://www.lino-framework.org/ref/javascript.html#xfile-linoweb.js" title="(in Lino v1.6)"><code class="xref std std-xfile docutils literal"><span class="pre">linoweb.js</span></code></a>:</p>
<div class="highlight-python"><div class="highlight"><pre>var url = &#39;{{settings.SITE.build_admin_url(&quot;api&quot;)}}&#39; + this.ls_url + &#39;/&#39; + pk;
</pre></div>
</div>
<p>by:</p>
<div class="highlight-python"><div class="highlight"><pre>var url = &#39;{{settings.SITE.build_admin_url(&quot;api&quot;)}}&#39; + panel.ls_url + &#39;/&#39; + pk;
</pre></div>
</div>
<p>And removed the line which defined <code class="docutils literal"><span class="pre">ls_url</span></code> on the
ActionFormPanel subclass.</p>
<p>This change implies of course the usual risk of side effects...</p>
</div>
<div class="section" id="miscellaneous">
<h2>Miscellaneous<a class="headerlink" href="#miscellaneous" title="Permalink to this headline">¶</a></h2>
<ul>
<li><p class="first">Added a section
<a class="reference external" href="http://welfare-user.lino-framework.org/de/general.html#fehlermeldungen-und-wie-damit-umgehen">Fehlermeldungen und wie damit umgehen</a>
to the welfare userdocs.</p>
</li>
<li><p class="first">The userdocs for <a class="reference external" href="http://welfare.lino-framework.org/index.html#welfare" title="(in Lino Welfare Reference Manual v1.1)"><span>Lino Welfare</span></a> had wrong URLs for
&#8220;Online Link&#8221; and &#8220;Show Source&#8221;.</p>
</li>
<li><p class="first">The <a class="reference external" href="http://faggio.lino-framework.org/index.html#faggio" title="(in Lino Faggio Reference v0.0)"><span>Lino Faggio</span></a> test suite is currently broken, I know it, but
I&#8217;ll first add more demo fixtures before fixing these failures.</p>
</li>
<li><p class="first">The &#8220;(source code)&#8221; link in the API docs didn&#8217;t work. Fixed.</p>
</li>
<li><p class="first">Stumbled over <a class="reference external" href="https://fr.wikibooks.org/wiki/N%C3%A9erlandais_pour_traducteurs_:_les_villes_belges">Néerlandais pour traducteurs : les villes belges</a>,
a collection of Belgian city names in both FR and NL,
and integrated this wisdom into <a class="reference external" href="http://www.lino-framework.org/api/lino.modlib.countries.fixtures.be.html#module-lino.modlib.countries.fixtures.be" title="(in Lino v1.6)"><code class="xref py py-mod docutils literal"><span class="pre">lino.modlib.countries.fixtures.be</span></code></a>.</p>
<p>Noticed then that all this wisdom and more is also in the Wikipedia.
The Wikipedia has the advantage of being well maintained,
but the disadvantage of not being very semantic.
Started a script
<code class="xref py py-mod docutils literal"><span class="pre">wiki2lino</span></code>
which uses BeautyfulSoup to read data from wikipedia
in order inject it into a Lino database.
Not finished.
And anyway: Luc, instead of playing around you should rather do
things for which your customers are waiting, shouldn&#8217;t you!</p>
</li>
</ul>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../index.html">
              <img class="logo" src="../../_static/logo.png" alt="Logo"/>
            </a></p>
<h3><a href="../../index.html">Table Of Contents</a></h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../index.html">Blog</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../about/index.html">About me</a></li>
</ul>

<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script><p align="center">
<a href="https://github.com/lsaffre" target="_blank">GitHub</a>
<br/><a href="http://www.lino-framework.org" target="_blank">Lino</a>
<br/><a href="http://www.saffre-rumma.net" target="_blank">Rumma & Ko</a>
</p>

        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="1005.html" title="20131005 (Saturday, 05 October 2013)"
             >next</a> |</li>
        <li class="right" >
          <a href="1003.html" title="20131003 (Thursday, 03 October 2013)"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Home</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Blog</a> &raquo;</li>
          <li class="nav-item nav-item-2"><a href="index.html" >2013</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">

<a rel="license" href="http://creativecommons.org/licenses/by-sa/2.5/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-sa/2.5/88x31.png" /></a>
This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-sa/2.5/">Creative Commons Attribution-ShareAlike 2.5 Generic License</a>.<br />
      Last updated on 2015-03-31.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.3.
<a href="../../_sources/blog/2013/1004.txt">Show Source</a> 
    <a href="http://luc.lino-framework.org/blog/2013/1004.html">Online Link</a>
    </div>
  </body>
</html>