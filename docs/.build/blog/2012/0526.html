<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>20120526 &mdash; Luc&#39;s website</title>
    
    <link rel="stylesheet" href="../../_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/centeredlogo.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/taglist.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/taglist_tags.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/sidebar.js"></script>
    <link rel="search" type="application/opensearchdescription+xml"
          title="Search within Luc&#39;s website"
          href="../../_static/opensearch.xml"/>
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
    <link rel="top" title="Luc&#39;s website" href="../../index.html" />
    <link rel="up" title="2012" href="index.html" />
    <link rel="next" title="20120527" href="0527.html" />
    <link rel="prev" title="20120525" href="0525.html" />
   
<script src="../../.htmldata/lightbox/js/jquery-1.11.0.min.js"></script>
<script src="../../.htmldata/lightbox/js/lightbox.min.js"></script>
<link href="../../.htmldata/lightbox/css/lightbox.css" rel="stylesheet" />

  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="0527.html" title="20120527"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="0525.html" title="20120525"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Home</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Blog</a> &raquo;</li>
          <li class="nav-item nav-item-2"><a href="index.html" accesskey="U">2012</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="id1">
<h1>20120526<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h1>
<p>Adapted <code class="xref py py-func docutils literal"><span class="pre">migrate_from_1_4_3</span></code></p>
<p>Interessant war die Entscheidung,
wo das Feld <cite>partner</cite> in <cite>users.User</cite> definiert werden soll.</p>
<p>Entweder kann ich es &#8220;von außerhalb&#8221; definieren
(in <a class="reference external" href="http://www.lino-framework.org/api/lino.modlib.contacts.html#module-lino.modlib.contacts" title="(in Lino v1.6)"><code class="xref py py-mod docutils literal"><span class="pre">lino.modlib.contacts</span></code></a>
oder <code class="xref py py-mod docutils literal"><span class="pre">lino.apps.pcsw</span></code>),
indem ich dort <code class="xref py py-func docutils literal"><span class="pre">lino.dd.inject_field()</span></code> aufrufe:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">dd</span><span class="o">.</span><span class="n">inject_field</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">LINO</span><span class="o">.</span><span class="n">user_model</span><span class="p">,</span>
    <span class="s">&#39;partner&#39;</span><span class="p">,</span>
    <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="s">&#39;contacts.Partner&#39;</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span><span class="n">null</span><span class="o">=</span><span class="bp">True</span><span class="p">))</span>
</pre></div>
</div>
<p>Oder ich kann <a class="reference external" href="http://www.lino-framework.org/api/lino.modlib.users.html#module-lino.modlib.users" title="(in Lino v1.6)"><code class="xref py py-mod docutils literal"><span class="pre">lino.modlib.users</span></code></a> erweitern, dass sie es automatisch
einfügt, wenn <cite>contacts</cite> ebenfalls installiert ist. Genau. Das ist besser.</p>
<p>Unter anderem, weil ich dann auch das UserDetail automatisch anpassen kann.
Das ist freilich ziemliche Hackerei, aber wenn&#8217;s ordentlich dokumentiert wäre,
müsste das eigentlich ein schönes Feature sein.</p>
<p>Auf ähnliche Weise würde ich ja gerne auch die diversen UserLevels
automatisch ins Detail einfügen. Aber das macht zumindest für pcsw
keinen Sinn, weil es dort mindestens ein weiteres Feld
gibt (nämlich <cite>quota_nz</cite>), das sich die Zeile mit <cite>newcomers_level</cite>
teilen soll. Wie man <em>das</em> automatisch hinkriegen will,
weiß ich momentan wirklich nicht.</p>
<div class="section" id="miscellaneous">
<h2>Miscellaneous<a class="headerlink" href="#miscellaneous" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>(internal)
<code class="xref py py-class docutils literal"><span class="pre">EmptyTable</span></code>
is now in <cite>mixins</cite>. It cannot be in <code class="xref py py-mod docutils literal"><span class="pre">lino.dd</span></code> because it
needs <a class="reference external" href="http://www.lino-framework.org/api/lino.mixins.printable.html#lino.mixins.printable.DirectPrintAction" title="(in Lino v1.6)"><code class="xref py py-class docutils literal"><span class="pre">lino.mixins.printable.DirectPrintAction</span></code></a>
which itself needs <code class="xref py py-mod docutils literal"><span class="pre">lino.dd</span></code>.
This circular import problem was solved until now using an inner import
(by importing the <cite>DirectPrintAction</cite> during <cite>setup_report</cite>).
This is no longer possible when defining the Action as a class attribute.
Which confirms that changing the action definition syntax was a good step:
if reveals wrong constructs.</li>
<li>Habe weiter in der Test-Suite aufgeräumt.</li>
<li>In <code class="xref py py-class docutils literal"><span class="pre">lino.modlib.courses.models.PendingCourseRequests</span></code> fehlte
noch die Kolonne <cite>address</cite>.</li>
<li>Der Kalender funktionierte ja nicht. Da war in der <cite>linolib.js</cite> ein
Aktionsname <cite>detail</cite> hard codiert, und die haben sich ja verändert
seit ich Aktionen als Klassenattribute definiere.</li>
<li>Cities zeigte kein Detail an.
Das kam, weil collect_actions zu früh (<em>vor</em> den <cite>site_setup</cite>) aufgerufen wurde.
Die entscheidet ja, ob eine <cite>detail_action</cite> erstellt wird. Cities hat par défaut
kein Detail, kriegt aber in <code class="xref py py-func docutils literal"><span class="pre">lino.apps.pcsw.models.site_setup()</span></code> eines verpasst.</li>
</ul>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../index.html">
              <img class="logo" src="../../_static/logo.png" alt="Logo"/>
            </a></p>
<h3><a href="../../index.html">Table Of Contents</a></h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../index.html">Blog</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../about/index.html">About me</a></li>
</ul>

<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script><p align="center">
<a href="https://github.com/lsaffre" target="_blank">GitHub</a>
<br/><a href="http://www.lino-framework.org" target="_blank">Lino</a>
<br/><a href="http://www.saffre-rumma.net" target="_blank">Rumma & Ko</a>
</p>

        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="0527.html" title="20120527"
             >next</a> |</li>
        <li class="right" >
          <a href="0525.html" title="20120525"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Home</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Blog</a> &raquo;</li>
          <li class="nav-item nav-item-2"><a href="index.html" >2012</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2001-2015 Luc Saffre.
      Last updated on 2015-03-31.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.3.
    <a href="https://raw.github.com/lsaffre/blog/master/docs/blog/2012/0526.rst"
           rel="nofollow">Show Source</a>.
    <a href="http://luc.lino-framework.org/blog/2012/0526.html">Online Link</a>
    </div>
  </body>
</html>