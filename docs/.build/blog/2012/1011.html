<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>20121011 &mdash; Luc&#39;s website</title>
    
    <link rel="stylesheet" href="../../_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/centeredlogo.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/taglist.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/taglist_tags.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/sidebar.js"></script>
    <link rel="search" type="application/opensearchdescription+xml"
          title="Search within Luc&#39;s website"
          href="../../_static/opensearch.xml"/>
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
    <link rel="top" title="Luc&#39;s website" href="../../index.html" />
    <link rel="up" title="2012" href="index.html" />
    <link rel="next" title="20121012" href="1012.html" />
    <link rel="prev" title="20121010" href="1010.html" />
   
<script src="../../.htmldata/lightbox/js/jquery-1.11.0.min.js"></script>
<script src="../../.htmldata/lightbox/js/lightbox.min.js"></script>
<link href="../../.htmldata/lightbox/css/lightbox.css" rel="stylesheet" />

  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="1012.html" title="20121012"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="1010.html" title="20121010"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Home</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Blog</a> &raquo;</li>
          <li class="nav-item nav-item-2"><a href="index.html" accesskey="U">2012</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="id1">
<h1>20121011<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h1>
<div class="section" id="nur-ein-clientdetail">
<h2>Nur ein ClientDetail<a class="headerlink" href="#nur-ein-clientdetail" title="Permalink to this headline">¶</a></h2>
<p>Ich habe verstanden, dass die drei &#8220;großen&#8221; Kliententabellen (Allgemein, DSBE und
Neuanträge) <em>nicht</em> jede ihr eigenes Detail haben dürfen. Es ist zu irritierend,
wenn ein DSBE-Benutzer nicht alle Reiter sieht, bloß weil er über die &#8220;falsche&#8221;
Liste auf den Klienten gekommen ist.</p>
<p>In ClientDetail waren noch einige konzeptuelle Mängel:</p>
<ul class="simple">
<li>Reiter &#8220;Begleitungen&#8221; und &#8220;Neuzugänge&#8221; sind jetzt einer.</li>
<li>&#8220;Interim-Agenturen&#8221; und &#8220;Integrationsphase&#8221; wieder zurück in den Reiter &#8220;Status&#8221;</li>
<li>Die Tabelle &#8220;Verfügbare Begleiter&#8221; soll nur Daten enthalten, wenn Stadium &#8220;Begleitet&#8221; ist.</li>
</ul>
</div>
<div class="section" id="arbeitverlauf-klienten">
<h2>Arbeitverlauf Klienten<a class="headerlink" href="#arbeitverlauf-klienten" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>Das Feld <cite>workflow_buttons</cite> (&#8220;Arbeitsverlauf&#8221;) sieht jetzt intuitiver aus.</li>
<li>Im Reiter &#8220;Sonstiges&#8221; kann man jetzt das Stadium eines Klienten manuell verändern.</li>
</ul>
<p>Es gibt noch eine Menge &#8220;Teufel im Detail&#8221; beim Workflow. Hier einige neue Regeln:</p>
<ul class="simple">
<li>Ein Neuantrag kann keine Begleitungen haben.
(Ein Klient mit Begleitungen, selbst abgeschlossene, kann nicht wieder zum Neuantrag werden.
Höchstens zu einem Ehemaligen.)</li>
<li>Wenn ein Klient ins Stadium Ehemalig wechselt, werden automatisch
alle laufenden Begleitungen beendet.
Ein Ehemaliger kann keine <em>laufenden</em> Begleitungen haben.</li>
<li>Nur Benutzer mit einem unleeren Feld
<cite>Begleitungsart (Dienst)</cite> in den Benutzereinstellungen
dürfen manuell Begleitungen erstellen.</li>
<li>Wenn man ein Coaching manuell erstellt,
wird <cite>Beginndatum</cite> aufs Tagesdatum
und <cite>Begleitungsart (Dienst)</cite> auf die des Benutzers ausgefüllt.</li>
</ul>
<p>(Komplette Liste der Regeln sammeln wir unter <a class="reference external" href="http://www.lino-framework.org/user/clients.html">/user/clients</a>)</p>
</div>
<div class="section" id="customizing-create-permissions">
<h2>Customizing create permissions<a class="headerlink" href="#customizing-create-permissions" title="Permalink to this headline">¶</a></h2>
<p>Die Regel &#8220;Nur Benutzer mit einem unleeren Feld
<cite>Begleitungsart (Dienst)</cite> in den Benutzereinstellungen dürfen manuell Begleitungen erstellen.&#8221;
war noch mal wieder was Neues für Lino.</p>
<p>Actor.create_required war unnütz und fliegt raus.
Dafür haben wir jetzt <a class="reference external" href="http://www.lino-framework.org/api/lino.core.actors.html#lino.core.actors.Actor.get_create_permission" title="(in Lino v1.6)"><code class="xref py py-meth docutils literal"><span class="pre">lino.core.actors.Actor.get_create_permission()</span></code></a></p>
</div>
<div class="section" id="interdependenz-von-modulen">
<h2>Interdependenz von Modulen<a class="headerlink" href="#interdependenz-von-modulen" title="Permalink to this headline">¶</a></h2>
<p>Durch obige Änderung musste ich mir folgende Gedanken machen.</p>
<p>Um zirkuläre oder partielle Imports zu
vermeiden, muss man sich über die <strong>Hierarchie</strong> der Module im Klaren sein.</p>
<p>Ein partieller Import wird von Python nicht als Fehler gewertet
und kann gerade deshalb zu verwirrenden und schwer kapierbaren
Nebenwirkungen führen.</p>
<p>Faustregel: In einem Django-Projekt sollten die <cite>modules</cite>-Module
der installierten Anwendungen (<a class="reference external" href="http://www.lino-framework.org/ref/settings.html#setting-INSTALLED_APPS" title="(in Lino v1.6)"><code class="xref std std-setting docutils literal"><span class="pre">INSTALLED_APPS</span></code></a>)
sich nicht beidseitig importieren, weil das zu partiellen Imports führt,
und die bringen Django durcheinander.
Zum Beispiel das gestern beobachtete
Problem der verfälschten Ausführungsreihenfolge
beim loaddata der fixtures kam
daher, dass <cite>pcsw</cite> und <cite>newcomers</cite> sich gegenseitig importierten.</p>
<p><cite>pcsw</cite> ist das &#8220;Hauptmodul&#8221; in <cite>lino-welfare</cite> und
darf deshalb die anderen Module (<cite>newcomers</cite>) nicht importieren.</p>
<p class="graphviz">
<img src="../../_images/graphviz-51e1c05bfbcd0bf5b8d8e568ea8e0ead7b9172ef.png" alt="digraph foo {


   newcomers -&gt; pcsw;
   debts -&gt; pcsw;
   courses -&gt; pcsw;

   isip -&gt; pcsw;

   jobs -&gt; pcsw;

   jobs -&gt; isip;

}" />
</p>
<p>Oder wenn ich die modlib-Module mit reinnehme:</p>
<p class="graphviz">
<img src="../../_images/graphviz-e49b2be270dca106ce3ace5b333489fb090de809.png" alt="digraph foo {


   subgraph cluster_modlib {
     label = &quot;lino.modlib&quot;;
     outbox contacts notes uploads households accounts cal countries properties postings;
   }

   subgraph cluster_welfare {
     label = &quot;lino_welfare&quot;;
     pcsw newcomers debts isip jobs courses;
   }

   households -&gt; contacts;
   pcsw -&gt; contacts;
   pcsw -&gt; notes;
   pcsw -&gt; uploads;
   pcsw -&gt; households;

   newcomers -&gt; pcsw ;
   newcomers -&gt; outbox;


   debts -&gt; pcsw;
   debts -&gt; accounts;
   debts -&gt; households;
   debts -&gt; properties;

   courses -&gt; pcsw ;

   isip -&gt; pcsw ;
   isip -&gt; cal ;

   cal -&gt; contacts;
   cal -&gt; postings;
   cal -&gt; outbox;
   jobs -&gt; contacts;
   jobs -&gt; properties;
   jobs -&gt; countries;
   contacts -&gt; countries;
   jobs -&gt; isip;
   jobs -&gt; pcsw;

   overlap=false;
}" />
</p>
</div>
<div class="section" id="miscellaneous">
<h2>Miscellaneous<a class="headerlink" href="#miscellaneous" title="Permalink to this headline">¶</a></h2>
<ul>
<li><p class="first">Das Speichern von eigenen Einstellungen ging nicht:</p>
<div class="highlight-python"><div class="highlight"><pre>Http404
users.MySettings has no url action u&#39;&#39;
TRACEBACK:
  ...
  File &quot;t:\hgwork\lino\lino\ui\extjs3\views.py&quot;, line 789, in put
    ar = action_request(app_label,actor,request,data)
  File &quot;t:\hgwork\lino\lino\ui\extjs3\views.py&quot;, line 92, in action_request
    raise http.Http404(&quot;%s has no url action %r&quot; % (rpt,action_name))
</pre></div>
</div>
<p>Das war ein Bug im JS-Code: <cite>FormPanel.save()</cite> setzte URL_PARAM_ACTION_NAME auch dann wenn es leer war.</p>
</li>
<li><p class="first">FieldSets haben neuerdings keinen Rahmen mehr. Habe noch nicht rausgefunden, woran das liegt.</p>
</li>
<li><p class="first">In <cite>ext_ui</cite> war der folgende Code:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">if</span> <span class="n">de</span><span class="o">.</span><span class="n">slave_grid_format</span> <span class="o">==</span> <span class="s">&#39;grid&#39;</span><span class="p">:</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">de</span><span class="o">.</span><span class="n">parameters</span><span class="p">:</span>
        <span class="n">kw</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">hide_top_toolbar</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">e</span> <span class="o">=</span> <span class="n">ext_elems</span><span class="o">.</span><span class="n">GridElement</span><span class="p">(</span><span class="n">lh</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="n">de</span><span class="p">,</span><span class="o">**</span><span class="n">kw</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">e</span>
</pre></div>
</div>
<p>Da wurde also die topToolbar von slave grids <em>nicht</em> wie üblich deaktiviert,
wenn die Tabelle Paremter hatte. Aber dann waren die Parameter doch nicht nutzbar,
weil das [Parameter]-Panel nur in einem main_item existiert. Also weg damit.
hide_top_toolbar wird immer auf True gesetzt.
(Irgendwann wird es eine Kundenanfrage geben, dass man in gewissen explizit angegebenen
slavegrids die topToolbar doch haben will (z.B. wenn es die einzige Tabelle ist),
aber das ist was anderes, da lass ich momentan noch die Finger von)</p>
</li>
</ul>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../index.html">
              <img class="logo" src="../../_static/logo.png" alt="Logo"/>
            </a></p>
<h3><a href="../../index.html">Table Of Contents</a></h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../index.html">Blog</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../about/index.html">About me</a></li>
</ul>

<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script><p align="center">
<a href="https://github.com/lsaffre" target="_blank">GitHub</a>
<br/><a href="http://www.lino-framework.org" target="_blank">Lino</a>
<br/><a href="http://www.saffre-rumma.net" target="_blank">Rumma & Ko</a>
</p>

        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="1012.html" title="20121012"
             >next</a> |</li>
        <li class="right" >
          <a href="1010.html" title="20121010"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Home</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Blog</a> &raquo;</li>
          <li class="nav-item nav-item-2"><a href="index.html" >2012</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">

<a rel="license" href="http://creativecommons.org/licenses/by-sa/2.5/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-sa/2.5/88x31.png" /></a>
This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-sa/2.5/">Creative Commons Attribution-ShareAlike 2.5 Generic License</a>.<br />
      Last updated on 2015-03-31.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.3.
<a href="../../_sources/blog/2012/1011.txt">Show Source</a> 
    <a href="http://luc.lino-framework.org/blog/2012/1011.html">Online Link</a>
    </div>
  </body>
</html>