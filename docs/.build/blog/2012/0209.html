<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>20120209 &mdash; Luc&#39;s website</title>
    
    <link rel="stylesheet" href="../../_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/centeredlogo.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/taglist.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/taglist_tags.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/sidebar.js"></script>
    <link rel="search" type="application/opensearchdescription+xml"
          title="Search within Luc&#39;s website"
          href="../../_static/opensearch.xml"/>
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
    <link rel="top" title="Luc&#39;s website" href="../../index.html" />
    <link rel="up" title="2012" href="index.html" />
    <link rel="next" title="20120210" href="0210.html" />
    <link rel="prev" title="20120208" href="0208.html" />
   
<script src="../../.htmldata/lightbox/js/jquery-1.11.0.min.js"></script>
<script src="../../.htmldata/lightbox/js/lightbox.min.js"></script>
<link href="../../.htmldata/lightbox/css/lightbox.css" rel="stylesheet" />

  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="0210.html" title="20120210"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="0208.html" title="20120208"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Home</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Blog</a> &raquo;</li>
          <li class="nav-item nav-item-2"><a href="index.html" accesskey="U">2012</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="id1">
<h1>20120209<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h1>
<div class="section" id="probleme-mit-komplexer-json-response">
<h2>Probleme mit komplexer JSON-Response<a class="headerlink" href="#probleme-mit-komplexer-json-response" title="Permalink to this headline">¶</a></h2>
<p>Weiter mit dem Problem von <a class="reference external" href="http://www.lino-framework.org0208.html">gestern</a>.
Das Ganze hängt in der Tat damit zusammen,
dass es sich um die Antwort auf einen file upload handelt.</p>
<p>Im Fall eines Dateiuploads funktioniert eine ExtJS-Form anders als
normal: &#8220;File uploads are not performed using Ajax submission,
that is they are not performed using XMLHttpRequests. (...)
If the server is using JSON to send the return object, then
the Content-Type header must be set to &#8220;text/html&#8221; in order
to tell the browser to insert the text unchanged into the
document body.&#8221;
(<a class="reference external" href="http://docs.sencha.com/ext-js/3-4/#!/api/Ext.form.BasicForm">http://docs.sencha.com/ext-js/3-4/#!/api/Ext.form.BasicForm</a>)</p>
<p>Aber den Awesome Uploader zu benutzen, der mit richtigen XMLHttpRequests
arbeitet,
scheint mir weiterhin viel Aufwand für wenig Nutzen.
(Wie viel Aufwand es wäre, kann ich momentan nicht genau abschätzen,
aber es könnten einige Teufel im Detail stecken.)
Und zumindest in unserer momentanen Sicht der Dinge brauchen wir keinen multiple
file upload, weil die Benutzer sowieso pro Datei diverse Metadaten angeben sollen
(Upload-Art, Gültig bis, Person).
Der einzige Vorteil wäre, dass man während des Dateitransfers
weiter im Formular eingeben kann.</p>
<p>Nach einigem Surfen
(<a class="reference external" href="http://loianegroner.com/2010/03/ajax-file-upload-with-extjs-and-spring-framework/">1</a>
<a class="reference external" href="http://dev.sencha.com/deploy/ext-4.0.0/examples/form/file-upload.html">2</a>
<a class="reference external" href="http://superdit.com/2010/07/17/extjs-basic-multiple-file-upload/">3</a>)
und Probieren scheint mir
momentan folgende Knubbelslösung die Sinnvollste:
der Lino-Server antwortet auf ein &#8220;normales&#8221; mit einem
vollen <cite>data_record</cite> in der JSON-Antwort (die jetzt auch den
offiziellen content type &#8216;application/json&#8217; hat),
und nur in der Antwort auf ein POST mit file upload
benutzt er <cite>record_id</cite> und den content type &#8216;text/html&#8217;.</p>
<p>N.B.: Noch was Schönes (aber nur von intern):
<code class="xref py py-class docutils literal"><span class="pre">lino.ui.extjs3.ext_store.Store</span></code> speichert die
erstellten <code class="xref py py-class docutils literal"><span class="pre">Atomizer</span></code>
jetzt nicht mehr temporär für sich selber, sondern im Feld
unter einem Attribut <cite>_lino_atomizer</cite>. Also mehrere Stores auf dem
gleichen Modell benutzen die gleichen Atomizer.</p>
</div>
<div class="section" id="speichern-eines-uploads">
<h2>Speichern eines Uploads<a class="headerlink" href="#speichern-eines-uploads" title="Permalink to this headline">¶</a></h2>
<p>Beim Speichern eines Uploads mit ausgefülltem :guilabel`Gültig bis`
kam ein Server-Traceback
&#8220;&#8216;alarm_value&#8217; is an invalid keyword argument for this function&#8221;.</p>
<p>Außerdem waren die Erinnerungsmeldungen &#8220;eID-Karte läuft ab&#8221; ein
bisschen unkomplett: sie gaben nicht an, <em>wann</em> das passiert.
Jetzt lautet der automatische Text &#8220;eID-Karte läuft ab in 2 Monaten&#8221;.</p>
<p>Neue Funktion <a class="reference external" href="http://www.lino-framework.org/api/lino.modlib.cal.utils.html#lino.modlib.cal.utils.update_reminder" title="(in Lino v1.6)"><code class="xref py py-func docutils literal"><span class="pre">lino.modlib.cal.utils.update_reminder()</span></code></a></p>
<p>Neue Funktion <code class="xref py py-func docutils literal"><span class="pre">lino.apps.pcsw.models.update_all_reminders()</span></code></p>
<p>Neuer Button &#8220;Update reminders&#8221; pro User.</p>
<p>Der Lino-Kernel führt jetzt gegen Ende des startups eine eventuelle
Funktion <cite>site_setup</cite> aus. Dadurch kann das cal-Modul in der Users-Tabelle
seinen Button &#8220;Update reminders&#8221; hinzufügen.</p>
<p>Cool! Aber das alles ist erst fast fertig.
Checkin wegen Feierabend um 22.50 Uhr.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../index.html">
              <img class="logo" src="../../_static/logo.png" alt="Logo"/>
            </a></p>
<h3><a href="../../index.html">Table Of Contents</a></h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../index.html">Blog</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../about/index.html">About me</a></li>
</ul>

<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script><p align="center">
<a href="https://github.com/lsaffre" target="_blank">GitHub</a>
<br/><a href="http://www.lino-framework.org" target="_blank">Lino</a>
<br/><a href="http://www.saffre-rumma.net" target="_blank">Rumma & Ko</a>
</p>

        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="0210.html" title="20120210"
             >next</a> |</li>
        <li class="right" >
          <a href="0208.html" title="20120208"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Home</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Blog</a> &raquo;</li>
          <li class="nav-item nav-item-2"><a href="index.html" >2012</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">

<a rel="license" href="http://creativecommons.org/licenses/by-sa/2.5/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-sa/2.5/88x31.png" /></a>
This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-sa/2.5/">Creative Commons Attribution-ShareAlike 2.5 Generic License</a>.<br />
      Last updated on 2015-03-31.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.3.
<a href="../../_sources/blog/2012/0209.txt">Show Source</a> 
    <a href="http://luc.lino-framework.org/blog/2012/0209.html">Online Link</a>
    </div>
  </body>
</html>