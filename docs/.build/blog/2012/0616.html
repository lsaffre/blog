<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>20120616 &mdash; Luc&#39;s website</title>
    
    <link rel="stylesheet" href="../../_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/centeredlogo.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/taglist.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/taglist_tags.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/sidebar.js"></script>
    <link rel="search" type="application/opensearchdescription+xml"
          title="Search within Luc&#39;s website"
          href="../../_static/opensearch.xml"/>
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
    <link rel="top" title="Luc&#39;s website" href="../../index.html" />
    <link rel="up" title="2012" href="index.html" />
    <link rel="next" title="20120618" href="0618.html" />
    <link rel="prev" title="20120615" href="0615.html" />
   
<script src="../../.htmldata/lightbox/js/jquery-1.11.0.min.js"></script>
<script src="../../.htmldata/lightbox/js/lightbox.min.js"></script>
<link href="../../.htmldata/lightbox/css/lightbox.css" rel="stylesheet" />

  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="0618.html" title="20120618"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="0615.html" title="20120615"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Home</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Blog</a> &raquo;</li>
          <li class="nav-item nav-item-2"><a href="index.html" accesskey="U">2012</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="id1">
<h1>20120616<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h1>
<p>Zum Thema &#8220;Workflows&#8221;.
Darunter verstehen wir die Möglichkeit,
dass der Systemverwalter per UI eine
Liste von lokal konfigurierbaren &#8220;Statuswechsel-Aktionen&#8221;
verwaltet.
Eine Tabelle, die besagt: &#8220;Wer was wann klicken darf&#8221;.</p>
<p>Eine Workflow-Aktion (kurz Workflow) tut zunächst mal nichts anderes,
als den Status eines Objekts zu wechseln.
Wie das Objekt auf einen Statuswechsel reagiert
(also was daraufhin eventuell noch alles tut),
das ist anwendungsspezifisch und Programmierersache
(d.h. dazu muss man Python-Code schreiben).</p>
<p>Der Benutzer sieht die Workflows eines Objekts
als eine (virtuelle) Kolonne, deren Inhalt eine Serie
von anklickbaren Buttons ist.
In dieser Liste stehen natürlich nur die Workflows, die der ausführen darf.
Sie ist dynamisch und hängt vom aktuellen Status des Objekts ab.</p>
<div class="section" id="workflows-aktionen">
<h2>Workflows-Aktionen<a class="headerlink" href="#workflows-aktionen" title="Permalink to this headline">¶</a></h2>
<table border="1" class="docutils">
<colgroup>
<col width="13%" />
<col width="30%" />
<col width="17%" />
<col width="19%" />
<col width="20%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Modell</th>
<th class="head">Bezeichnung</th>
<th class="head">Wer darf</th>
<th class="head">Status vorher</th>
<th class="head">Status nachher</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>cal.Task</td>
<td>Erledigt</td>
<td>Eigentümer</td>
<td>todo</td>
<td>done</td>
</tr>
<tr class="row-odd"><td>cal.Task</td>
<td>Zurück</td>
<td>Dienstleiter</td>
<td>done</td>
<td>todo</td>
</tr>
<tr class="row-even"><td>cal.Event</td>
<td>Einladungen schicken</td>
<td>Eigentümer</td>
<td>geplant</td>
<td>scheduled</td>
</tr>
<tr class="row-odd"><td>cal.Event</td>
<td>Absagen</td>
<td>Eigentümer</td>
<td>geplant</td>
<td>cancelled</td>
</tr>
<tr class="row-even"><td>cal.Event</td>
<td>Stattgefunden</td>
<td>Eigentümer</td>
<td>geplant</td>
<td>stattgefunden</td>
</tr>
<tr class="row-odd"><td>cal.Event</td>
<td>Abgesagt</td>
<td>Eigentümer</td>
<td>geplant</td>
<td>cancelled</td>
</tr>
<tr class="row-even"><td>cal.Event</td>
<td>Bericht verfassen</td>
<td>Alle</td>
<td>stattgefunden</td>
<td>bericht</td>
</tr>
<tr class="row-odd"><td>cal.Event</td>
<td>Bericht verfassen</td>
<td>Eigentümer</td>
<td>stattgefunden</td>
<td>done</td>
</tr>
</tbody>
</table>
<p>&#8220;Wer darf&#8221; ist eigentlich eine Kombination von drei Feldern:</p>
<ul class="simple">
<li>user_level : man muss mindestens diesen Benutzerlevel haben</li>
<li>user_groups : man muss mindestens einer dieser Gruppen angehören</li>
<li>owned_only : falls angekreuzt, gilt diese Aktion nur für
&#8220;meine&#8221; Objekte (Datensätze)</li>
</ul>
<p>Die Auswahlliste der möglichen Zustände (Statusse)
ist ebenfalls anwendungsspezifisch, aber Programmierersache
(d.h. dazu muss man Python-Code schreiben).</p>
<p>Entwurf Modell:</p>
<div class="highlight-python"><div class="highlight"><pre>from lino.utils import ViewPermission

class Workflow(babel.BabelNamed,mixins.Sequenced):
    class Meta:
        sort_order = [&#39;content_type&#39;,&#39;seqno&#39;]

    content_type = ForeignKey(ContentType)
    user_level = UserLevel.field()
    user_groups = CharField
    owned_only = BooleanField
    from_state = CharField
    to_state = CharField

    def get_permission(self,user):
        vp = ViewPermission(required_user_level=self.user_level,
          required_user_groups=self.user_groups.split())
        return vp.get_view_permission(user)



class Workflowable(models.Model):
    class Meta:
        abstract = True

    workflow_state_field = &#39;state&#39; # subclasses usually override this

    @dd.displayfield
    def workflows(self,ar):
        ct = ContentType.objects.get_for_model(self.__class__)
        for wf in Workflow.objects.filter(content_type=ct):
            if wf.get_permission(ar.get_user())
</pre></div>
</div>
</div>
<div class="section" id="status-or-state">
<h2>&#8220;Status&#8221; or &#8220;State&#8221;?<a class="headerlink" href="#status-or-state" title="Permalink to this headline">¶</a></h2>
<p>The <a class="reference external" href="http://plone.org/documentation/kb/creating-workflows-in-plone/introduction">Introduction to Plone workflows</a>
speaks about &#8220;states&#8221; and never uses the word &#8220;status&#8221;.
I am rather used to call it a &#8220;status&#8221;.
Who&#8217;s right?</p>
<ul class="simple">
<li>&#8220;a state is any condition which is durable or lasting (Zustand, Istzustand)
whereas a status is a classification of state among several
well-defined possibilities.
An immigrant&#8217;s status is either legal or illegal,
and if he is the latter, he may be in an anxious emotional state.&#8221;
(konungursvia on <a class="reference external" href="http://forum.wordreference.com/showthread.php?t=287984&amp;langid=3">wordreference.com</a></li>
<li>&#8220;State generally refers to the entire state of an entity - all its values
and relationships at a particular point in time (usually, current).
Status is more of a time-point, say, where something is at in a process
or workflow - is it dirty (therefore requiring saving), is it complete,
is it pending input, etc&#8221;
(Luke Schafer on <a class="reference external" href="http://stackoverflow.com/questions/1162816/naming-conventions-state-versus-status">stackoverflow</a>)</li>
</ul>
<p>Conclusion for Lino.
I suggest to adapt the following convention:
use &#8220;state&#8221; at least when this field is being used as workflow selector.
The default value for <code class="xref py py-attr docutils literal"><span class="pre">lino.models.Workflowable.workflow_state_field</span></code>).</p>
</div>
<div class="section" id="changes-in-lino-modlib-cal">
<h2>Changes in <a class="reference external" href="http://www.lino-framework.org/api/lino.modlib.cal.html#module-lino.modlib.cal" title="(in Lino v1.6)"><code class="xref py py-mod docutils literal"><span class="pre">lino.modlib.cal</span></code></a><a class="headerlink" href="#changes-in-lino-modlib-cal" title="Permalink to this headline">¶</a></h2>
<p>Replaced the models
GuestStatus, TaskStatus and EventStatus
by the choicelists GuestState, TaskState and EventState.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../index.html">
              <img class="logo" src="../../_static/logo.png" alt="Logo"/>
            </a></p>
<h3><a href="../../index.html">Table Of Contents</a></h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../index.html">Blog</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../about/index.html">About me</a></li>
</ul>

<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script><p align="center">
<a href="https://github.com/lsaffre" target="_blank">GitHub</a>
<br/><a href="http://www.lino-framework.org" target="_blank">Lino</a>
<br/><a href="http://www.saffre-rumma.net" target="_blank">Rumma & Ko</a>
</p>

        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="0618.html" title="20120618"
             >next</a> |</li>
        <li class="right" >
          <a href="0615.html" title="20120615"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Home</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Blog</a> &raquo;</li>
          <li class="nav-item nav-item-2"><a href="index.html" >2012</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">

<a rel="license" href="http://creativecommons.org/licenses/by-sa/2.5/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-sa/2.5/88x31.png" /></a>
This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-sa/2.5/">Creative Commons Attribution-ShareAlike 2.5 Generic License</a>.<br />
      Last updated on 2015-03-31.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.3.
<a href="../../_sources/blog/2012/0616.txt">Show Source</a> 
    <a href="http://luc.lino-framework.org/blog/2012/0616.html">Online Link</a>
    </div>
  </body>
</html>