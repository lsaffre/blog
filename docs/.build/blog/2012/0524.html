<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>20120524 &mdash; Luc&#39;s website</title>
    
    <link rel="stylesheet" href="../../_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/centeredlogo.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/taglist.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/taglist_tags.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/sidebar.js"></script>
    <link rel="search" type="application/opensearchdescription+xml"
          title="Search within Luc&#39;s website"
          href="../../_static/opensearch.xml"/>
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
    <link rel="top" title="Luc&#39;s website" href="../../index.html" />
    <link rel="up" title="2012" href="index.html" />
    <link rel="next" title="20120525" href="0525.html" />
    <link rel="prev" title="20120523" href="0523.html" />
   
<script src="../../.htmldata/lightbox/js/jquery-1.11.0.min.js"></script>
<script src="../../.htmldata/lightbox/js/lightbox.min.js"></script>
<link href="../../.htmldata/lightbox/css/lightbox.css" rel="stylesheet" />

  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="0525.html" title="20120525"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="0523.html" title="20120523"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Home</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Blog</a> &raquo;</li>
          <li class="nav-item nav-item-2"><a href="index.html" accesskey="U">2012</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="id1">
<h1>20120524<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h1>
<div class="section" id="defining-row-actions">
<h2>Defining row actions<a class="headerlink" href="#defining-row-actions" title="Permalink to this headline">¶</a></h2>
<p>Ich hatte gestern &#8220;aus Versehen&#8221; begonnen,
am neuen Feature &#8220;Workflows&#8221; zu arbeiten.</p>
<p>Das (hoffentlich) einzig Schwierige daran ist jetzt geschafft:
dass man Aktionen einfacher definieren kann in Form
von Klassenmethoden mit dem Dekorator <cite>&#64;action</cite>.</p>
<p>Knapp 8 Stunden hat die Operation gedauert.
War etwas schwieriger als ich geahnt hatte.
Lino ist jetzt wieder &#8220;auf den Beinen, aber noch etwas geschwächt&#8221;:
die meisten Sachen funktionieren wieder,
aber wahrscheinlich sind noch ein paar Bugs auszubügeln.</p>
<p><a class="reference external" href="http://code.google.com/p/lino/source/detail?r=631cc40f83eb">Checkin 631cc40f83eb</a>.</p>
<p>Diese Änderung hatte ich mir schon seit Längerem gewünscht,
denn das bisherige System war wirklich nicht schön.
Ich hatte es zurückgestellt, weil es keinen konkreten Bedarf gab.
Aber die Workflows wären nicht sehr überzeugend ohne diese Änderung.</p>
<p>Angesichts der Buggefahr und der Tatsache, dass das jetzt eigentlich
nicht so dringend war, war das nochmal wieder einer jener
&#8220;Nebensprünge aufgrund spontaner Eingebungen&#8221;,
die in einem größeren Team unmöglich wären,
aber die ich mir als Einzelprogrammierer glücklicherweise
erlauben darf.</p>
<p>Jedenfalls bin ich begeistert, wie schön Lino dadurch
geworden ist (an dieser Stelle, die bisher noch nicht schön war).
Bisher musste man einfache Aktionen wie folgt definieren:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">UnregisterCandidate</span><span class="p">(</span><span class="n">dd</span><span class="o">.</span><span class="n">RowAction</span><span class="p">):</span>
    <span class="n">label</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s">&quot;Unregister&quot;</span><span class="p">)</span>
    <span class="n">url_action_name</span> <span class="o">=</span> <span class="s">&quot;unregister&quot;</span>
    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">ar</span><span class="p">,</span><span class="n">elem</span><span class="p">):</span>
        <span class="n">course</span> <span class="o">=</span> <span class="n">elem</span><span class="o">.</span><span class="n">course</span>
        <span class="n">elem</span><span class="o">.</span><span class="n">course</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">elem</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">ar</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">success_response</span><span class="p">(</span><span class="n">refresh_all</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
          <span class="n">message</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%(person)s</span><span class="s"> has been unregistered from </span><span class="si">%(course)s</span><span class="s">&quot;</span><span class="p">)</span>
            <span class="o">%</span> <span class="nb">dict</span><span class="p">(</span><span class="n">person</span><span class="o">=</span><span class="n">elem</span><span class="o">.</span><span class="n">person</span><span class="p">,</span><span class="n">course</span><span class="o">=</span><span class="n">course</span><span class="p">))</span>

<span class="k">class</span> <span class="nc">ParticipantsByCourse</span><span class="p">(</span><span class="n">RequestsByCourse</span><span class="p">):</span>
    <span class="o">...</span>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">setup_actions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_action</span><span class="p">(</span><span class="n">UnregisterCandidate</span><span class="p">())</span>
</pre></div>
</div>
<p>Jetzt schreibt man einfach:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="nd">@dd.action</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s">&quot;Unregister&quot;</span><span class="p">))</span>
<span class="k">def</span> <span class="nf">unregister</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">ar</span><span class="p">,</span><span class="n">elem</span><span class="p">):</span>
    <span class="n">course</span> <span class="o">=</span> <span class="n">elem</span><span class="o">.</span><span class="n">course</span>
    <span class="n">elem</span><span class="o">.</span><span class="n">course</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">elem</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">ar</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">success_response</span><span class="p">(</span><span class="n">refresh_all</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
      <span class="n">message</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%(person)s</span><span class="s"> has been unregistered from </span><span class="si">%(course)s</span><span class="s">&quot;</span><span class="p">)</span>
        <span class="o">%</span> <span class="nb">dict</span><span class="p">(</span><span class="n">person</span><span class="o">=</span><span class="n">elem</span><span class="o">.</span><span class="n">person</span><span class="p">,</span><span class="n">course</span><span class="o">=</span><span class="n">course</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="section" id="cbss-connection">
<h2>CBSS connection<a class="headerlink" href="#cbss-connection" title="Permalink to this headline">¶</a></h2>
<p>Worked 4 more hours on the CBSS test suite.
Got a first real ManageAccessRequest done.</p>
<p>TODO:
When a person is already integrated and i issue another request
to integrate her for the same period, then he answers as for a
listing action instead of saying &#8220;The expected mandatory argument
is not provided or empty.&#8221;
In general it&#8217;s tricky to write a test suite for a system about
which i know so little and which i&#8217;m just didscovering.
Learning by doing!</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../index.html">
              <img class="logo" src="../../_static/logo.png" alt="Logo"/>
            </a></p>
<h3><a href="../../index.html">Table Of Contents</a></h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../index.html">Blog</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../about/index.html">About me</a></li>
</ul>

<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script><p align="center">
<a href="https://github.com/lsaffre" target="_blank">GitHub</a>
<br/><a href="http://www.lino-framework.org" target="_blank">Lino</a>
<br/><a href="http://www.saffre-rumma.net" target="_blank">Rumma & Ko</a>
</p>

        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="0525.html" title="20120525"
             >next</a> |</li>
        <li class="right" >
          <a href="0523.html" title="20120523"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Home</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Blog</a> &raquo;</li>
          <li class="nav-item nav-item-2"><a href="index.html" >2012</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2001-2015 Luc Saffre.
      Last updated on 2015-03-31.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.3.
    <a href="https://raw.github.com/lsaffre/blog/master/docs/blog/2012/0524.rst"
           rel="nofollow">Show Source</a>.
    <a href="http://luc.lino-framework.org/blog/2012/0524.html">Online Link</a>
    </div>
  </body>
</html>