<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>20120525 &mdash; Luc&#39;s website</title>
    
    <link rel="stylesheet" href="../../_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/centeredlogo.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/taglist.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/taglist_tags.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/sidebar.js"></script>
    <link rel="search" type="application/opensearchdescription+xml"
          title="Search within Luc&#39;s website"
          href="../../_static/opensearch.xml"/>
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
    <link rel="top" title="Luc&#39;s website" href="../../index.html" />
    <link rel="up" title="2012" href="index.html" />
    <link rel="next" title="20120526" href="0526.html" />
    <link rel="prev" title="20120524" href="0524.html" />
   
<script src="../../.htmldata/lightbox/js/jquery-1.11.0.min.js"></script>
<script src="../../.htmldata/lightbox/js/lightbox.min.js"></script>
<link href="../../.htmldata/lightbox/css/lightbox.css" rel="stylesheet" />

  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="0526.html" title="20120526"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="0524.html" title="20120524"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Home</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Blog</a> &raquo;</li>
          <li class="nav-item nav-item-2"><a href="index.html" accesskey="U">2012</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="id1">
<h1>20120525<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h1>
<p>Weiter mit der CBSS Connection.</p>
<p>Added user group &#8220;cbss&#8221;.</p>
<p>Um den Reiter &#8220;CBSS&#8221; für Unbefugte verschwinden zu lassen,
musste ich noch was weiter ausholen als vor kurzem für den Reiter &#8220;Debts&#8221;.</p>
<p>Der Reiter &#8220;Debts&#8221; war ein Reiter mit einem einzigen
<code class="xref py py-class docutils literal"><span class="pre">GridPanel</span></code>.
Ein GridPanel kennt seinen actor und kann <cite>get_view_permission</cite>
an diesen weiterleiten.</p>
<p>Aber jetzt musste ich <a class="reference external" href="http://www.lino-framework.org/api/lino.core.actors.html#lino.core.actors.Actor.add_detail_tab" title="(in Lino v1.6)"><code class="xref py py-meth docutils literal"><span class="pre">lino.core.actors.Actor.add_detail_tab()</span></code></a>
erweitern, so dass <code class="xref py py-func docutils literal"><span class="pre">lino.modlib.cbss.models.site_setup()</span></code>
dort <cite>required_user_groups=[&#8216;cbss&#8217;]</cite> angegeben kann.
Funktioniert super.</p>
<p>Hat wohl auch knapp zwei Stunden Fehlersuche gekostet,
weil ich dabei in eine subtile Mausefalle geraten war:
<a class="reference external" href="http://www.lino-framework.org/api/lino.core.actors.html#lino.core.actors.Actor.get_view_permission" title="(in Lino v1.6)"><code class="xref py py-meth docutils literal"><span class="pre">Actor.get_view_permission</span></code></a>
und <code class="xref py py-meth docutils literal"><span class="pre">Component.get_view_permission</span></code>
tun beide genau
das Gleiche, deshalb hatte ich sie in eine
gemeinsame Klasse ViewPermission gesetzt,
die außerdem die beiden Klassenvariablen
<cite>required_user_level</cite> und <cite>required_user_group</cite> definiert.
Was ich übersehen hatte, war dass <cite>get_view_permission</cite>
für Actor eine &#64;classmethod sein muss, für Component dagegen eine Instanzmethode!</p>
<div class="section" id="user-sind-keine-partner">
<h2>User sind keine Partner<a class="headerlink" href="#user-sind-keine-partner" title="Permalink to this headline">¶</a></h2>
<p>Bisher war <code class="xref py py-class docutils literal"><span class="pre">users.User</span></code> eine MTI-Unterklasse von <code class="xref py py-class docutils literal"><span class="pre">contacts.Partner</span></code>.
Aber ich habe erkannt, dass das nicht so gut war:</p>
<ul class="simple">
<li>erstens war <a class="reference external" href="http://www.lino-framework.org/api/lino.modlib.users.html#module-lino.modlib.users" title="(in Lino v1.6)"><code class="xref py py-mod docutils literal"><span class="pre">lino.modlib.users</span></code></a> dadurch von <a class="reference external" href="http://www.lino-framework.org/api/lino.modlib.contacts.html#module-lino.modlib.contacts" title="(in Lino v1.6)"><code class="xref py py-mod docutils literal"><span class="pre">lino.modlib.contacts</span></code></a>
abhängig,</li>
<li>zweitens muss man bedenken, dass für jeden Request als erstes der
User rausgesucht wird (um Sprache und Benutzerrechte zu ermitteln).
Und das war bisher ein SELECT mit JOIN, also ein Zugriff auf mindestens
zwei Datenbanktabellen.</li>
</ul>
<p>Einige Konsequenzen:</p>
<ul class="simple">
<li>Für &#8220;technische&#8221; Benutzer wie <cite>admin</cite> oder <cite>root</cite> braucht
jetzt kein Partner mehr zu existieren.</li>
<li>Im Detail eines Benutzers hat man jetzt keine Postadresse usw. mehr.
Stattdessen ein Feld &#8220;Partner&#8221;, das auf den Partner verweist.
Damit Benutzer einem Kollegen eine Mail schicken können, muss ein
entsprechender Partner angelegt werden.
Also bei neuen Benutzern dran denken.</li>
<li>Im Detail von &#8220;Alle Partner&#8221; ist kein Feld &#8220;ist Benutzer&#8221; mehr.
Dort könnte falls nötig eine Liste UsersByPartner erscheinen,
wahrscheinlich am ehesten als kleines HtmlPanel im Reiter &#8220;Sonstiges&#8221;.</li>
</ul>
</div>
<div class="section" id="noch-zwei-bugs">
<h2>Noch zwei Bugs<a class="headerlink" href="#noch-zwei-bugs" title="Permalink to this headline">¶</a></h2>
<p>Beim Rumspielen und Testen sind mir noch zwei allgemeine Bugs aufgefallen:</p>
<ul class="simple">
<li>add_detail_tab() für <cite>users.Users</cite> funktionierte nicht in <code class="xref py py-mod docutils literal"><span class="pre">lino.apps.pcsw</span></code>, weil dessen <cite>detail_layout</cite> in pcsw neudefiniert wird.
Ich habe das zwar gelöst, aber das ist ziemlich tricky.</li>
<li>Im Kalenderpanel macht ein Klick auf ein Event eine Fehlermeldung in der Java-Console
statt das Detail zu öffnen.</li>
</ul>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../index.html">
              <img class="logo" src="../../_static/logo.png" alt="Logo"/>
            </a></p>
<h3><a href="../../index.html">Table Of Contents</a></h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../index.html">Blog</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../about/index.html">About me</a></li>
</ul>

<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script><p align="center">
<a href="https://github.com/lsaffre" target="_blank">GitHub</a>
<br/><a href="http://www.lino-framework.org" target="_blank">Lino</a>
<br/><a href="http://www.saffre-rumma.net" target="_blank">Rumma & Ko</a>
</p>

        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="0526.html" title="20120526"
             >next</a> |</li>
        <li class="right" >
          <a href="0524.html" title="20120524"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Home</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Blog</a> &raquo;</li>
          <li class="nav-item nav-item-2"><a href="index.html" >2012</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">

<a rel="license" href="http://creativecommons.org/licenses/by-sa/2.5/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-sa/2.5/88x31.png" /></a>
This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-sa/2.5/">Creative Commons Attribution-ShareAlike 2.5 Generic License</a>.<br />
      Last updated on 2015-03-31.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.3.
<a href="../../_sources/blog/2012/0525.txt">Show Source</a> 
    <a href="http://luc.lino-framework.org/blog/2012/0525.html">Online Link</a>
    </div>
  </body>
</html>