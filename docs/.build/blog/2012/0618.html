<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>20120618 &mdash; Luc&#39;s website</title>
    
    <link rel="stylesheet" href="../../_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/centeredlogo.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/taglist.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/taglist_tags.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/sidebar.js"></script>
    <link rel="search" type="application/opensearchdescription+xml"
          title="Search within Luc&#39;s website"
          href="../../_static/opensearch.xml"/>
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
    <link rel="top" title="Luc&#39;s website" href="../../index.html" />
    <link rel="up" title="2012" href="index.html" />
    <link rel="next" title="20120619" href="0619.html" />
    <link rel="prev" title="20120616" href="0616.html" />
   
<script src="../../.htmldata/lightbox/js/jquery-1.11.0.min.js"></script>
<script src="../../.htmldata/lightbox/js/lightbox.min.js"></script>
<link href="../../.htmldata/lightbox/css/lightbox.css" rel="stylesheet" />

  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="0619.html" title="20120619"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="0616.html" title="20120616"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Home</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Blog</a> &raquo;</li>
          <li class="nav-item nav-item-2"><a href="index.html" accesskey="U">2012</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="id1">
<h1>20120618<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h1>
<p>Bua, das mit den Workflows ist komplexer (und interessanter)
als ich <a class="reference external" href="http://www.lino-framework.org0616.html">Freitag</a> gedacht hatte.
Aber jetzt scheint das Wichtigste zu stehen.
Danke an Gerd, Gaëtan, Joël und Marc für eure beharrliche Geduld.
Kleiner Screenshot als Andenken an den großen Moment:</p>
<a class="reference internal image-reference" href="../../_images/0618.jpg"><img alt="../../_images/0618.jpg" src="../../_images/0618.jpg" style="width: 625.8px; height: 411.6px;" /></a>
<p>Jede Tabelle kann jetzt ein Attribut
<a class="reference external" href="http://www.lino-framework.org/api/lino.core.actors.html#lino.core.actors.Actor.workflow_state_field" title="(in Lino v1.6)"><code class="xref py py-attr docutils literal"><span class="pre">workflow_state_field</span></code></a>
setzen. Dieses Attribute enthält den Namen des Feldes,
das den Zustand eines Objektes in dieser Tabelle speichert,
der die Workflows regiert.</p>
<p>Solche Tabellen haben dann ein virtuelles Feld
<code class="xref py py-meth docutils literal"><span class="pre">workflow_buttons</span></code>
(die Kolonne &#8220;Workflows&#8221; im Screenshot oben).</p>
<p>Die Workflow-Regeln kann man einerseits
programmatisch im Anwendungs-Code definieren,
indem man die neuen Aktionsparameter
<code class="xref py py-attr docutils literal"><span class="pre">required_states</span></code>
und optional
<code class="xref py py-attr docutils literal"><span class="pre">owned_only</span></code>
setzt (letztere wird ignoriert, wenn nicht auch
<a class="reference external" href="http://www.lino-framework.org/api/lino.core.actors.html#lino.core.actors.Actor.workflow_owner_field" title="(in Lino v1.6)"><code class="xref py py-attr docutils literal"><span class="pre">workflow_owner_field</span></code></a>
gesetzt ist).
Zum Beispiel die Aktion &#8220;Publish&#8221; wurde so definiert:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="nd">@dd.action</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s">&quot;Publish&quot;</span><span class="p">),</span>
    <span class="n">owned_only</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
    <span class="n">required_states</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;&#39;</span><span class="p">,</span><span class="n">EventState</span><span class="o">.</span><span class="n">draft</span><span class="p">,</span><span class="n">EventState</span><span class="o">.</span><span class="n">suggested</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">publish</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">ar</span><span class="p">):</span>
    <span class="k">print</span> <span class="s">&#39;TODO: would publish&#39;</span><span class="p">,</span> <span class="bp">self</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="n">EventState</span><span class="o">.</span><span class="n">published</span>
</pre></div>
</div>
<p>Andererseits gibt es ein neues Modul <a class="reference external" href="http://www.lino-framework.org/api/lino.modlib.workflows.html#module-lino.modlib.workflows" title="(in Lino v1.6)"><code class="xref py py-mod docutils literal"><span class="pre">lino.modlib.workflows</span></code></a>,
das eine Datenbanktabelle &#8220;Workflow Rules&#8221; hinzufügt.
In dieser Tabelle kan man lokale Regeln definieren,
die die anwendungsspezifisch vorprogrammierten Regeln überschreiben.
Dieses Modul ist allerdings eher als Studie zu betrachten,
denn bisher sehe ich noch keine praktische Anwendung dafür.
Zumindest ist es pädagogisch interessant und gut für Aha-Effekte.</p>
<p>Jetzt fehlt &#8220;nur noch der richtige Klick&#8221;: wenn man auf einen der
Workflow-Buttons &#8220;Publish&#8221; klickt, kommt eine Fehlermeldung
&#8220;Uncaught TypeError: Object #&lt;Object&gt; has no method &#8216;publish&#8217;&#8221;.
Das ist logisch weil <cite>Publish</cite> ja keine window action ist.
Aber ich mach hier mal ein Checkin und eine Atempause.
<a class="reference external" href="http://code.google.com/p/lino/source/detail?r=7b887149fc92">Checkin 7b887149fc92</a>.</p>
<p>22.30 Uhr : Voilà, jetzt funktioniert auch &#8220;der Klick&#8221;.</p>
<p>Beim Spielen mit dem neuen Feature kommen noch einige
Verbesserungen im Modul <a class="reference external" href="http://www.lino-framework.org/api/lino.modlib.outbox.html#module-lino.modlib.outbox" title="(in Lino v1.6)"><code class="xref py py-mod docutils literal"><span class="pre">lino.modlib.outbox</span></code></a>.</p>
<p>Man kann jetzt auf einem Termin auf &#8220;Dispatch&#8221; (&#8220;Verschicken&#8221;)
klicken, um ein Ausgangsdokument zu erstellen.</p>
<p>outbox.Mail ist jetzt auch ein mixins.Controllable werden,
damit die Mail auf den Termin verweist, der sie erstellt hat.</p>
<p>outbox.MailType habe ich rausgeholt.</p>
<p>TODO:</p>
<ul class="simple">
<li>Attachments funktionieren noch nicht.
Virtuelles Feld <cite>Mail.attach_upload</cite>,
in dem man einen Upload auswählen kann,
der dann in die AttachmentsByMail kommt.
Das <cite>get()</cite> von diesem Feld ist immer leer.</li>
<li>Wenn ein Termin Gäste hat, funktioniert Dispatch nicht.</li>
</ul>
<div class="section" id="aus-mixins-owned-wird-mixins-controllable">
<h2>Aus mixins.Owned wird mixins.Controllable<a class="headerlink" href="#aus-mixins-owned-wird-mixins-controllable" title="Permalink to this headline">¶</a></h2>
<p>Allerdings sollte ich vorher mal endlich einen Namen
für unser Rumpelstilzchen finden.
Bisher nennen wir es ja <cite>mixins.Owned</cite>, aber
jetzt wo die Notion von &#8220;Owner&#8221; in Workflows eine total
andere Bedeutung hat, ist dieser Name einfach nicht mehr vertretbar.</p>
<p>Aber was nehmen wir als neuen Namen?
Sollen wir es etwa &#8220;Controllable&#8221; (controller) nennen?
Oder &#8220;Automatable&#8221; (automator)?
Oder &#8220;Generatable&#8221; (generator)?</p>
<p>Wer ist dieses Rumpelstilzchen überhaupt?
Es geht um den Mechanismus, der benutzt wird wenn
z.B. eine VSE automatisch eine Serie von Terminen und
Tasks generiert, die (1) mit ihr &#8220;verknüpft&#8221; sind
(man kann vom Termin aus per Klick auf den Vertrag springen, um den es geht)
und (2) von ihr &#8220;kontrolliert&#8221; werden
(wenn man in der VSE was ändert, werden die automatisch erstellten Termine
und Tasks falls nötig aktualisiert).
Für die Benutzer heißt das Feld <cite>owner</cite> auf dem Termin
momentan &#8220;verknüpft mit&#8221;.</p>
<p>Der gleiche Mechanismus wird benutzt für Uploads, die ja
mit allen möglichen Objekten (aber immer nur mit einem auf einmal)
verknüpft sein können: UploadsByOwner wird momentan
im Detail von Person, Note ud Course benutzt.</p>
<p>The <cite>owner</cite> of a Task or Event
is some other database object that caused the task&#8217;s or event&#8217;s
creation.</p>
<ul class="simple">
<li>uploads.UploadsByOwner</li>
<li>blog.EntriesByOwner</li>
<li>cal.TasksByOwner</li>
<li>mixins.Owned</li>
<li>mixins.Owned.owner_type</li>
<li>mixins.Owned.owner_id</li>
<li>mixins.Owned.owner</li>
<li>update_owned_instance</li>
<li>after_update_owned_instance</li>
</ul>
<p>Fazit:
wir nennen es &#8220;Controllable&#8221; und &#8220;ByController&#8221;.
Aber die Datenbankfelder <cite>owner</cite> behalten vorläufig noch
ihren alten Namen, um die Datenbank-Migration nicht unnötig
zu verkomplizieren.
Dringend fand ich vor allem die Namen, die in Anwendungscode benutzt werden.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../index.html">
              <img class="logo" src="../../_static/logo.png" alt="Logo"/>
            </a></p>
<h3><a href="../../index.html">Table Of Contents</a></h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../index.html">Blog</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../about/index.html">About me</a></li>
</ul>

<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script><p align="center">
<a href="https://github.com/lsaffre" target="_blank">GitHub</a>
<br/><a href="http://www.lino-framework.org" target="_blank">Lino</a>
<br/><a href="http://www.saffre-rumma.net" target="_blank">Rumma & Ko</a>
</p>

        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="0619.html" title="20120619"
             >next</a> |</li>
        <li class="right" >
          <a href="0616.html" title="20120616"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Home</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Blog</a> &raquo;</li>
          <li class="nav-item nav-item-2"><a href="index.html" >2012</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2001-2015 Luc Saffre.
      Last updated on 2015-03-31.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.3.
    <a href="https://raw.github.com/lsaffre/blog/master/docs/blog/2012/0618.rst"
           rel="nofollow">Show Source</a>.
    <a href="http://luc.lino-framework.org/blog/2012/0618.html">Online Link</a>
    </div>
  </body>
</html>