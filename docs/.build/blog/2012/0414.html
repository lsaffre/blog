<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>20120414 &mdash; Luc&#39;s website</title>
    
    <link rel="stylesheet" href="../../_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/centeredlogo.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/taglist.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/taglist_tags.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/sidebar.js"></script>
    <link rel="search" type="application/opensearchdescription+xml"
          title="Search within Luc&#39;s website"
          href="../../_static/opensearch.xml"/>
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
    <link rel="top" title="Luc&#39;s website" href="../../index.html" />
    <link rel="up" title="2012" href="index.html" />
    <link rel="next" title="20120416" href="0416.html" />
    <link rel="prev" title="20120413" href="0413.html" />
   
<script src="../../.htmldata/lightbox/js/jquery-1.11.0.min.js"></script>
<script src="../../.htmldata/lightbox/js/lightbox.min.js"></script>
<link href="../../.htmldata/lightbox/css/lightbox.css" rel="stylesheet" />

  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="0416.html" title="20120416"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="0413.html" title="20120413"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Home</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Blog</a> &raquo;</li>
          <li class="nav-item nav-item-2"><a href="index.html" accesskey="U">2012</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="id1">
<h1>20120414<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h1>
<p><a class="reference external" href="http://www.lino-framework.org/api/lino.utils.xmlgen.odf.html#module-lino.utils.xmlgen.odf" title="(in Lino v1.6)"><code class="xref py py-mod docutils literal"><span class="pre">lino.utils.xmlgen.odf</span></code></a> is probably useless:
I discovered
<a class="reference external" href="https://joinup.ec.europa.eu/software/odfpy">ODFPy</a>,
a library by Søren Roug
for manipulating OpenDocument documents (.odt, .ods, .odp, ...):
read existing files, modify, create new files from scratch
(read more on <a class="reference external" href="http://pypi.python.org/pypi/odfpy">PyPI</a>).</p>
<p>Renamed my old <cite>lino.utils.html2odt</cite> module
to <cite>lino.utils.html2odt_old</cite>
(it has never been used but and I should rather throw it away,
but just in case...)</p>
<p>Created a new <code class="xref py py-mod docutils literal"><span class="pre">lino.utils.html2odt</span></code> package,
a wrapper around <cite>odfpy.contrib.html2odt</cite>.
The idea was to use the existing
<code class="xref py py-meth docutils literal"><span class="pre">value2html</span></code>
<code class="xref py py-class docutils literal"><span class="pre">StoreField</span></code></p>
<p>It is mainly a simple copy of these files
because I didn&#8217;t see any other possiblity to make them
easily available.
Afterwards I realized that
Søren&#8217;s <cite>html2odt</cite> is probably rather a proof of concept
and not yet meant for &#8220;serious use&#8221;.</p>
<p>The most pragmatic solution seems currently to add
another method to
<code class="xref py py-meth docutils literal"><span class="pre">value2odt</span></code>
<code class="xref py py-class docutils literal"><span class="pre">StoreField</span></code></p>
<p>And yes, a proof of concept works: Lino now generates a .odt file
when you click on the <span class="guilabel">[pdf]</span> button.
That&#8217;s rather a step back, you&#8217;ll say, but the revolutionary
new thing is that the columns have now correct widths.</p>
<p>Formatting is also less beautiful than before, but that&#8217;s just a
question of getting used to the ODF way to format.</p>
<p>More important is the question: is this the right way to go?
Although this method would work for the <span class="guilabel">[pdf]</span>
button of a table view, it is <em>not</em> a solution for rendering
tables inside of an <a class="reference external" href="http://www.lino-framework.org/ref/links.html#term-appy-pod" title="(in Lino v1.6)"><span class="xref std std-term">appy.pod</span></a> template.</p>
<p>Can ODFPy replace <a class="reference external" href="http://www.lino-framework.org/ref/links.html#term-appy-pod" title="(in Lino v1.6)"><span class="xref std std-term">appy.pod</span></a> completely?
Is it possible to do what appy.pod can do using
OO User Fields and Conditional Texts?
Probably not. Or at least not easily.
For example we still would need a headless OpenOffice
running at the server for doing the conversion to .pdf or .rtf.
The <a class="reference external" href="http://www.lino-framework.org/ref/links.html#term-appy-pod" title="(in Lino v1.6)"><span class="xref std std-term">appy.pod</span></a> templating system is not perfect,
but it works, it is reasonably fast and stable,
and my customer is used to it.</p>
<p>In fact we need to integrate both projects:</p>
<p><a class="reference external" href="http://appyframework.org/podWritingAdvancedTemplates.html">do text from</a>
currently simply expects a chunk of XML to be inserted at that place
of the template.  But it seems that we need more.  In order to specify
widths of table columns, we also need to be able add styles to the
document: at least one automatic style for each column that has a
width specified.  This cannot be done using a simple XML chunk.  The
<cite>appy.pod.parts.OdtTable</cite> is useless as long as it cannot do more than
returning an XML chunk.</p>
<p>My suggestion for <a class="reference external" href="http://www.lino-framework.org/ref/links.html#term-appy-pod" title="(in Lino v1.6)"><span class="xref std std-term">appy.pod</span></a> is to extend
the <cite>do text from</cite> clause so that
the user function may return something else than a string.
For example a <cite>dict</cite> with different keys &#8220;content&#8221;, &#8220;styles&#8221;,
&#8220;automaticstyles&#8221;...
or an <a class="reference external" href="https://joinup.ec.europa.eu/svn/odfpy/trunk/odf/opendocument.py">odf.opendocument.OpenDocumentText</a>
instance, and in that case appy.pod would
(1) inspect the <cite>styles</cite> and <cite>automaticstyles</cite>
of this instance and add them to the styles and automatic styles
of the template, (2) consider the whole <cite>text</cite> part
of the document instance as the XML chunk to be inserted.</p>
<p>(Added this as a comment
to <a class="reference external" href="https://answers.launchpad.net/appy/+question/187455">https://answers.launchpad.net/appy/+question/187455</a>)</p>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../index.html">
              <img class="logo" src="../../_static/logo.png" alt="Logo"/>
            </a></p>
<h3><a href="../../index.html">Table Of Contents</a></h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../index.html">Blog</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../about/index.html">About me</a></li>
</ul>

<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script><p align="center">
<a href="https://github.com/lsaffre" target="_blank">GitHub</a>
<br/><a href="http://www.lino-framework.org" target="_blank">Lino</a>
<br/><a href="http://www.saffre-rumma.net" target="_blank">Rumma & Ko</a>
</p>

        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="0416.html" title="20120416"
             >next</a> |</li>
        <li class="right" >
          <a href="0413.html" title="20120413"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Home</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Blog</a> &raquo;</li>
          <li class="nav-item nav-item-2"><a href="index.html" >2012</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2001-2015 Luc Saffre.
      Last updated on 2015-03-31.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.3.
    <a href="https://raw.github.com/lsaffre/blog/master/docs/blog/2012/0414.rst"
           rel="nofollow">Show Source</a>.
    <a href="http://luc.lino-framework.org/blog/2012/0414.html">Online Link</a>
    </div>
  </body>
</html>