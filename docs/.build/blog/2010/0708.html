<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>20100708 &mdash; Luc&#39;s website</title>
    
    <link rel="stylesheet" href="../../_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/centeredlogo.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/taglist.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/taglist_tags.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/sidebar.js"></script>
    <link rel="search" type="application/opensearchdescription+xml"
          title="Search within Luc&#39;s website"
          href="../../_static/opensearch.xml"/>
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
    <link rel="top" title="Luc&#39;s website" href="../../index.html" />
    <link rel="up" title="2010" href="index.html" />
    <link rel="next" title="20100709 extjs performance" href="0709.html" />
    <link rel="prev" title="20100707" href="0707.html" />
   
<script src="../../.htmldata/lightbox/js/jquery-1.11.0.min.js"></script>
<script src="../../.htmldata/lightbox/js/lightbox.min.js"></script>
<link href="../../.htmldata/lightbox/css/lightbox.css" rel="stylesheet" />

  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="0709.html" title="20100709 extjs performance"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="0707.html" title="20100707"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Home</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Blog</a> &raquo;</li>
          <li class="nav-item nav-item-2"><a href="index.html" accesskey="U">2010</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="id1">
<h1>20100708<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h1>
<p>(Fortsetzung von <a class="reference internal" href="0707.html"><em>gestern</em></a>)</p>
<p>Also Felder mit eindimensionaler Auswahlliste brauchen nicht nur kein hidden field,
sondern dürfen keins haben. Das funktioniert jetzt einigermaßen (mit ein paar Schönheitsfehlern, die aber nicht blockierend sind).
Einige der Konsequenzen:</p>
<ul>
<li><p class="first">Um rauszufinden, ob eine Auswahlliste &#8220;simple values&#8221; oder &#8220;value/text pairs&#8221; benutzt, gehe ich wie folgt vor: Um zu deklarieren, dass eine choices-Methode &#8220;simple values&#8221; (und nicht das Standardverhalten &#8220;value/text pairs&#8221;) zurückgibt, muss man ihr ein Attribut <code class="xref py py-attr docutils literal"><span class="pre">simple_values</span></code> mit dem Wert <cite>True</cite> verpassen. Spontan dachte ich, dass das ganz einfach sei:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">template_choices</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span><span class="n">print_method</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">mixins</span><span class="o">.</span><span class="n">template_choices</span><span class="p">(</span><span class="n">print_method</span><span class="p">)</span>
<span class="n">template_choices</span><span class="o">.</span><span class="n">simple_values</span> <span class="o">=</span> <span class="bp">True</span>
</pre></div>
</div>
<p>Aber da hatte ich mich geirrt. Weil die Methode schon den Dekorator <cite>&#64;classmethod</cite> hat,
kann man ihr keine Attribute mehr verpassen:</p>
<div class="highlight-python"><div class="highlight"><pre>AttributeError: &#39;classmethod&#39; object has no attribute &#39;simple_values&#39;
</pre></div>
</div>
<p>Um das zu umgehen, benutze ich momentan die alte Syntax:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">template_choices</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span><span class="n">print_method</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">mixins</span><span class="o">.</span><span class="n">template_choices</span><span class="p">(</span><span class="n">print_method</span><span class="p">)</span>
<span class="n">template_choices</span><span class="o">.</span><span class="n">simple_values</span> <span class="o">=</span> <span class="bp">True</span>
<span class="n">template_choices</span> <span class="o">=</span> <span class="nb">classmethod</span><span class="p">(</span><span class="n">template_choices</span><span class="p">)</span>
</pre></div>
</div>
<p>Was sind eigentlich Dekoratoren? Ein interessanter <a class="reference external" href="http://www.artima.com/weblogs/viewpost.jsp?thread=240808">Artikel von Bruce Eckel</a> half mir zu verstehen.</p>
</li>
<li><p class="first">Die Antwort auf <a class="reference external" href="http://127.0.0.1:8000/api/notes/NoteTypes?fmt=json">http://127.0.0.1:8000/api/notes/NoteTypes?fmt=json</a> kommt nun richtig; <code class="xref py py-attr docutils literal"><span class="pre">NoteType.template</span></code> hat jetzt kein Hidden-Feld mehr:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="p">{</span>
  <span class="n">count</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="n">rows</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">{</span> <span class="n">print_methodHidden</span><span class="p">:</span> <span class="s">&quot;appy&quot;</span><span class="p">,</span> <span class="n">print_method</span><span class="p">:</span> <span class="s">&quot;AppyPrintMethod&quot;</span><span class="p">,</span>
      <span class="nb">id</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="n">template</span><span class="p">:</span> <span class="s">&quot;phone.odt&quot;</span><span class="p">,</span>
      <span class="n">name</span><span class="p">:</span> <span class="s">&quot;phone report&quot;</span>
    <span class="p">},</span>
    <span class="p">{</span> <span class="n">print_methodHidden</span><span class="p">:</span> <span class="n">null</span><span class="p">,</span> <span class="n">print_method</span><span class="p">:</span> <span class="n">null</span><span class="p">,</span>
      <span class="nb">id</span><span class="p">:</span> <span class="n">null</span><span class="p">,</span>
      <span class="n">template</span><span class="p">:</span> <span class="s">&quot;&quot;</span><span class="p">,</span>
      <span class="n">name</span><span class="p">:</span> <span class="s">&quot;&quot;</span>
    <span class="p">}</span>
  <span class="p">],</span>
  <span class="n">title</span><span class="p">:</span> <span class="s">&quot;NoteTypes&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
</li>
<li><p class="first">Das <code class="docutils literal"><span class="pre">this.value</span> <span class="pre">=</span> <span class="pre">v;</span></code> am Ende meiner <code class="xref py py-func docutils literal"><span class="pre">ComboBox.setValue()</span></code> musste wieder rein.</p>
</li>
</ul>
<p>Check-In</p>
<div class="section" id="diverse-bugs-im-extjsu-behoben">
<h2>Diverse Bugs im extjsu behoben<a class="headerlink" href="#diverse-bugs-im-extjsu-behoben" title="Permalink to this headline">¶</a></h2>
<p>Nächstes Problem: in <a class="reference external" href="http://127.0.0.1:8000/api/countries/Countries?fmt=grid">http://127.0.0.1:8000/api/countries/Countries?fmt=grid</a> wurden die iso_code nicht angezeigt, weil der Store immer &#8220;id&#8221; als primary key erwartete. Jetzt gibt es deshalb den neuen Konfigurationsparameter <cite>ls_id_property</cite> für <cite>Lino.GridPanel</cite>. (<a class="reference external" href="http://www.lino-framework.org/api/lino.modlib.countries.models.html#lino.modlib.countries.models.Country" title="(in Lino v1.6)"><code class="xref py py-class docutils literal"><span class="pre">lino.modlib.countries.models.Country</span></code></a> ist ja eine der wenigen Tabellen, die nicht &#8216;id&#8217; als primary key haben).</p>
<p>Nächstes Problem: wenn ich in der Grid ein neues Land erstellen wollte, dann schickter er zwar ein korrektes <cite>POST http://127.0.0.1:8000/api/countries/Countries</cite>, aber der Server machte dann:</p>
<div class="highlight-python"><div class="highlight"><pre>ValidationError: {&#39;isocode&#39;: ValidationError({&#39;isocode&#39;: u&quot;Primary key &#39;&#39; may not be modified.&quot;})}
</pre></div>
</div>
<p>Merke: der pk einer neu erstellten und noch nicht gespeicherten Instanz ist nicht unbedingt <code class="docutils literal"><span class="pre">None</span></code>, sondern kann (wenn pk ein CharField ist) auch <code class="docutils literal"><span class="pre">''</span></code> sein.</p>
<p><code class="xref py py-class docutils literal"><span class="pre">countries.Country</span></code> hat jetzt ein Detail-Layout, in dem der neue Report CitiesByCountry angezeigt wird.</p>
<p><code class="xref py py-mod docutils literal"><span class="pre">lino.modlib.dsbe.management.commands.load_tim</span></code> vergaß, das Feld <code class="xref py py-attr docutils literal"><span class="pre">contacts.Contact.country</span></code> zu füllen. Behoben.</p>
<p>Zwischendurch habe ich mich wieder nicht enthalten können, mit Sphinx zu spielen: Neuer Link &#8220;Show Source&#8221; im Fuß jeder Seite verweist auf den Quellcode der Dokumentation im Google-Repository. (Also die Sphinx-Option <a class="reference external" href="http://sphinx.pocoo.org/latest/config.html#confval-html_copy_source">html_copy_source</a> benutze ich nicht). Neuer Link &#8220;Online Link&#8221;, der auf die Seite selber verweist (den brauche vor allem ich, um von der lokal generierten Doku auf die Online-Version zu springen).</p>
<p>Mehrere Check-Ins und zum Schluss:</p>
</div>
<div class="section" id="release-lino-0-8-2-dsbe-0-1-1">
<h2>Release Lino 0.8.2 &amp; DSBE 0.1.1<a class="headerlink" href="#release-lino-0-8-2-dsbe-0-1-1" title="Permalink to this headline">¶</a></h2>
<p>Diese Versionen laufen jetzt im <a class="reference external" href="http://www.lino-framework.org/community/users.html#weleup" title="(in Lino v1.6)"><span>ÖSHZ Eupen</span></a> und auf <a class="reference internal" href="../../glossary.html#term-tups"><span class="xref std std-term">Tups</span></a>. Es sind noch viele Bugs drin, aber ich wollte mal sehen, wie die Performance auf einem &#8220;Produktionsserver&#8221; ist. Mein erster Eindruck: eher besorgniserregend... aber jetzt ist Feierabend.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../index.html">
              <img class="logo" src="../../_static/logo.png" alt="Logo"/>
            </a></p>
<h3><a href="../../index.html">Table Of Contents</a></h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../index.html">Blog</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../about/index.html">About me</a></li>
</ul>

<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script><p align="center">
<a href="https://github.com/lsaffre" target="_blank">GitHub</a>
<br/><a href="http://www.lino-framework.org" target="_blank">Lino</a>
<br/><a href="http://www.saffre-rumma.net" target="_blank">Rumma & Ko</a>
</p>

        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="0709.html" title="20100709 extjs performance"
             >next</a> |</li>
        <li class="right" >
          <a href="0707.html" title="20100707"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Home</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Blog</a> &raquo;</li>
          <li class="nav-item nav-item-2"><a href="index.html" >2010</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">

<a rel="license" href="http://creativecommons.org/licenses/by-sa/2.5/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-sa/2.5/88x31.png" /></a>
This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-sa/2.5/">Creative Commons Attribution-ShareAlike 2.5 Generic License</a>.<br />
      Last updated on 2015-03-31.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.3.
<a href="../../_sources/blog/2010/0708.txt">Show Source</a> 
    <a href="http://luc.lino-framework.org/blog/2010/0708.html">Online Link</a>
    </div>
  </body>
</html>