<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>20100118 &mdash; Luc&#39;s website</title>
    
    <link rel="stylesheet" href="../../_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/centeredlogo.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/taglist.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/taglist_tags.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/sidebar.js"></script>
    <link rel="search" type="application/opensearchdescription+xml"
          title="Search within Luc&#39;s website"
          href="../../_static/opensearch.xml"/>
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
    <link rel="top" title="Luc&#39;s website" href="../../index.html" />
    <link rel="up" title="2010" href="index.html" />
    <link rel="next" title="&lt;no title&gt;" href="0119.html" />
    <link rel="prev" title="20100116" href="0116.html" />
   
<script src="../../.htmldata/lightbox/js/jquery-1.11.0.min.js"></script>
<script src="../../.htmldata/lightbox/js/lightbox.min.js"></script>
<link href="../../.htmldata/lightbox/css/lightbox.css" rel="stylesheet" />

  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="0119.html" title="&lt;no title&gt;"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="0116.html" title="20100116"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Home</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Blog</a> &raquo;</li>
          <li class="nav-item nav-item-2"><a href="index.html" accesskey="U">2010</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="id1">
<h1>20100118<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h1>
<p>Hab mal probiert, eine <cite>Company</cite> einzugeben. Plutsch, schon das erste
Problem.  Das Feld <cite>name</cite> , das in
<cite>lino.modlib.contacts.models.Contact</cite> definiert wird, darf nicht
<cite>editable=False</cite> sein, weil man dann keine <cite>Company</cite> eingeben
kann. Ich hatte es auf uneditierbar gesetzt, weil es in Person
automatisch gesetzt wird. Eigentlich muss ich in <cite>Person</cite> einen
trigger auf den Feldern <cite>first_name</cite> und <cite>last_name</cite> machen. Weil Lino
das noch nicht kann, prüft <cite>Person.before_save()</cite> jetzt vorher, ob das
Feld leer ist.</p>
<p>Aha, da ist ja auch die Dokumentation zu Djangos neuer Model validation:
<a class="reference external" href="http://docs.djangoproject.com/en/dev/ref/models/instances/#validating-objects">http://docs.djangoproject.com/en/dev/ref/models/instances/#validating-objects</a>
Also die <cite>before_save()</cite> werde ich wohl demnächst nach <cite>clean()</cite> umbenennen.</p>
<p>Oops, und die Liste einer Combo-Box lässt sich nicht mehr filtern. Wieso? Das hat doch immer funktioniert? Aha, tilt: ich hatte ja das Schlüsselwort
<cite>URL_PARAM_FILTER</cite> von <cite>query</cite> nach <cite>qs</cite> umbenannt. Das wird aber von der Combobox benutzt, da hatte ich nicht dran gedacht.</p>
<hr class="docutils" />
<p>En passant notiere ich mir issue 80 (ForeignKey fields in Detail
window display value instead of display_field). Das Problem ist ja
schon alt, aber es hatte noch kein Ticket.</p>
<p>So, und jetzt fang ich mal mit dem Insert-Button an.</p>
<p>Zuerst will ich die beiden Toolbars etwas umkrempeln: das
Quick-Filter-Feld kommt nach oben, in den <cite>PagingToolbar</cite>, und die
grid_actions kommen nach unten. Oben die Einstellungen für die Liste,
unten die Aktionen, die sich auf die markierte Zeile beziehen. Mann,
das war mal wieder einfach!</p>
<p>Noch ein neues issue 81 (Opening more than one Detail of a Report).
Oh, das war ja einfacher als ich anfangs dachte: lag nicht an
<cite>Window.closeAction</cite>, sondern daran, dass die beiden Fenster dann das
gleiche <cite>id</cite> haben. Verständlich, dass ExtJS dann durcheinander kommt.</p>
<p>Feld <cite>civil_state</cite> in <cite>dsbe.models.Person</cite> hat keine
Auswahlliste. Dabei hat das Datenbankfeld doch ein <cite>choices</cite>. Aber
stimmt: weil es kein <cite>ForeignKey</cite> ist, sondern eine einfache
Auswahlliste, erkennt Lino das nicht. Issue 82.</p>
<p>Feld <cite>tim_nr</cite> in <cite>dsbe.models.Person</cite> wird im Detail nicht angezeigt. Ich knall es mal neben den Zivilstand. Ist übrigens maximal 10 (und nicht 8) Positionen lang.</p>
<p>Und dann, obwohl ich im Layout <cite>properties.PropValuesByOwner:40x6</cite>
gesagt habe, sieht man im Detail-Fenster momentan nur eine einzige
Datenzeile. Das ist fies... Neue Konstante ADD_GRID_HEIGHT.</p>
<p>So und jetzt ran an den Insert-Button.
Der braucht eine neue Action <cite>actions.InsertRow</cite>.
Neue Konstante actions.INSERT. Woher kommen die keycodes nochmal?
Aha aus <cite>Ext-3.1.0/src/core/EventManager-more.js</cite>.
Jetzt das eigentliche Neue:
Eine Action bzw. ein Actioncontext muss ein selbstdefiniertes modales Dialogfenster anzeigen können.
Vielleicht sogar eines, das das Layout eines Details hat, aber keine Next/Previous-Buttons (aber das lasse ich für später).</p>
<hr class="docutils" />
<p>Am besten lasse ich sogar die selbstdefinierten Dialogfenster mal warten. In dsbe ist das noch nicht dringend nötig. Ein einfacher Button, der ein confirm macht und dann eine leere Zeile erstellt, das könnte auch schon reichen.</p>
<p>Bon... der Insert-Button ist jetzt da und funktioniert. Obschon er theoretisch einen Fehler generieren müsste, weil <cite>Person.name</cite> leer ist.</p>
<p>Außerdem müssen die report actions auch im Detail angezeigt werden. Das kriegt also auch einen oberen und einen unteren Toolbar. Der obere kann freilich kein <cite>PagingToolbar</cite> sein, und kriegt auch kein Quick-Filter-Feld, weil das Detail mit dem Store der Grid verknüpft ist. Er hat nur die vier Knöpfe First, Previous, Next und Last.
Der submit-Button gehört eigentlich nach unten. Aber nicht in die untere Toolbar, sondern in den Bereich wo er jetzt schon steht. Ganz allein. Schade natürlich um den vertikalen Platz... Oder könnte der Submit-Button explizit im Layout angegeben werden? Hmm...</p>
<p>Aber jetzt ist erstmal Pause, weil ein TIM-Benutzer eine Frage hat.</p>
<hr class="docutils" />
<p>Weiter im Text...</p>
<p><cite>GridElement.setup()</cite> muss wohl in eine neue Klasse <cite>DataElementMixin</cite> verlegt werden, die von <cite>GridElement</cite>, <cite>DetailMainPanel</cite> und <cite>FormMainPanel</cite> geerbt wird.
Wie mach ich es, damit <cite>Lino.grid_action()</cite> und <cite>Lino.show_slave()</cite> auch für ein Detail funktionieren? Dazu muss der Job (caller) sein Interface erweitert bekommen um eine Methode <cite>get_current_row()</cite> und <cite>add_row_listener()</cite>.</p>
<p>Das funktioniert jetzt bis auf ein paar Details: (1) Die Grid hat alle Buttons, aber ein Detail oder ein Slave sollte den Button, der es aufrief, nicht haben. Und (2) Ctrl-Enter in einem Detail oder Slave sollte natürlich nicht nochmal das erste Detail aufrufen.</p>
<p>Aber jetzt erst mal das Problem, dass in den Daten vom ÖSHZ Namen und Vornamen in einem einzigen Feld stehen, und <cite>load_tim.py</cite> rausfinden muss, was der Familienname und was der Vorname ist.
Der bisherige Algorithmus (erstes Wort nach last_name, Rest nach first_name) ist offensichtlich zu simpel.
Ich schreibe also eine Funktion <cite>lino.modlib.contacts.utils.name2kw()</cite>.
Die ist jetzt theoretisch fertig, sogar mit doctest
(den man freilich momentan manuell mit <cite>python utils.py</cite> im betreffenden Verzeichnis starten muss, schön wär&#8217;s, wenn ich bei Gelegenheit <cite>python manage.py test</cite> mal wieder ans Laufen brächte).</p>
<p>Hier auch etwas Dokumentation über die möglichen Präfixe von Familiennamen, die es so gibt:
<a class="reference external" href="http://en.wikipedia.org/wiki/Dutch_name">http://en.wikipedia.org/wiki/Dutch_name</a>
<a class="reference external" href="http://www.myheritage.com/support-post-130501/dutch-belgium-german-french-surnames-with-prefix-such-as-van?lang=RU">http://www.myheritage.com/support-post-130501/dutch-belgium-german-french-surnames-with-prefix-such-as-van?lang=RU</a></p>
<p>So, aber jetzt checkin und Schluss für heute! Knapp 7 Stunden Arbeit war das alles.</p>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../index.html">
              <img class="logo" src="../../_static/logo.png" alt="Logo"/>
            </a></p>
<h3><a href="../../index.html">Table Of Contents</a></h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../index.html">Blog</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../about/index.html">About me</a></li>
</ul>

<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script><p align="center">
<a href="https://github.com/lsaffre" target="_blank">GitHub</a>
<br/><a href="http://www.lino-framework.org" target="_blank">Lino</a>
<br/><a href="http://www.saffre-rumma.net" target="_blank">Rumma & Ko</a>
</p>

        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="0119.html" title="&lt;no title&gt;"
             >next</a> |</li>
        <li class="right" >
          <a href="0116.html" title="20100116"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Home</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Blog</a> &raquo;</li>
          <li class="nav-item nav-item-2"><a href="index.html" >2010</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2001-2015 Luc Saffre.
      Last updated on 2015-03-31.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.3.
    <a href="https://raw.github.com/lsaffre/blog/master/docs/blog/2010/0118.rst"
           rel="nofollow">Show Source</a>.
    <a href="http://luc.lino-framework.org/blog/2010/0118.html">Online Link</a>
    </div>
  </body>
</html>