<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>20100804 &mdash; Luc&#39;s website</title>
    
    <link rel="stylesheet" href="../../_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/centeredlogo.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/taglist.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/taglist_tags.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/sidebar.js"></script>
    <link rel="search" type="application/opensearchdescription+xml"
          title="Search within Luc&#39;s website"
          href="../../_static/opensearch.xml"/>
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
    <link rel="top" title="Luc&#39;s website" href="../../index.html" />
    <link rel="up" title="2010" href="index.html" />
    <link rel="next" title="20100805" href="0805.html" />
    <link rel="prev" title="20100803" href="0803.html" />
   
<script src="../../.htmldata/lightbox/js/jquery-1.11.0.min.js"></script>
<script src="../../.htmldata/lightbox/js/lightbox.min.js"></script>
<link href="../../.htmldata/lightbox/css/lightbox.css" rel="stylesheet" />

  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="0805.html" title="20100805"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="0803.html" title="20100803"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Home</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Blog</a> &raquo;</li>
          <li class="nav-item nav-item-2"><a href="index.html" accesskey="U">2010</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="id1">
<h1>20100804<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h1>
<p>Nachtrag zum Thema <cite>disabled_fields</cite> : weil das ein Feature ist,
das wahrscheinlich selten benutzt werden wird, würde Lino in den meisten Anfragen für jeden Record die Info &#8220;disabled_fields: []&#8221; reinpacken. Machen wir so dass es dieses Pseudofeld nur generiert, wenn <code class="xref py py-attr docutils literal"><span class="pre">lino.reports.Report.disabled_fields</span></code> nicht <code class="docutils literal"><span class="pre">None</span></code> ist.</p>
<p>Ich habe dann doch mit <code class="xref py py-mod docutils literal"><span class="pre">lino.demo</span></code> begonnen, weil ich sehen wollte, wie die Links im vorigen Absatz funktionieren. Eigentlich könnten Dokumentation und Webseite bis Ende August warten, aber &#8220;Sphinx makes programmers <strong>want</strong> to write documentation&#8221;...</p>
<div class="section" id="model-validation">
<h2>Model validation<a class="headerlink" href="#model-validation" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>Insert in Persons sagt <cite>{ msg: &#8220;Failed to save  : {&#8216;name&#8217;: [u&#8217;Dieses Feld darf nicht leer sein.&#8217;]}&#8221;, success: false }</cite>.</li>
</ul>
<p>Das Feld <cite>Person.name</cite> ist ja nicht vom Benutzer editierbar, sondern wird automatisch aus den Feldern first_name. name und title generiert. Das muss vor jedem Abspeichern gemacht werden.</p>
<p>Erste Idee: einfach in <code class="xref py py-meth docutils literal"><span class="pre">lino.ui.extjs.ext_ui.ExtUI.api_list_view()</span></code> ein <code class="docutils literal"><span class="pre">instance.before_save()</span></code> vor das <code class="docutils literal"><span class="pre">instance.full_clean()</span></code> setzen.
Aber das funktioniert nicht, wenn ein Model gar keine <cite>before_save</cite> definiert hat.</p>
<p>Ich könnte natürlich <code class="docutils literal"><span class="pre">if</span> <span class="pre">hasattr(instance,'before_save')</span></code> testen,
aber gibt es nicht bessere Lösungen?</p>
<p>Das wäre doch eigentlich ein Fall für Djangos Model Validation.</p>
<p>Also zweite Idee: <cite>before_save</cite> kommt weg, und der <cite>name</cite> wird in einer <cite>Model.clean</cite> gesetzt.
Pech, das geht nicht, weil ja <code class="xref py py-meth docutils literal"><span class="pre">Model.clean_fields()</span></code> (die sich über das leere Feld beschwert).
vor der <code class="xref py py-meth docutils literal"><span class="pre">Model.clean()</span></code> gerufen wird.</p>
<p>Noch eine Idee: ich definiere <cite>name</cite> in modlib.contacts.Contact mit einem <cite>default</cite>,
der ja laut Doku ein callable sein kann.
Das geht auch nicht, weil Django das Objekt, für das der Standardwert ermittelt werden soll, nicht übergibt.
Abgesehen davon sehe ich nicht, wie ich diese Methode dann in Unterklassen neudefinieren könnte.</p>
<blockquote>
<div><dl class="docutils">
<dt>def name_default(self):</dt>
<dd>l = filter(lambda x:x,[self.last_name,self.first_name,self.title])
return &#8221; &#8221;.join(l)</dd>
</dl>
</div></blockquote>
<p>Also lassen wir das. <code class="xref py py-meth docutils literal"><span class="pre">lino.ui.extjs.ext_ui.ExtUI.api_list_view()</span></code> macht <code class="docutils literal"><span class="pre">if</span> <span class="pre">hasattr(instance,'before_save')</span></code> und fertig.
Ich bin nicht 100% zufrieden mit diesem System, aber momentan läuft das so, und ich warte bis sich konkrete Problemfälle zeigen.</p>
<p>Der folgende Punkt war übrigens schon seit Längerem fertig:</p>
<ul class="simple">
<li>In <cite>countries.Countries</cite> kann man nicht einfügen. Dieser Report ist ein Sonderfall, weil Country keinen automatischen primary key hat, sondern das Feld <cite>isocode</cite> dort der pk ist. Das darf natürlich im InsertWrapper und für die ExtraRow (aber nicht für die anderen Zeilen) nicht schreibgeschützt sein.</li>
</ul>
</div>
<div class="section" id="kolonnenfilter-und-reportconfig">
<h2>Kolonnenfilter und ReportConfig<a class="headerlink" href="#kolonnenfilter-und-reportconfig" title="Permalink to this headline">¶</a></h2>
<p>So, jetzt weiter mit der hoffentlich letzten großen Herausforderung vor der Geburt: Kolonnenfilter und (vorher) ReportConfig.</p>
<p>In der <cite>Lino.GridPanel.tbar</cite> kommen zwei neue Elemente:
- eine ComboBox, in der man die verschiedenen ReportConfigs auswählen kann.
- einen Button &#8220;Save-Config&#8221; zum Speichern.</p>
<p>Ein GET eines Reports hat jetzt neben <cite>rows</cite>, <cite>total</cite> und <cite>title</cite> ein neues Attribut <cite>configs</cite>, das eine einfache Liste der Auswahlmöglichkeiten für diese Combobox ist.</p>
<p>Eine andere (bestehende) ReportConfig lädt man, indem man sie in der Combobox auswählt. ViewReportRequest fragt einen neuen URI-Parameter <cite>cfg</cite> ab, der den Namen der gewünschten config enthält.</p>
<p>Neue ReportConfigs erstellt man, indem man in der Combobox einen neuen Namen tippt und dann auf &#8220;Save Config&#8221; klickt.
Wenn überhaupt keine ReportConfig existiert.
Aber jetzt erstmal Unterbrechung inklusive Mittagspause und Rasenmähen.</p>
</div>
<div class="section" id="django-admin-commands">
<h2>django-admin commands<a class="headerlink" href="#django-admin-commands" title="Permalink to this headline">¶</a></h2>
<p>Nach der Unterbrechung habe ich mich ablenken lassen von <code class="xref py py-mod docutils literal"><span class="pre">lino.demo</span></code>.
Die funktioniert ja noch überhaupt nicht.
Ich hab was verstanden: um Scripts wie <code class="xref std std-xfile docutils literal"><span class="pre">initdb.py</span></code>, <code class="xref std std-xfile docutils literal"><span class="pre">load_tim.py</span></code>, <code class="xref std std-xfile docutils literal"><span class="pre">send_invoices.py</span></code> durch <a class="reference external" href="http://docs.djangoproject.com/en/dev/howto/custom-management-commands/#howto-custom-management-commands">django-admin commands</a> zu ersetzen, brauche ich wahrscheinlich ein <a class="reference external" href="http://docs.djangoproject.com/en/dev/topics/signals/">Signal</a>, das bei jedem Start eines Management Tools nach dem Laden der Modelle gefeuert wird...
Updated my copy of Django from 13336 to 13467.
Aber das ist nicht so dringend, das kommt in die <a class="reference external" href="http://www.lino-framework.org/todo.html">/todo</a>.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../index.html">
              <img class="logo" src="../../_static/logo.png" alt="Logo"/>
            </a></p>
<h3><a href="../../index.html">Table Of Contents</a></h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../index.html">Blog</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../about/index.html">About me</a></li>
</ul>

<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script><p align="center">
<a href="https://github.com/lsaffre" target="_blank">GitHub</a>
<br/><a href="http://www.lino-framework.org" target="_blank">Lino</a>
<br/><a href="http://www.saffre-rumma.net" target="_blank">Rumma & Ko</a>
</p>

        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="0805.html" title="20100805"
             >next</a> |</li>
        <li class="right" >
          <a href="0803.html" title="20100803"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Home</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Blog</a> &raquo;</li>
          <li class="nav-item nav-item-2"><a href="index.html" >2010</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">

<a rel="license" href="http://creativecommons.org/licenses/by-sa/2.5/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-sa/2.5/88x31.png" /></a>
This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-sa/2.5/">Creative Commons Attribution-ShareAlike 2.5 Generic License</a>.<br />
      Last updated on 2015-03-31.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.3.
<a href="../../_sources/blog/2010/0804.txt">Show Source</a> 
    <a href="http://luc.lino-framework.org/blog/2010/0804.html">Online Link</a>
    </div>
  </body>
</html>