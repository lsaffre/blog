<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>20101021 &mdash; Luc&#39;s website</title>
    
    <link rel="stylesheet" href="../../_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/centeredlogo.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/taglist.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/taglist_tags.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/sidebar.js"></script>
    <link rel="search" type="application/opensearchdescription+xml"
          title="Search within Luc&#39;s website"
          href="../../_static/opensearch.xml"/>
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
    <link rel="top" title="Luc&#39;s website" href="../../index.html" />
    <link rel="up" title="2010" href="index.html" />
    <link rel="next" title="20101122" href="1022.html" />
    <link rel="prev" title="20101020" href="1020.html" />
   
<script src="../../.htmldata/lightbox/js/jquery-1.11.0.min.js"></script>
<script src="../../.htmldata/lightbox/js/lightbox.min.js"></script>
<link href="../../.htmldata/lightbox/css/lightbox.css" rel="stylesheet" />

  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="1022.html" title="20101122"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="1020.html" title="20101020"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Home</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Blog</a> &raquo;</li>
          <li class="nav-item nav-item-2"><a href="index.html" accesskey="U">2010</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="id1">
<h1>20101021<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h1>
<p>Hackerzacker! Mit Sphinx macht das Dokumentieren so viel Spaß, dass ich heute morgen mal
wieder anderthalb Stunden lang rumgespielt habe statt was zu programmieren.
Der Bär ist noch nicht erlegt, aber ich versuche schon sein Fell zu verkaufen...
Aber wir sind ja guter Hoffnung, dass der Bär bald erlegt wird,
und wenn Lino geboren ist, wird die Webseite natürlich auch wichtig,
um potentiellen Interessenten den Einstieg möglich zu machen.</p>
<p><a class="reference external" href="http://code.google.com/p/lino/source/detail?r=ea544a606942a5d9f59b0e4c970165ab94edf6ec">Check-in</a></p>
<div class="section" id="new-button-show-report-in-own-window">
<h2>New button &#8220;Show report in own window&#8221;<a class="headerlink" href="#new-button-show-report-in-own-window" title="Permalink to this headline">¶</a></h2>
<p>Jetzt aber mal weiter mit der Bärenjagd.
Also wir brauchen einen Button, um den Slave-Report einer HtmlBox in einem eigenen Fenster zu öffnen
(in dem dann der Report als Grid editierbar ist).</p>
<p>12 Uhr : Der Button ist da und funktioniert.
Und zwar für zusammengefasste Reports (in einer HtmlBox dargestellt)
wie für normale SlaveReports (in einer Grid dargestellt).
Es ist ein Tool-Button geworden, der also in der oberen rechten Ecke der Titelzeile der
HtmlBox bzw. des GridPanels steht.</p>
<p>Ein Problem (das schon immer da war) wird jetzt lästig: der Titel des Reports
lautet einfach nur &#8220;Links by owner&#8221;. Da muss natürlich auch der Name des Besitzers stehen
(also die Person, deren Links da bearbeitet werden).
Dieser Titel wird vom Server sogar schon zurückgegeben (<code class="xref py py-meth docutils literal"><span class="pre">lino.reports.Report.get_title()</span></code>
wird dazu ausgeführt), aber vom Client nicht beachtet.</p>
<p>Aber zuerst mal ein Check-in, denn dieses &#8220;Detail&#8221; hat mit dem datareader des stores zu tun,
und die beste Lösung wird sein, wenn ich in Einem das Problem des uneffizienten Datenformats
löse.</p>
</div>
<div class="section" id="jsonreader-uses-suboptimal-data-format">
<h2>JsonReader uses suboptimal data format<a class="headerlink" href="#jsonreader-uses-suboptimal-data-format" title="Permalink to this headline">¶</a></h2>
<p>Das Problem des uneffizienten Datenformats ist in der To-do-Liste folgendermaßen formuliert:</p>
<ul class="simple">
<li>Die interne Kolonnenliste eines Reports ist ja konstant.
Also sollte ein Record im fmt=json nicht als <code class="docutils literal"><span class="pre">dict</span></code> sondern als <code class="docutils literal"><span class="pre">list</span></code> repräsentiert werden.</li>
</ul>
<p>Das Füllen der Grid von <span class="menuselection">Kontakte ‣ Personen</span>
dauert momentan ziemlich lange.
Die Antwort des Servers auf den AJAX-Call (<cite>GET /api/contacts/Persons?fmt=json</cite>)
ist auch immerhin stolze 50 KB dick. Und das für 20 Records. Wie kommts?
Ein Grund ist sicherlich, dass das Datenformat nicht optimal ist:</p>
<div class="highlight-python"><div class="highlight"><pre>{ count: 68,
  rows: [
    { driving_licenseHidden: null,
      last_name: &quot;Altenberg&quot;,
      street_box: &quot;&quot;,
      cityHidden: 1,
      motivation_lack: false,
      birth_country: null,
      addr1: &quot;&quot;,
      ...
    },
    ... (für alle Records der ersten Grid-Seite so ein Objekt)
  ],
  ...
}
</pre></div>
</div>
<p>Jede Row wird als Dictionary übergeben, aber eine einfache Liste würde vollkommen reichen.
Die Feldnamen sowie deren Metainfo ist dem Client ja von vorneherein bekannt,
die sind pro Report konstant.</p>
<p>Dieses Datenformat wird durch den Store der Grid vorgegeben. Das ist ein
<a class="reference external" href="http://www.sencha.com/deploy/dev/docs/?class=Ext.data.JsonStore">Ext.data.JsonStore</a>, der einen <a class="reference external" href="http://www.sencha.com/deploy/dev/docs/?class=Ext.data.JsonReader">Ext.data.JsonReader</a> benutzt.
Stattdessen muss ich einen <a class="reference external" href="http://www.sencha.com/deploy/dev/docs/?class=Ext.data.ArrayStore">Ext.data.ArrayStore</a> benutzen.
Und eine Serie von neuen Methoden <code class="xref py py-meth docutils literal"><span class="pre">lino.ui.extjs.ext_store.StoreField.obj2list()</span></code>.
Und ein neues Attribut <code class="xref py py-attr docutils literal"><span class="pre">lino.ui.extjs.ext_store.Store.pk_index</span></code>,
der zum KonfigurationsParameter <cite>idIndex</cite> des ArrayStore wird.
Um die Position des PK im Array zu ermitteln, musste ich ein neues Klassenattribut
<code class="xref py py-attr docutils literal"><span class="pre">lino.ui.extjs.ext_store.StoreField.value_count</span></code> einführen (das für Comboboxen 2 ist,
ansonsten 1).</p>
<p>15.30 Uhr. Voilà, es funktioniert.
Und die Antwort auf den AJAX-Call zum Füllen der
Grid schrumpft wie vorausgeahnt auf die Hälfte (von 50 auf 25 KB). Schön.</p>
</div>
<div class="section" id="dynamic-window-title">
<h2>Dynamic window title<a class="headerlink" href="#dynamic-window-title" title="Permalink to this headline">¶</a></h2>
<p>16.40 Uhr.
Den Titel auszuwerten, das war dann doch auch nochmal eine Stunde Arbeit.
Aber okay.</p>
</div>
<div class="section" id="fixing-another-validation-bug">
<h2>Fixing another validation bug<a class="headerlink" href="#fixing-another-validation-bug" title="Permalink to this headline">¶</a></h2>
<p>Für die Bemerkungsfelder in Coaching und Exclusion hatte ich das <cite>blank=True</cite> vergessen.
Deshalb weigerte er sich zu speichern, selbst wenn man user und type ausgefüllt
hatte (aber eben nicht remark).</p>
<p>Der fiesere Fehler ist, dass er die entsprechende Fehlermeldung nicht anzeigte.
Der ist jetzt erst halb behoben.
Da kam stattdessen eine Exception auf dem Server.
Die kommt jetzt nicht mehr, und die Fehlermeldung geht korrekt an den Client zurück.
Aber trotzdem sieht der Benutzer sie noch nicht.
Das liegt am on_afteredit des GridPanels.
Da wird noch ein altes Lino.do_action benutzt.</p>
<p>Aber das schau ich mir morgen an, jetzt ist
<a class="reference external" href="http://code.google.com/p/lino/source/detail?r=a918fdc84dd3178af77141ffca7952c46db7250c">Check-in</a>
wegen Feierabend.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../index.html">
              <img class="logo" src="../../_static/logo.png" alt="Logo"/>
            </a></p>
<h3><a href="../../index.html">Table Of Contents</a></h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../index.html">Blog</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../about/index.html">About me</a></li>
</ul>

<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script><p align="center">
<a href="https://github.com/lsaffre" target="_blank">GitHub</a>
<br/><a href="http://www.lino-framework.org" target="_blank">Lino</a>
<br/><a href="http://www.saffre-rumma.net" target="_blank">Rumma & Ko</a>
</p>

        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="1022.html" title="20101122"
             >next</a> |</li>
        <li class="right" >
          <a href="1020.html" title="20101020"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Home</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Blog</a> &raquo;</li>
          <li class="nav-item nav-item-2"><a href="index.html" >2010</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">

<a rel="license" href="http://creativecommons.org/licenses/by-sa/2.5/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-sa/2.5/88x31.png" /></a>
This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-sa/2.5/">Creative Commons Attribution-ShareAlike 2.5 Generic License</a>.<br />
      Last updated on 2015-03-31.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.3.
<a href="../../_sources/blog/2010/1021.txt">Show Source</a> 
    <a href="http://luc.lino-framework.org/blog/2010/1021.html">Online Link</a>
    </div>
  </body>
</html>