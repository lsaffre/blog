<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>&lt;no title&gt; &mdash; Luc&#39;s website</title>
    
    <link rel="stylesheet" href="../../_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/centeredlogo.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/taglist.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/taglist_tags.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/sidebar.js"></script>
    <link rel="search" type="application/opensearchdescription+xml"
          title="Search within Luc&#39;s website"
          href="../../_static/opensearch.xml"/>
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
    <link rel="top" title="Luc&#39;s website" href="../../index.html" />
    <link rel="up" title="2010" href="index.html" />
    <link rel="next" title="&lt;no title&gt;" href="0319.html" />
    <link rel="prev" title="&lt;no title&gt;" href="0317.html" />
   
<script src="../../.htmldata/lightbox/js/jquery-1.11.0.min.js"></script>
<script src="../../.htmldata/lightbox/js/lightbox.min.js"></script>
<link href="../../.htmldata/lightbox/css/lightbox.css" rel="stylesheet" />

  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="0319.html" title="&lt;no title&gt;"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="0317.html" title="&lt;no title&gt;"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Home</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Blog</a> &raquo;</li>
          <li class="nav-item nav-item-2"><a href="index.html" accesskey="U">2010</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <p>= [20100317 ←] [20100318 18.03.2010] [20100319 →] =</p>
<p>11 Uhr. Die Grundfunktionen sind bis auf ein paar Kleinigkeiten wiederhergestellt. Erstes Check-In nach der großen Operation, die ich übrigens &#8220;modal dialog forms&#8221; nennen würde. Zum Einloggen brauchen wir jetzt nur noch zwei statt vorher drei Klassen:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">LoginForm</span><span class="p">(</span><span class="n">layouts</span><span class="o">.</span><span class="n">FormLayout</span><span class="p">):</span>
  <span class="n">layout_command</span> <span class="o">=</span> <span class="s">&#39;Login&#39;</span>

  <span class="n">text</span> <span class="o">=</span> <span class="n">layouts</span><span class="o">.</span><span class="n">StaticText</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s">&quot;Please enter your username and password to authentificate.&quot;</span><span class="p">))</span>

  <span class="n">main</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;</span>
<span class="s">  text</span>
<span class="s">  username</span>
<span class="s">  password</span>
<span class="s">  _ cancel ok</span>
<span class="s">  &quot;&quot;&quot;</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Login</span><span class="p">(</span><span class="n">commands</span><span class="o">.</span><span class="n">Command</span><span class="p">):</span>

  <span class="n">label</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s">&quot;Login&quot;</span><span class="p">)</span>
  <span class="n">username</span> <span class="o">=</span> <span class="n">forms</span><span class="o">.</span><span class="n">Input</span><span class="p">(</span><span class="n">fieldLabel</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s">&quot;Username&quot;</span><span class="p">),</span>
    <span class="n">maxLength</span><span class="o">=</span><span class="mi">75</span><span class="p">,</span><span class="n">allowBlank</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
  <span class="n">password</span> <span class="o">=</span> <span class="n">forms</span><span class="o">.</span><span class="n">Input</span><span class="p">(</span><span class="n">fieldLabel</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s">&quot;Password&quot;</span><span class="p">),</span>
    <span class="n">maxLength</span><span class="o">=</span><span class="mi">75</span><span class="p">,</span><span class="n">inputType</span><span class="o">=</span><span class="s">&#39;password&#39;</span><span class="p">,</span><span class="n">allowBlank</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">run_in_dlg</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">dlg</span><span class="p">):</span>
      <span class="k">yield</span> <span class="n">dlg</span><span class="o">.</span><span class="n">show_modal_form</span><span class="p">(</span><span class="s">&#39;LoginForm&#39;</span><span class="p">)</span>

      <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
          <span class="k">if</span> <span class="n">dlg</span><span class="o">.</span><span class="n">button_clicked</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ok</span><span class="p">:</span>
              <span class="k">yield</span> <span class="n">dlg</span><span class="o">.</span><span class="n">cancel</span><span class="p">()</span>

          <span class="n">username</span> <span class="o">=</span> <span class="n">dlg</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;username&#39;</span><span class="p">)</span>
          <span class="n">password</span> <span class="o">=</span> <span class="n">dlg</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;password&#39;</span><span class="p">)</span>
          <span class="k">print</span> <span class="n">username</span><span class="p">,</span><span class="n">password</span>
          <span class="n">user</span> <span class="o">=</span> <span class="n">authenticate</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="n">password</span><span class="p">)</span>
          <span class="k">if</span> <span class="n">user</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
              <span class="k">yield</span> <span class="n">dlg</span><span class="o">.</span><span class="n">notify</span><span class="p">(</span>
              <span class="n">_</span><span class="p">(</span><span class="s">u&quot;Please enter a correct username and </span><span class="se">\</span>
<span class="s">                password. Both fields are case-sensitive.&quot;</span><span class="p">))</span>
          <span class="k">elif</span> <span class="ow">not</span> <span class="n">user</span><span class="o">.</span><span class="n">is_active</span><span class="p">:</span>
              <span class="k">yield</span> <span class="n">dlg</span><span class="o">.</span><span class="n">notify</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s">&quot;This account is inactive.&quot;</span><span class="p">))</span>
          <span class="k">else</span><span class="p">:</span>
              <span class="n">login</span><span class="p">(</span><span class="n">dlg</span><span class="o">.</span><span class="n">request</span><span class="p">,</span> <span class="n">user</span><span class="p">)</span>
              <span class="k">yield</span> <span class="n">dlg</span><span class="o">.</span><span class="n">ok</span><span class="p">(</span><span class="s">&quot;Welcome, </span><span class="si">%s</span><span class="s">!&quot;</span> <span class="o">%</span> <span class="n">user</span><span class="p">)</span><span class="o">.</span><span class="n">refresh_menu</span><span class="p">()</span>
</pre></div>
</div>
<p>Außerdem funktioniert jetzt erstmals sowohl client- wie serverside validation.</p>
<p>13.45 Uhr : Check-In.
Die weiteren Kleinigkeiten waren z.B. Speichern der Fensterkonfiguration. Das funktioniert jetzt wieder (und übrigens ohne dass der Server neugestartet werden muss).</p>
<p>Bevor ich zum eigentlichen Zweck der Operation komme (nämlich zum customisierbaren InsertRow) gibt es noch eine subtile Nachwirkung zu beheben: contacts.PersonsList zeigt kein Detail an. Das liegt an der Reihenfolge beim Server-Start: <cite>ModelLayout.setup()</cite> für PersonDetail wird scheinbar erst ausgeführt, wenn <cite>contact.PersonsList</cite> schon gemacht ist.</p>
<p>15.45 Uhr. Das Detail ist wieder da. Check-In.</p>
<p>Und jetzt also InserRow mit modalen Dialogfenstern. Idee ist, dass in <cite>InsertRow.run_in_dlg()</cite> eine neu angelegte model instance gemacht wird, die also im Dialog als Variable existiert, aber noch nicht in der datenbank gespeichert ist. Die wird nun zunächst in einem modalen Formular angezeigt, das par défaut das DetailLayout des Modells benutzt, und das lediglich einen Cancel- und einen OK-Button hat. Nach OK wird vor dem Speichern dann noch anwendungsspezifischer Code ausgeführt, z.B. in contacs.Person eine Suche nach Dubletten, was eventuell zu zusätzlichen Bestätigungen führt, oder sogar zur Verweigerung des Abspeicherns.</p>
<p>Das müsste jetzt prinzipiell kein Problem mehr sein, außer dass ich noch eine neue Art von DataLink machen muss, der diese ungespeicherte Instanz an das FormLayout knüpft.</p>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../index.html">
              <img class="logo" src="../../_static/logo.png" alt="Logo"/>
            </a></p>
<h3><a href="../../index.html">Table Of Contents</a></h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../index.html">Blog</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../about/index.html">About me</a></li>
</ul>

<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script><p align="center">
<a href="https://github.com/lsaffre" target="_blank">GitHub</a>
<br/><a href="http://www.lino-framework.org" target="_blank">Lino</a>
<br/><a href="http://www.saffre-rumma.net" target="_blank">Rumma & Ko</a>
</p>

        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="0319.html" title="&lt;no title&gt;"
             >next</a> |</li>
        <li class="right" >
          <a href="0317.html" title="&lt;no title&gt;"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Home</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Blog</a> &raquo;</li>
          <li class="nav-item nav-item-2"><a href="index.html" >2010</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2001-2015 Luc Saffre.
      Last updated on 2015-03-31.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.3.
    <a href="https://raw.github.com/lsaffre/blog/master/docs/blog/2010/0318.rst"
           rel="nofollow">Show Source</a>.
    <a href="http://luc.lino-framework.org/blog/2010/0318.html">Online Link</a>
    </div>
  </body>
</html>