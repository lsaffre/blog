<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>&lt;no title&gt; &mdash; Luc&#39;s website</title>
    
    <link rel="stylesheet" href="../../_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/centeredlogo.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/taglist.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/taglist_tags.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/sidebar.js"></script>
    <link rel="search" type="application/opensearchdescription+xml"
          title="Search within Luc&#39;s website"
          href="../../_static/opensearch.xml"/>
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
    <link rel="top" title="Luc&#39;s website" href="../../index.html" />
    <link rel="up" title="2010" href="index.html" />
    <link rel="next" title="&lt;no title&gt;" href="0510.html" />
    <link rel="prev" title="&lt;no title&gt;" href="0506.html" />
   
<script src="../../.htmldata/lightbox/js/jquery-1.11.0.min.js"></script>
<script src="../../.htmldata/lightbox/js/lightbox.min.js"></script>
<link href="../../.htmldata/lightbox/css/lightbox.css" rel="stylesheet" />

  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="0510.html" title="&lt;no title&gt;"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="0506.html" title="&lt;no title&gt;"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Home</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Blog</a> &raquo;</li>
          <li class="nav-item nav-item-2"><a href="index.html" accesskey="U">2010</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <p>= [20100506 ←] [20100508 08.05.2010] [20100510 →] =</p>
<p>(Bin gestern abend um 20 Uhr wohlbehalten in Brüssel gelandet. Im Zug Leuven-Welkenraedt konnte ich ein bisschen arbeiten, aber plötzlich ging mein Notebook wegen Strommangel in Winterschlaf...)</p>
<p>So, das nächste Problem ist gelöst:</p>
<blockquote>
<div><ul class="simple">
<li>Insert in LinksByOwner geht nicht, er sagt dann &#8220;comp is null&#8221; in Ext.Container.lookupComponent(), und zwar noch bevor der constructor gestartet wird. Also scheinbar beim bloßen Parsen des Ausdrucks. Also wahrscheinlich beim Instanzieren des FormPanels.</li>
</ul>
</div></blockquote>
<p>Da hab ich vielleicht dran gesucht! Das &#8220;comp is null&#8221; kam effektiv sehr logischerweise daher, dass ich ihm in items ein &#8216;null&#8217; übergab. Nachdem ich das endlich rausgefunden hatte (durch Auseinanderpflücken der relativ großen Expression, was übrigens sehr schön funktioniert in FireBug), erkannte ich den Schuldigen:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">LinkDetail</span><span class="p">(</span><span class="n">layouts</span><span class="o">.</span><span class="n">DetailLayout</span><span class="p">):</span>
    <span class="n">datalink</span> <span class="o">=</span> <span class="s">&#39;links.Link&#39;</span>
    <span class="n">main</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;</span>
<span class="s">    url</span>
<span class="s">    desc</span>
<span class="s">    user date owner</span>
<span class="s">    &quot;&quot;&quot;</span>
</pre></div>
</div>
<p>Das Feld <cite>owner</cite> ist ein GenericForeignKey, den ExtUI.create_layout_element zu einem VirtualFieldElement macht, und dieses rendert sich selbst als <cite>null</cite>. Ein erster Workaround war folgendes:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">LinkDetail</span><span class="p">(</span><span class="n">layouts</span><span class="o">.</span><span class="n">DetailLayout</span><span class="p">):</span>
    <span class="n">datalink</span> <span class="o">=</span> <span class="s">&#39;links.Link&#39;</span>
    <span class="n">main</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;</span>
<span class="s">    url</span>
<span class="s">    desc</span>
<span class="s">    user date owner_type owner_id</span>
<span class="s">    &quot;&quot;&quot;</span>
</pre></div>
</div>
<p>Aber dass <cite>owner</cite> aus diesen beiden Feldern besteht, ist ja schon im Model definiert. Also wäre es redundant, das im Layout wieder angeben zu müssen.</p>
<p>Jetzt mach ich es anders: einfach nur die Zeile</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">de</span><span class="p">,</span><span class="n">generic</span><span class="o">.</span><span class="n">GenericForeignKey</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">ext_elems</span><span class="o">.</span><span class="n">VirtualFieldElement</span><span class="p">(</span><span class="n">lh</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="n">de</span><span class="p">,</span><span class="o">**</span><span class="n">kw</span><span class="p">)</span>
</pre></div>
</div>
<p>ersetzen durch</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">de</span><span class="p">,</span><span class="n">generic</span><span class="o">.</span><span class="n">GenericForeignKey</span><span class="p">):</span>
    <span class="c"># create a horizontal panel with 2 comboboxes</span>
    <span class="k">return</span> <span class="n">lh</span><span class="o">.</span><span class="n">desc2elem</span><span class="p">(</span><span class="n">panelclass</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="n">de</span><span class="o">.</span><span class="n">ct_field</span> <span class="o">+</span> <span class="s">&#39; &#39;</span> <span class="o">+</span> <span class="n">de</span><span class="o">.</span><span class="n">fk_field</span><span class="p">,</span><span class="o">**</span><span class="n">kw</span><span class="p">)</span>
</pre></div>
</div>
<p>Ist das nicht wunderschön?</p>
<p>Weiter. Die beiden folgenden Punkte sind nun auch gelöst:</p>
<blockquote>
<div><ul class="simple">
<li>Insert in LinksByOwner öffnet zwar nun korrekt ein Insert-Fenster, aber das Doppelfeld <cite>owner</cite> ist nicht ausgefüllt. In NotesByCompany z.B. funktioniert das wohl. Liegt also daran, dass LinksByOwner ein generic slave ist.</li>
<li>Neuen Record erstellen durch Eingabe in der extra row geht nicht. Er macht dann ein <cite>PUT http://127.0.0.1:8000/api/links/LinksByOwner/ext-record-6</cite>, weil er nicht weiss, dass das eine neue Zeile ist. Das ist ein (kleines) konzeptuelles Problem.</li>
</ul>
</div></blockquote>
<p>Wenn ein Benutzer einen neuen Record einfügen möchte, dann fragt das User Interface von Lino die &#8220;selbstverständlichen&#8221; Angaben. Zum Beispiel bei Insert in NotesByPerson wird der InsertWrapper für Note angezeigt, dessen Master (Feld <cite>person</cite>) dann selbstverständlich schon ausgefüllt sein muss.</p>
<p>Der InsertWrapper sollte immer der Gleiche sein, weil ich die URIs unterhalb von ´/ui/´ irgendwann statisch servieren will (genauer gesagt, dass sie zumindest für den Webserver statisch sind, und Lino generiert sie automatisch bei jedem Start des Applikationsservers).</p>
<p>Diese selbstverständlichen Angaben stehen in der ExtraRow.
Dort soll der InsertWrapper sich diese Werte holen.</p>
<p>Zwischenbemerkung: Das Attribut <cite>ReportActionRequest.extra</cite> sollte kein Integer mehr sein, sondern ein boolean. Lino braucht niemals mehr als eine ExtraRow zu liefern.</p>
<p>Ich musste mit mir selber eine Konvention aushandeln, um die ExtraRow zu identifizieren. Die hat ja noch kein ID. Aber wenn ich das Feld leer lasse, generiert ExtJS selber eine ID. Records mit leerem ID kann er nicht haben. Momentan nehme ich deshalb -99999 als Wert. Das ist natürlich eine Mausefalle, aber mir fällt nichts besseres ein, also negative ID&#8217;s sollte man in Lino bis auf Weiteres vermeiden. Ein spezieller String (z.B. &#8220;_new&#8221;) wäre besser, aber dann muss ich ExtJS daran hindern, das als Zahlenwert parsen zu wollen.</p>
<p>Zwischenbemerkung: Lino nutzt momentan nicht das neue ExtJS-Feature
[<a class="reference external" href="http://www.extjs.com/deploy/dev/examples/restful/restful.html">http://www.extjs.com/deploy/dev/examples/restful/restful.html</a> Ext.data.Store.restful]. Kann sein, dass ich mir da unnötige Arbeit mache. Issue 121. Aber zumindest dieses Beispiel bringt auch keine Lösung für das Problem der serverseitig vorbelegten Felder in neuen Records.</p>
<p>In [countries.Countries] übrigens kann man nicht einfügen. Dieser Report ist ein Sonderfall, weil Country keinen automatischen primary key hat, sondern das Feld <cite>isocode</cite> dort der pk ist. Issue 122.</p>
<p>Und hier noch ein Punkt, der abgehakt werden kann:</p>
<blockquote>
<div><ul class="simple">
<li>LinksByOwner verträgt es nicht, wenn im master keine Zeile markiert ist. Liegt daran, dass LinksByOwner ein generic slave ist.</li>
</ul>
</div></blockquote>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../index.html">
              <img class="logo" src="../../_static/logo.png" alt="Logo"/>
            </a></p>
<h3><a href="../../index.html">Table Of Contents</a></h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../index.html">Blog</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../about/index.html">About me</a></li>
</ul>

<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script><p align="center">
<a href="https://github.com/lsaffre" target="_blank">GitHub</a>
<br/><a href="http://www.lino-framework.org" target="_blank">Lino</a>
<br/><a href="http://www.saffre-rumma.net" target="_blank">Rumma & Ko</a>
</p>

        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="0510.html" title="&lt;no title&gt;"
             >next</a> |</li>
        <li class="right" >
          <a href="0506.html" title="&lt;no title&gt;"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Home</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Blog</a> &raquo;</li>
          <li class="nav-item nav-item-2"><a href="index.html" >2010</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">

<a rel="license" href="http://creativecommons.org/licenses/by-sa/2.5/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-sa/2.5/88x31.png" /></a>
This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-sa/2.5/">Creative Commons Attribution-ShareAlike 2.5 Generic License</a>.<br />
      Last updated on 2015-03-31.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.3.
<a href="../../_sources/blog/2010/0508.txt">Show Source</a> 
    <a href="http://luc.lino-framework.org/blog/2010/0508.html">Online Link</a>
    </div>
  </body>
</html>