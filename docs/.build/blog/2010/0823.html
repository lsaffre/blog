<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>2010-08-22 &mdash; Luc&#39;s website</title>
    
    <link rel="stylesheet" href="../../_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/centeredlogo.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/taglist.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/taglist_tags.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/sidebar.js"></script>
    <link rel="search" type="application/opensearchdescription+xml"
          title="Search within Luc&#39;s website"
          href="../../_static/opensearch.xml"/>
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
    <link rel="top" title="Luc&#39;s website" href="../../index.html" />
    <link rel="up" title="2010" href="index.html" />
    <link rel="next" title="2010-08-24" href="0824.html" />
    <link rel="prev" title="2010-08-21" href="0821.html" />
   
<script src="../../.htmldata/lightbox/js/jquery-1.11.0.min.js"></script>
<script src="../../.htmldata/lightbox/js/lightbox.min.js"></script>
<link href="../../.htmldata/lightbox/css/lightbox.css" rel="stylesheet" />

  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="0824.html" title="2010-08-24"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="0821.html" title="2010-08-21"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Home</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Blog</a> &raquo;</li>
          <li class="nav-item nav-item-2"><a href="index.html" accesskey="U">2010</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="id1">
<h1>2010-08-22<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h1>
<div class="section" id="shockwave-plugin-mag-extjs-nicht">
<h2>Shockwave-Plugin mag ExtJS nicht<a class="headerlink" href="#shockwave-plugin-mag-extjs-nicht" title="Permalink to this headline">¶</a></h2>
<p>Oho, Firefox hängt sich auf, wenn auf Lino/DSBE Demo gehe.</p>
<p>Internet Explorer meldet &#8220;Expected identifier, string or number&#8221;
in der <code class="xref std std-xfile docutils literal"><span class="pre">site.js</span></code>, offenbar weil für ihn <code class="docutils literal"><span class="pre">default</span></code> ein
reserved keyword ist. Okay okay, nehm ich eben &#8216;std&#8217; statt &#8216;default&#8217;.
Aber nach dieser Änderung funktioniert dort alles.</p>
<p>Verursacher scheint der Shockwave Flash Plugin Version 10.1.82.76 zu sein.
Der beißt sich scheinbar mit der ExtJS.
Das passiert nicht nur mit Lino, sondern auch z.B. wenn ich auf
<a class="reference external" href="http://www.sencha.com/products/js/">http://www.sencha.com/products/js/</a> gehe und dort irgendeines der Beispiele starte.</p>
<p>Ich habe das Problem im <a class="reference external" href="http://www.sencha.com/forum/showthread.php?107790-Shockwave-Flash-plugin-causes-Firefox-to-freeze-on-ExtJS&amp;p=504269">ExtJS-Forum</a>
gemeldet.</p>
<ul class="simple">
<li>Nachtrag 28.08.: hat nichts mit ExtJS zu tun, denn der Shockwave Flash Plugin Version 10.1.82.76 lässt meinen Firefox (v. 3.6.8 on Windows XP) jedesmal erfrieren, sobald er aktiviert wird.</li>
<li>Nachtrag 09.09.: Nachdem FF sich auf 3.6.9 aktualisiert hat, funktioniert wieder alles. Das incremental upgrade funktionierte übrigens nicht, aber der Updater entschied dann automatisch, ein komplettes Ugprade zu machen.</li>
</ul>
</div>
<div class="section" id="release-im-weleup">
<h2>Release im <a class="reference external" href="http://www.lino-framework.org/community/users.html#weleup" title="(in Lino v1.6)"><span>ÖSHZ Eupen</span></a><a class="headerlink" href="#release-im-weleup" title="Permalink to this headline">¶</a></h2>
<p>In <a class="reference external" href="http://www.lino-framework.org/admin/install.html">/admin/install</a> habe ich die Anweisungen zur Installation von <a class="reference external" href="http://www.lino-framework.org/admin/printable.html#term-appy-pod" title="(in Lino v1.6)"><span class="xref std std-term">appy_pod</span></a> hinzugefügt.
Pisa werden wir ja bis auf Weiteres nicht benutzen, aber ich lass das noch in den Anweisungen stehen.
Die Druckmethoden (print methods) müsste ich ja mal dokumentieren. Bisher habe ich an zwei Stellen angefangen:
<a class="reference external" href="http://www.lino-framework.org/admin/ConfigureNotesTemplates.html">/admin/ConfigureNotesTemplates</a> und
<a class="reference external" href="http://www.lino-framework.org/admin/printable.html">/admin/printable</a>.</p>
<p>Die Aussage &#8220;<cite>print method</cite> kann auch leer sein.
Eine Notiz dieser Art kann dann eben nur am Bildschirm konsultiert werden und ist nicht druckbar.&#8221;
stimmte noch nicht.
Jetzt wohl.
Dazu musste ich in den beiden Feldern NoteType.print_method und NoteType.template
<code class="docutils literal"><span class="pre">blank=True</span></code> und <code class="docutils literal"><span class="pre">null=True</span></code> hinzufügen.
Jetzt hätten wir mit dieser Änderung allerdings einen ersten Fall für South.
Denn solange ich die Datenbank nicht angepasst habe, kriege ich
<cite>IntegrityError: notes_notetype.print_method may not be NULL</cite>.</p>
<p>Also ran an den Speck und
<a class="reference external" href="http://south.aeracode.org/docs/tutorial/part1.html">http://south.aeracode.org/docs/tutorial/part1.html</a>
lesen.</p>
<p>Zuerst auch ein Upgrade meiner Kopien von South und Django (revision 13467 to 13621).</p>
<p>Jetzt habe ich gleich ein Problemchen:</p>
<div class="highlight-python"><div class="highlight"><pre>T:\hgwork\dsbe\dsbe\demo&gt;python manage.py schemamigration notes --initial
Lino-DSBE 0.1.2+ &lt;http://code.google.com/p/lino-dsbe/&gt;
Lino 0.8.3+ &lt;http://code.google.com/p/lino/&gt;
Django 1.3 pre-alpha SVN-13621 &lt;http://www.djangoproject.com&gt;
Python 2.5.2 &lt;http://www.python.org/&gt;
ReportLab Toolkit 2.4 &lt;http://www.reportlab.org/rl_toolkit.html&gt;
PyYaml 3.08 &lt;http://pyyaml.org/&gt;
python-dateutil 1.4.1 &lt;http://labix.org/python-dateutil&gt;
xhtml2pdf 3.0.32 &lt;http://www.xhtml2pdf.com&gt;
Creating migrations directory at &#39;t:\hgwork\lino\lino\modlib\notes\migrations&#39;...
Creating __init__.py in &#39;t:\hgwork\lino\lino\modlib\notes\migrations&#39;...
 ! Cannot freeze field &#39;notes.note.date&#39;
 ! Cannot freeze field &#39;contacts.person.it_knowledge&#39;

 ! South cannot introspect some fields; this is probably because they are custom
 ! fields. If they worked in 0.6 or below, this is because we have removed the
 ! models parser (it often broke things).
 ! To fix this, read http://south.aeracode.org/wiki/MyFieldsDontWork
</pre></div>
</div>
<p>Also in meiner <code class="xref py py-mod docutils literal"><span class="pre">lino.modlib.fields</span></code>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">south.modelsinspector</span> <span class="kn">import</span> <span class="n">add_introspection_rules</span>
<span class="n">add_introspection_rules</span><span class="p">([],</span> <span class="p">[</span><span class="s">&quot;^lino\.modlib\.fields\.PercentageField&quot;</span><span class="p">])</span>
<span class="n">add_introspection_rules</span><span class="p">([],</span> <span class="p">[</span><span class="s">&quot;^lino\.modlib\.fields\.MyDateField&quot;</span><span class="p">])</span>
<span class="n">add_introspection_rules</span><span class="p">([],</span> <span class="p">[</span><span class="s">&quot;^lino\.modlib\.fields\.MonthField&quot;</span><span class="p">])</span>
<span class="n">add_introspection_rules</span><span class="p">([],</span> <span class="p">[</span><span class="s">&quot;^lino\.modlib\.fields\.QuantityField&quot;</span><span class="p">])</span>
</pre></div>
</div>
<p>Richtig, das war&#8217;s:</p>
<div class="highlight-python"><div class="highlight"><pre>T:\hgwork\dsbe\dsbe\demo&gt;python manage.py schemamigration notes --initial
Lino-DSBE 0.1.2+ &lt;http://code.google.com/p/lino-dsbe/&gt;
Lino 0.8.3+ &lt;http://code.google.com/p/lino/&gt;
Django 1.3 pre-alpha SVN-13621 &lt;http://www.djangoproject.com&gt;
Python 2.5.2 &lt;http://www.python.org/&gt;
ReportLab Toolkit 2.4 &lt;http://www.reportlab.org/rl_toolkit.html&gt;
PyYaml 3.08 &lt;http://pyyaml.org/&gt;
python-dateutil 1.4.1 &lt;http://labix.org/python-dateutil&gt;
xhtml2pdf 3.0.32 &lt;http://www.xhtml2pdf.com&gt;
 + Added model notes.NoteType
 + Added model notes.Note
Created 0001_initial.py. You can now apply this migration with: ./manage.py migrate notes
</pre></div>
</div>
<p>Dummerweise kriege ich jetzt:</p>
<div class="highlight-python"><div class="highlight"><pre>T:\hgwork\dsbe\dsbe\demo&gt;python manage.py migrate notes
Lino-DSBE 0.1.2+ &lt;http://code.google.com/p/lino-dsbe/&gt;
Lino 0.8.3+ &lt;http://code.google.com/p/lino/&gt;
Django 1.3 pre-alpha SVN-13621 &lt;http://www.djangoproject.com&gt;
Python 2.5.2 &lt;http://www.python.org/&gt;
ReportLab Toolkit 2.4 &lt;http://www.reportlab.org/rl_toolkit.html&gt;
PyYaml 3.08 &lt;http://pyyaml.org/&gt;
python-dateutil 1.4.1 &lt;http://labix.org/python-dateutil&gt;
xhtml2pdf 3.0.32 &lt;http://www.xhtml2pdf.com&gt;
Running migrations for notes:
 - Migrating forwards to 0002_auto__chg_field_notetype_template__chg_field_notetype_print_method.
 &gt; notes:0001_initial
Traceback (most recent call last):
  ...
  File &quot;l:\snapshots\django\django\db\backends\sqlite3\base.py&quot;, line 200, in execute
    return Database.Cursor.execute(self, query, params)
django.db.utils.DatabaseError: table &quot;notes_notetype&quot; already exists
</pre></div>
</div>
<p>Das ist logisch: er will die Migration 0000 anwenden, aber die hatten wir ja schon.
Ich habe ja nicht von Anfang an Mit South gearbeitet.
<code class="docutils literal"><span class="pre">python</span> <span class="pre">manage.py</span> <span class="pre">migrate</span> <span class="pre">--list</span></code> zeigt mir:</p>
<div class="highlight-python"><div class="highlight"><pre>notes
 ( ) 0001_initial
 ( ) 0002_auto__chg_field_notetype_template__chg_field_notetype_print_method
</pre></div>
</div>
<p>02.10 Uhr : Ich hab meine Frage an south-users geschickt und geh jetzt erst mal schlafen.</p>
<p>9.00 Uhr : Das war mal wieder ein Fall von <a class="reference external" href="http://south.aeracode.org/docs/commands.html">RTFM</a>. Die Lösung ist <code class="docutils literal"><span class="pre">migrate</span> <span class="pre">--fake</span></code> : &#8220;Records the migration sequence as having been applied, but doesn’t actually run it.&#8221; Antwort auf meine eigene Frage nach south-users.</p>
<p>Also der Punkt &#8220;South aktivieren&#8221; kann aus der <a class="reference external" href="http://www.lino-framework.org/todo.html">/todo</a> raus.</p>
<p>Weitere Benutzbarkeits-Tests:</p>
<ul class="simple">
<li>Wenn es in der Auswahlliste für NoteType.print_method eine RtfPrintMethod gibt, obschon sie nicht funktioniert, dann soll dort erst recht auch eine LatexPrintMethod stehen.</li>
<li>Im Feld Note.url fehlten die Optionen <cite>blank=True</cite> und <cite>null=True</cite>. Das ist Migration Nummer 0003.</li>
<li>Upps, wenn man vom Detail einer Person aus Notizen erstellen will, dann ist das noch nicht benutzerfreundlich genug. Neuer Punkt in
der <a class="reference external" href="http://www.lino-framework.org/todo.html">/todo</a>.</li>
<li>Aber vor allem wird dort Note.person (der fk zum Master) nicht eingetragen. Das liegt an <cite>lino.ui.ext_ui.ExtUI.a2btn</cite>.</li>
</ul>
<p>Die Arbeitsweise von <code class="xref py py-meth docutils literal"><span class="pre">lino.ui.ext_ui.ExtUI.a2btn()</span></code> ist sowieso einige Gedanken wert. Hier der momentane Code:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">a2btn</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="o">**</span><span class="n">kw</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">actions</span><span class="o">.</span><span class="n">SubmitDetail</span><span class="p">):</span>
        <span class="n">kw</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">panel_btn_handler</span><span class="o">=</span><span class="n">js_code</span><span class="p">(</span><span class="s">&#39;Lino.submit_detail&#39;</span><span class="p">))</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">actions</span><span class="o">.</span><span class="n">SubmitInsert</span><span class="p">):</span>
        <span class="n">kw</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">panel_btn_handler</span><span class="o">=</span><span class="n">js_code</span><span class="p">(</span><span class="s">&#39;Lino.submit_insert&#39;</span><span class="p">))</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">actions</span><span class="o">.</span><span class="n">ShowDetailAction</span><span class="p">):</span>
        <span class="n">js</span> <span class="o">=</span> <span class="s">&quot;Lino.</span><span class="si">%s</span><span class="s">(panel,{record_id:ww.get_current_record().id});&quot;</span> <span class="o">%</span> <span class="n">a</span>
        <span class="n">js</span> <span class="o">=</span> <span class="s">&quot;function(panel,btn) { </span><span class="si">%s</span><span class="s"> }&quot;</span> <span class="o">%</span> <span class="n">js</span>
        <span class="n">kw</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">panel_btn_handler</span><span class="o">=</span><span class="n">js_code</span><span class="p">(</span><span class="n">js</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">kw</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">panel_btn_handler</span><span class="o">=</span><span class="n">js_code</span><span class="p">(</span><span class="s">&quot;Lino.</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">a</span><span class="p">))</span>
    <span class="n">kw</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
      <span class="n">text</span><span class="o">=</span><span class="nb">unicode</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">label</span><span class="p">),</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">kw</span>
</pre></div>
</div>
<p>Und <code class="xref js js-func docutils literal"><span class="pre">Lino.build_buttons()</span></code> verarbeitet die &#8220;actions&#8221; von a2btn ja dann zu echten Buttons:</p>
<div class="highlight-python"><div class="highlight"><pre>Lino.build_buttons = function(panel,actions) {
  if (actions) {
    var buttons = Array(actions.length);
    for(var i=0;i&lt;actions.length;i++) {
      buttons[i] = new Ext.Toolbar.Button(actions[i]);
      if (actions[i].panel_btn_handler)
        buttons[i].on(&#39;click&#39;,
          actions[i].panel_btn_handler.createCallback(panel,buttons[i]));
    }
    return buttons
  }
}
</pre></div>
</div>
<ul class="simple">
<li><cite>panel_btn_handler</cite> ist eine Funktion, die als Parameter sowohl das Panel als auch den Button kriegt.</li>
<li>Ein GET <cite>/api/contacts/Persons?fmt=insert</cite> gibt korrekterweise eine Insert-Form zurück,
die auch im Prinzip funktioniert. Außer dass der Titel nicht richtig ist. Aber es fehlen die
Default-Werte der Felder: Zumindest language muss einen Defaultwert kriegen.</li>
</ul>
<p>Das Insert-Fenster hatte auch Navigations-Buttons und ein Quickfilter-Feld, was natürlich Quatsch ist.</p>
<p>Check-in zwischendurch im Rahmen des <a class="reference external" href="http://www.lino-framework.org/releases/2010/0824.html">/releases/2010/0824</a> (und Install im <a class="reference external" href="http://www.lino-framework.org/community/users.html#weleup" title="(in Lino v1.6)"><span>ÖSHZ Eupen</span></a>).</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../index.html">
              <img class="logo" src="../../_static/logo.png" alt="Logo"/>
            </a></p>
<h3><a href="../../index.html">Table Of Contents</a></h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../index.html">Blog</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../about/index.html">About me</a></li>
</ul>

<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script><p align="center">
<a href="https://github.com/lsaffre" target="_blank">GitHub</a>
<br/><a href="http://www.lino-framework.org" target="_blank">Lino</a>
<br/><a href="http://www.saffre-rumma.net" target="_blank">Rumma & Ko</a>
</p>

        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="0824.html" title="2010-08-24"
             >next</a> |</li>
        <li class="right" >
          <a href="0821.html" title="2010-08-21"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Home</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Blog</a> &raquo;</li>
          <li class="nav-item nav-item-2"><a href="index.html" >2010</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2001-2015 Luc Saffre.
      Last updated on 2015-03-31.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.3.
    <a href="https://raw.github.com/lsaffre/blog/master/docs/blog/2010/0823.rst"
           rel="nofollow">Show Source</a>.
    <a href="http://luc.lino-framework.org/blog/2010/0823.html">Online Link</a>
    </div>
  </body>
</html>