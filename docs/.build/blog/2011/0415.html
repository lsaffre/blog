<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>20110415 &mdash; Luc&#39;s website</title>
    
    <link rel="stylesheet" href="../../_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/centeredlogo.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/taglist.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/taglist_tags.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/sidebar.js"></script>
    <link rel="search" type="application/opensearchdescription+xml"
          title="Search within Luc&#39;s website"
          href="../../_static/opensearch.xml"/>
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
    <link rel="top" title="Luc&#39;s website" href="../../index.html" />
    <link rel="up" title="2011" href="index.html" />
    <link rel="next" title="20110419" href="0419.html" />
    <link rel="prev" title="20110414" href="0414.html" />
   
<script src="../../.htmldata/lightbox/js/jquery-1.11.0.min.js"></script>
<script src="../../.htmldata/lightbox/js/lightbox.min.js"></script>
<link href="../../.htmldata/lightbox/css/lightbox.css" rel="stylesheet" />

  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="0419.html" title="20110419"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="0414.html" title="20110414"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Home</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Blog</a> &raquo;</li>
          <li class="nav-item nav-item-2"><a href="index.html" accesskey="U">2011</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="id1">
<h1>20110415<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h1>
<div class="section" id="allgemeine-uploads">
<h2>Allgemeine Uploads<a class="headerlink" href="#allgemeine-uploads" title="Permalink to this headline">¶</a></h2>
<p>Die allgemeinen Uploads hatte ich gestern abend noch schnell
implementiert, und das ging so schnell und problemlos, dass ich
gar nicht darüber berichtet hatte.
Ich brauchte lediglich noch <cite>lino.mixins.Owned</cite>
als Parent zu Klasse
<a class="reference external" href="http://www.lino-framework.org/api/lino.modlib.uploads.models.html#lino.modlib.uploads.models.Upload" title="(in Lino v1.6)"><code class="xref py py-class docutils literal"><span class="pre">lino.modlib.uploads.models.Upload</span></code></a>
hinzuzufügen (sowie einen neuen Report <cite>UploadsByOwner</cite> machen).</p>
<p>Das war ja immerhin das erste Mal, dass GFKs in der Praxis benutzt werden,
und ich hatte Angst, dass da vom ui her noch nicht alles geregelt war.
Aber die Angst war unbegründet.</p>
<p>Was ich noch überlegen muss, ist: ob ich die
ForeignKeys <cite>person</cite> und <cite>company</cite> drinlassen soll oder nicht.
Eigentlich sind die ja nur eine Notlösung.
Wenn die rauskommen, kann man einen Upload nicht mehr <em>gleichzeitig</em>
einer Person <em>und</em> einer Firma zuweisen.
Ist das nötig? Sind solche Uploads überhaupt schon gemacht worden?
Antwort: Nein, denn:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">lino.modlib.uploads.models</span> <span class="kn">import</span> <span class="n">Upload</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">[</span><span class="n">u</span><span class="o">.</span><span class="n">company</span> <span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">Upload</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()]</span>
<span class="go">[None, None, None, None, None, None, None]</span>
<span class="go">&gt;&gt;&gt;</span>
</pre></div>
</div>
<p>Also raus damit.</p>
<p>Upps, die Angst war doch nicht ganz unbegründet.
Es gibt noch ein (hoffentlich kleines) Problem mit dem ui für GFKs:
<cite>extjs.ext_ui.ExtUI.quick_upload_buttons</cite> verträgt
die scheinbar noch nicht.</p>
<p>Hier ist der HTML-Code, den diese Funktion für <cite>residence_permit</cite> generiert:</p>
<div class="highlight-python"><div class="highlight"><pre>&lt;a href=&#39;javascript:Lino.uploads.UploadsByOwner.insert(undefined,{ &quot;data_record&quot;: {
  &quot;data&quot;: {
    &quot;owner_type&quot;: &quot;person&quot;,
    &quot;owner_typeHidden&quot;: 18,
    &quot;owner_id&quot;: &quot;Rik Radermeker (72)&quot;
    &quot;owner_idHidden&quot;: 72,
    &quot;delay_value&quot;: 0,
    ...
    &quot;type&quot;: &quot;Aufenthaltserlaubnis&quot;,
    &quot;id&quot;: null,
    } } })&#39;&gt;Upload&lt;/a&gt;
</pre></div>
</div>
<p>Nö, dieser Code ist korrekt. Stimmt, ich Tuppes: im Insert-Fenster wird der owner
ja noch richtig angezeigt. Erst beim Submit knallt es auf dem Server:</p>
<div class="highlight-python"><div class="highlight"><pre>Traceback (most recent call last):
...
  File &quot;t:\hgwork\lino\lino\ui\requests.py&quot;, line 142, in parse_req
    raise ContentType.DoesNotExist(&quot;ContentType %r does not exist.&quot; % mt)
DoesNotExist: ContentType None does not exist.
</pre></div>
</div>
<p>Der Grund liegt also tiefer: submit_insert und submit_detail übergeben nur die
Formulardaten und folglich nicht den Parameter <cite>mt</cite>. Weil der fehlt, weiß
ViewReportRequest nicht, welche Klasse da erstellt wird.
Eigentlich ist der Parameter mt nicht nötig, weil die Info im Feld
<cite>owner_typeHidden</cite> drin steht.
Hmm.</p>
<p>Tilt. Doch, der ViewReportRequest von UplodsByOwner weiß wohl,
welche Klasse da erstellt wird (nämlich ein Upload).
Das Problem war einfach, dass er einen Upload erstellen muss,
dessen owner None ist.
<cite>Upload.owner</cite> ist zwar nullable, aber <em>darf</em> beim Erstellen <cite>None</cite> sein,
weil der ja vor dem Speichern aus den Formulardaten eingetragen wird.
So was hatten wir noch nie und da waren
mehrere kleine Bugs. Aber die sind jetzt raus.</p>
<p>Okay, die allgemeinen Uploads können heute Abend released
werden (und die <a class="reference external" href="http://www.lino-framework.org/admin/datamig.html">Datenmigration</a> wird mal wieder kein Problem sein,
bin weiterhin ganz begeistert von meinem selbsterfundenen System).</p>
<p>Check-in und Mittagspause (und möglicherweise auch Wochenende, denn hier
bei uns gibt es jetzt viel zu tun im Garten).</p>
<p>Upps, vor dem Release könnte ich das Upload-Panel auch ins
Detail der Notizen einbauen. Voilà, so einfach ging das.
Kaum zu glauben!</p>
</div>
<div class="section" id="conflicting-translations">
<h2>Conflicting translations<a class="headerlink" href="#conflicting-translations" title="Permalink to this headline">¶</a></h2>
<p>Und dann habe ich noch mal an der Übersetzung für &#8220;Note&#8221; begonnen.
Das ist ein subtiler neuer Sonderfall,
weil die Standardübersetzung &#8220;Notiz&#8221; (die in <a class="reference external" href="http://www.lino-framework.org/api/lino.modlib.notes.html#module-lino.modlib.notes" title="(in Lino v1.6)"><code class="xref py py-mod docutils literal"><span class="pre">lino.modlib.notes</span></code></a> steht)
in <code class="xref py py-mod docutils literal"><span class="pre">lino.projects.dsbe</span></code> (und nur dort) &#8220;Ereignisse/Notizen&#8221; sein soll.</p>
<p>Was passiert, wenn zwei Django-Anwendungen das gleiche englische Wort
für etwas benutzen, die Übersetzungen aber verschieden sind?
Antwort: die Übersetzung der ersten Anwendung (laut <a class="reference external" href="http://www.lino-framework.org/ref/settings.html#setting-INSTALLED_APPS" title="(in Lino v1.6)"><code class="xref std std-setting docutils literal"><span class="pre">INSTALLED_APPS</span></code></a>)
überschreibt die der zweiten.</p>
<p>Also muss ich verbose_name in DSBE auch in Englisch &#8220;Events/Notes&#8221; setzen.
Eigentlich logisch.</p>
<p>Der bisherige Reiter &#8220;Notizen&#8221; heißt jetzt nicht &#8220;Ereignisse/Notizen&#8221;, sondern &#8220;Dokumente&#8221;.
Weil &#8220;Ereignisse/Notizen&#8221; nur ein Teil dieses Reiters ist.
Dort gibt es außerdem noch &#8220;Verträge&#8221; und &#8220;Links&#8221;.
&#8220;Dokumente&#8221; ist natürlich auch nicht ideal, denn darunter würde man eher
noch Uploads als die Links verstehen.
Außerdem sind &#8220;eID-Inhalt&#8221; und &#8220;Lebenslauf&#8221; ja auch Dokumente.</p>
</div>
<div class="section" id="release-mit-uberraschungen">
<h2>Release mit Überraschungen<a class="headerlink" href="#release-mit-uberraschungen" title="Permalink to this headline">¶</a></h2>
<p>Abends dachte ich mir &#8220;Mach mal schnell das Upgrade in Eupen&#8221;.
Aber es hat dann doch anderthalb Stunden gedauert.
Nicht wegen der generic uploads, sondern weil ich die Änderung
&#8220;Dumping CourseProviders and Companies&#8221; von gestern (<a class="reference external" href="http://www.lino-framework.org0414.html">0414</a>)
doch nicht so gut getestet hatte.
Ich war überzeugt, dass das folgende funktionieren würde:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">create_dsbe_courseprovider</span><span class="p">(</span><span class="n">company_ptr_id</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">CourseProvider</span><span class="p">(</span><span class="n">company_ptr_id</span><span class="o">=</span><span class="n">company_ptr_id</span><span class="p">)</span>
</pre></div>
</div>
<p>Stattdessen muss es sein:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">lino.utils.mti</span> <span class="kn">import</span> <span class="n">insert_child</span>
<span class="k">def</span> <span class="nf">create_dsbe_courseprovider</span><span class="p">(</span><span class="n">company_ptr_id</span><span class="p">):</span>
    <span class="n">company</span> <span class="o">=</span> <span class="n">Company</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">company_ptr_id</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">insert_child</span><span class="p">(</span><span class="n">company</span><span class="p">,</span><span class="n">CourseProvider</span><span class="p">)</span>
</pre></div>
</div>
<p>Manuell war das kein Problem
(nachdem ich es denn endlich gefunden hatte...
dabei waren noch ein paar Optimierungen im logging von <cite>lino.utils.dpy</cite> nötig),
aber bis zur nächsten dbmig muss ich
also den Serializer ändern, dass er so was generiert.</p>
<p>Aber zuletzt kann ich nun doch schlafen gehen:
released <a class="reference external" href="http://www.lino-framework.org/releases/2011/0415.html">/releases/2011/0415</a> und Upgrade in Eupen.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../index.html">
              <img class="logo" src="../../_static/logo.png" alt="Logo"/>
            </a></p>
<h3><a href="../../index.html">Table Of Contents</a></h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../index.html">Blog</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../about/index.html">About me</a></li>
</ul>

<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script><p align="center">
<a href="https://github.com/lsaffre" target="_blank">GitHub</a>
<br/><a href="http://www.lino-framework.org" target="_blank">Lino</a>
<br/><a href="http://www.saffre-rumma.net" target="_blank">Rumma & Ko</a>
</p>

        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="0419.html" title="20110419"
             >next</a> |</li>
        <li class="right" >
          <a href="0414.html" title="20110414"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Home</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Blog</a> &raquo;</li>
          <li class="nav-item nav-item-2"><a href="index.html" >2011</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2001-2015 Luc Saffre.
      Last updated on 2015-03-31.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.3.
    <a href="https://raw.github.com/lsaffre/blog/master/docs/blog/2011/0415.rst"
           rel="nofollow">Show Source</a>.
    <a href="http://luc.lino-framework.org/blog/2011/0415.html">Online Link</a>
    </div>
  </body>
</html>