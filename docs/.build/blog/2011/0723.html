<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>20110723 &mdash; Luc&#39;s website</title>
    
    <link rel="stylesheet" href="../../_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/centeredlogo.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/taglist.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/taglist_tags.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/sidebar.js"></script>
    <link rel="search" type="application/opensearchdescription+xml"
          title="Search within Luc&#39;s website"
          href="../../_static/opensearch.xml"/>
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
    <link rel="top" title="Luc&#39;s website" href="../../index.html" />
    <link rel="up" title="2011" href="index.html" />
    <link rel="next" title="20110725" href="0725.html" />
    <link rel="prev" title="20110722" href="0722.html" />
   
<script src="../../.htmldata/lightbox/js/jquery-1.11.0.min.js"></script>
<script src="../../.htmldata/lightbox/js/lightbox.min.js"></script>
<link href="../../.htmldata/lightbox/css/lightbox.css" rel="stylesheet" />

  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="0725.html" title="20110725"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="0722.html" title="20110722"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Home</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Blog</a> &raquo;</li>
          <li class="nav-item nav-item-2"><a href="index.html" accesskey="U">2011</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="id1">
<h1>20110723<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h1>
<div class="section" id="a-endspurt-vor-dem-release">
<h2>(a) Endspurt vor dem Release<a class="headerlink" href="#a-endspurt-vor-dem-release" title="Permalink to this headline">¶</a></h2>
<p>Die Testsuite habe ich aktualisiert,
also <code class="docutils literal"><span class="pre">python</span> <span class="pre">manage.py</span> <span class="pre">test</span></code> meldet keine Fehler mehr.</p>
<p>Beim Arbeiten mit <a class="reference external" href="http://www.lino-framework.org/dsbe/testlauf.html">/dsbe/testlauf</a> einen weiteren Bug in
<a class="reference external" href="http://www.lino-framework.org/ref/links.html#term-appy-pod" title="(in Lino v1.6)"><span class="xref std std-term">appy.pod</span></a> entdeckt und <a class="reference external" href="https://bugs.launchpad.net/appy/+bug/815019">gemeldet</a>.</p>
</div>
<div class="section" id="b-ubersetzungen">
<h2>(b) Übersetzungen<a class="headerlink" href="#b-ubersetzungen" title="Permalink to this headline">¶</a></h2>
<p>Die deutschen Sprachdateien wurden aktualisiert.</p>
</div>
<div class="section" id="c-proberelease-auf-jana">
<h2>(c) Proberelease auf Jana<a class="headerlink" href="#c-proberelease-auf-jana" title="Permalink to this headline">¶</a></h2>
<p>Also erstmal ein neues Dump vom Kunden nehmen.
Da muss jetzt manuell nur noch folgendes geändert werden:</p>
<ul>
<li><p class="first">In <cite>create_contacts_companytype</cite> den Parameter <cite>contract_type_id</cite> ignorieren:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">create_contacts_companytype</span><span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">abbr</span><span class="p">,</span> <span class="n">name_fr</span><span class="p">,</span> <span class="n">name_en</span><span class="p">,</span> <span class="n">abbr_fr</span><span class="p">,</span> <span class="n">abbr_en</span><span class="p">,</span> <span class="n">contract_type_id</span><span class="p">):</span>
    <span class="c"># return CompanyType(id=id,name=name,abbr=abbr,name_fr=name_fr,name_en=name_en,abbr_fr=abbr_fr,abbr_en=abbr_en,contract_type_id=contract_type_id)</span>
    <span class="k">return</span> <span class="n">CompanyType</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="nb">id</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span><span class="n">abbr</span><span class="o">=</span><span class="n">abbr</span><span class="p">,</span><span class="n">name_fr</span><span class="o">=</span><span class="n">name_fr</span><span class="p">,</span><span class="n">name_en</span><span class="o">=</span><span class="n">name_en</span><span class="p">,</span><span class="n">abbr_fr</span><span class="o">=</span><span class="n">abbr_fr</span><span class="p">,</span><span class="n">abbr_en</span><span class="o">=</span><span class="n">abbr_en</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p class="first">At the end, uncomment the automagic migration:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">lino.apps.dsbe.migrate</span> <span class="kn">import</span> <span class="n">install</span>
<span class="n">install</span><span class="p">(</span><span class="nb">globals</span><span class="p">())</span>
</pre></div>
</div>
</li>
</ul>
</div>
<div class="section" id="d-release-beim-kunden">
<h2>(d) Release beim Kunden<a class="headerlink" href="#d-release-beim-kunden" title="Permalink to this headline">¶</a></h2>
<p>Tests auf Jana sind positiv. Heute ist Samstag, also beim Kunden arbeitet niemand.
Los gehts.
Vorher noch notieren, welche Version momentan läuft:</p>
<div class="highlight-python"><div class="highlight"><pre>$ cd /var/snapshots/lino
$ hg sum
parent: 1668:0617446de660 tip
 20110623
branch: default
commit: (clean)
update: (current)
</pre></div>
</div>
<p>Aber ein Sprung zurück ist nicht nötig: scheint alles zu klappen.
Also hiermit erkläre ich Lino <a class="reference external" href="http://www.lino-framework.org/releases/2011/0723.html">/releases/2011/0723</a>
als losgelassen (released).
Kann aber sein, dass morgen noch Nachträge kommen.</p>
</div>
<div class="section" id="e-aktive-felder">
<h2>(e) Aktive Felder<a class="headerlink" href="#e-aktive-felder" title="Permalink to this headline">¶</a></h2>
<p>Das Detail-Fensters eines Vertrags
(Zusammenarbeit der drei Felder
<span class="guilabel">Stelle</span>,
<span class="guilabel">Stellenanbieter</span> und
<span class="guilabel">Vertreten durch</span>)
funktionierte noch nicht:
da waren erstens ein paar kleine Bugs, und zweitens hätte
ich Mühe gehabt, den Endbenutzern zu erklären, dass Lino
leider noch keine &#8220;active fields&#8221; kennt.
Da war es weniger Arbeit, dieses lang ersehnte
Feature zu implementieren:</p>
<ol class="arabic simple">
<li>Server-side field-level validation.
Beim Start sucht Lino in den Modellen nach Methoden <cite>on_FIELD_change</cite>,
deren Parameter ähnlich wie choosers analysiert werden.
&#8220;Active fields&#8221; : wenn die sich ändern, macht der Client ein GET für diesen Record,
wobei er aber auch alle anderen geänderten und noch nicht gespeicherten Felder mit
übergibt. Der Server macht darauf dann full_clean aber speichert nicht ab, sondern
gibt das nur zurück. So kann ich serverseitige field-level validation machen.
Auch für <cite>disabled_fields</cite> wäre das wichtig: je nach Vertragsart soll Feld Contract.refund_rate
disabled sein (und das soll sich nicht erst nach dem submit ändern).
GET /api/contacts/Persons/17?fmt=json&amp;query=foo</li>
</ol>
<p>Die Implementierung war allerdings noch etwas einfacher
als ich mir das damals gedacht hatte: statt eines neuen
&#8220;non-storing PUT&#8221; macht er einfach ein submit des kompletten
Formulars.</p>
<p>Also man kann in einem Report nun
eine Liste von &#8220;aktiven&#8221; Feldern
<code class="xref py py-attr docutils literal"><span class="pre">lino.reports.Report.active_fields</span></code>
angeben.
Ein aktives Feld bewirkt ein save (d.h. submit und refresh)
des Eingabefensters, wenn man es bearbeitet hat und
zum nächsten Feld springt.</p>
<p>Damit individuelles Spielen mit den disabled_fields effizienter ist,
enthält <code class="xref py py-attr docutils literal"><span class="pre">lino.reports.Report.fields_list</span></code> jetzt keine Feld-Instanzen mehr,
sondern nur noch die Feldnamen. (<code class="xref py py-func docutils literal"><span class="pre">lino.reports.fields_list()</span></code>
und
<code class="xref py py-func docutils literal"><span class="pre">lino.ui.extjs3.ext_store.DisabledFieldsStoreField()</span></code>)</p>
<p>Das Feld &#8220;Stellenanbieter&#8221; eines Vertrags
ist bis auf weiteres noch da, obschon es
vielleicht raus kann, weil die Drittorganisation in der Stelle definiert wird.
Die Frage ist, ob es Stellen gibt, bei denen der
Stellenanbieter von Vertrag zu Vertrag ändern kann. Eine andere Frage
ist, ob interne Verträge ihr Feld Stellenanbieter <em>leer</em> haben sollen,
oder ob dort das ausstellende ÖSHZ stehen soll. Logisch wäre eigentlich,
dass das Feld leer ist. Lino hat das bisher jedoch nicht nachgeprüft
und in den bestehenden Daten habe die internen Verträge dieses Feld
dann auch prompt mal leer und mal das ÖSHZ drinstehen.</p>
</div>
<div class="section" id="f-slave-grids-und-htmlfields-im-insert-fenster">
<h2>(f) Slave-Grids und HtmlFields im Insert-Fenster<a class="headerlink" href="#f-slave-grids-und-htmlfields-im-insert-fenster" title="Permalink to this headline">¶</a></h2>
<p>Das folgende Ticket ging auch recht schnell und kommt also noch in die
neue Version mit rein:</p>
<ol class="arabic simple">
<li>Slave-Grids und HtmlFields im Insert-Fenster sind jetzt zwar
disabled, aber sie machen trotzdem noch ein load &#8220;ihrer&#8221; Daten.
Das ist manchmal irritierend.</li>
</ol>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../index.html">
              <img class="logo" src="../../_static/logo.png" alt="Logo"/>
            </a></p>
<h3><a href="../../index.html">Table Of Contents</a></h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../index.html">Blog</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../about/index.html">About me</a></li>
</ul>

<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script><p align="center">
<a href="https://github.com/lsaffre" target="_blank">GitHub</a>
<br/><a href="http://www.lino-framework.org" target="_blank">Lino</a>
<br/><a href="http://www.saffre-rumma.net" target="_blank">Rumma & Ko</a>
</p>

        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="0725.html" title="20110725"
             >next</a> |</li>
        <li class="right" >
          <a href="0722.html" title="20110722"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Home</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Blog</a> &raquo;</li>
          <li class="nav-item nav-item-2"><a href="index.html" >2011</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2001-2015 Luc Saffre.
      Last updated on 2015-03-31.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.3.
    <a href="https://raw.github.com/lsaffre/blog/master/docs/blog/2011/0723.rst"
           rel="nofollow">Show Source</a>.
    <a href="http://luc.lino-framework.org/blog/2011/0723.html">Online Link</a>
    </div>
  </body>
</html>