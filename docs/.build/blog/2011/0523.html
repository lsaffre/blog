<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>20110523 &mdash; Luc&#39;s website</title>
    
    <link rel="stylesheet" href="../../_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/centeredlogo.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/taglist.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/taglist_tags.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/sidebar.js"></script>
    <link rel="search" type="application/opensearchdescription+xml"
          title="Search within Luc&#39;s website"
          href="../../_static/opensearch.xml"/>
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
    <link rel="top" title="Luc&#39;s website" href="../../index.html" />
    <link rel="up" title="2011" href="index.html" />
    <link rel="next" title="20110524" href="0524.html" />
    <link rel="prev" title="20110521" href="0521.html" />
   
<script src="../../.htmldata/lightbox/js/jquery-1.11.0.min.js"></script>
<script src="../../.htmldata/lightbox/js/lightbox.min.js"></script>
<link href="../../.htmldata/lightbox/css/lightbox.css" rel="stylesheet" />

  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="0524.html" title="20110524"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="0521.html" title="20110521"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Home</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Blog</a> &raquo;</li>
          <li class="nav-item nav-item-2"><a href="index.html" accesskey="U">2011</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="id1">
<h1>20110523<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h1>
<div class="section" id="formatierte-notizen">
<h2>Formatierte Notizen<a class="headerlink" href="#formatierte-notizen" title="Permalink to this headline">¶</a></h2>
<p>Nachdem ich vorige Woche hauptsächlich am
<a class="reference external" href="http://linux-blog.saffre-rumma.net/tups2mops.html">Umzug unseres Webservers</a>
und am Wochenende hauptsächlich im Garten gearbeitet habe,
geht es nun nach einer Atempause mit Lino weiter.
Als nächstes will ich das Thema mit den formatierten
Notizen in den Griff kriegen.
Ob ich das heute so weit kriege, dass selbst <em>ich</em> damit zufrieden bin?</p>
<p>Bisher haben wir auf den <a class="reference external" href="http://www.sencha.com/deploy/dev/docs/?class=Ext.form.HtmlEditor">Ext.form.HtmlEditor</a> verzichtet,
weil der relativ schwerfällig ist und scheinbar nicht ideal ist,
um für alle Textfelder einer Person oder eines Vertrags benutzt
zu werden.</p>
<p>Die folgenden Felder waren bisher ein <cite>fields.HtmlTextField</cite>
und sind nun <cite>models.TextField</cite>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">Contract</span><span class="o">.</span><span class="n">stages</span>
<span class="n">Contract</span><span class="o">.</span><span class="n">goals</span>
<span class="n">Contract</span><span class="o">.</span><span class="n">duties_asd</span>
<span class="n">Contract</span><span class="o">.</span><span class="n">duties_dsbe</span>
<span class="n">Contract</span><span class="o">.</span><span class="n">duties_company</span>
</pre></div>
</div>
<p>Aber <cite>notes.Note.body</cite> ist ja das einzige Textfeld
in einem eher einfachen Detail-Fenster.
Dort merkt man nichts von Performance-Einbußen.</p>
<p>Auch der Ausdruck funktioniert einfach,
indem ich in <a class="reference external" href="http://www.lino-framework.org/ref/links.html#term-appy-pod" title="(in Lino v1.6)"><span class="xref std std-term">appy.pod</span></a> die folgende Formel verwende:</p>
<div class="highlight-python"><div class="highlight"><pre>do text
from xhtml(self.body)
</pre></div>
</div>
<p>Aber...</p>
</div>
<div class="section" id="die-teufel-im-detail">
<h2>Die Teufel im Detail<a class="headerlink" href="#die-teufel-im-detail" title="Permalink to this headline">¶</a></h2>
<p>Genauer gesagt muss ich den HTML-Code vorher ein bisschen korrigieren.
Zum Beispiel muss ich momentan alle <code class="docutils literal"><span class="pre">&lt;br&gt;</span></code> durch <code class="docutils literal"><span class="pre">&lt;br/&gt;</span></code> ersetzen,
weil sonst der XML-Parser von <a class="reference external" href="http://www.lino-framework.org/ref/links.html#term-appy-pod" title="(in Lino v1.6)"><span class="xref std std-term">appy.pod</span></a> nicht mitspielt.
(Das ist bisher das einzige Beispiel, aber ich fürchte, dass noch
andere Fälle kommen werden. Bis auf weiteres regle ich das <em>on the fly</em>
in <code class="xref py py-func docutils literal"><span class="pre">lino.utils.printable.install_restify()</span></code>. Eine bessere Lösung wäre
freilich, wenn der HtmlEditor direkt gültiges XHTML produzieren würde...</p>
<p>Und eines fehlt auch noch: der HtmlEditor von ExtJS kann keine Titel
einfügen. Dazu gibt es aber
<a class="reference external" href="https://github.com/VinylFox/ExtJS.ux.HtmlEditor.Plugins">VinylFox</a>,
eine Plugin-Sammlung von <a class="reference external" href="http://www.vinylfox.com/about/">Shea Frederick</a>.</p>
<p>Neue Option <code class="xref py py-attr docutils literal"><span class="pre">lino.Lino.use_vinylfox</span></code>.
Der Einfachheit halber füge ich VinylFox zu den Lino-Sourcen hinzu,
um die Installation einfach zu halten.</p>
<p>Hmm... aber so richtig super funktionieren Sheas Plugins
wohl eherlich gesagt nicht.
Zumindest nicht in Google Chrome. Tabellen sind unbenutzbar.
Bon, also schalten wir die ab. Von UndoRedo sehe ich auch nichts. Schade.
Raus damit.
Und das, wofür ich ihn eigentlich haben wollte, nämlich die Heading-Zuweisung,
funktioniert zwar, aber auch da sind einige störende Bugs.
Zum Beispiel man kann einen einmal zugewiesenen Titel nicht wieder zu normalem Text machen.</p>
<p>Nö, ich denke, die Option <code class="xref py py-attr docutils literal"><span class="pre">lino.Lino.use_vinylfox</span></code>
bleibt vorerst noch auf <cite>False</cite> stehen.</p>
<p>Aber wenn wir uns nun auf die im ExtJS bestehenden Features beschränken,
kriegen wir doch noch Probleme.</p>
<p>Jetzt muss ich erst nochmal in meiner Kopie von appy.pod wursteln:
Zum Testen ist nämlich die AppyPdfBuildMethod bequem,
weil er das Resultat dann sofort anzeigt.
Aber wenn beim Parsen des HTML-Codes ein Fehler auftritt (was ja momentan häufig passiert),
dann wird der Traceback in der PDF-Datei nicht sichtbar.
Ich kann dann freilich immer nach AppyOdtBuildMethod umschalten,
aber das ist umständlich.</p>
<p>Außerdem nützt mir die Fehlermeldung des SAX-Parsers nichts, denn die lautet:</p>
<div class="highlight-python"><div class="highlight"><pre>20110523 &lt;unknown&gt;:1:577: undefined entity
</pre></div>
</div>
<p>Woher bitteschön will ich daraus erkennen, worüber er genau stolpert?
Okay, ich lass appy.pod meinen String in eine Datei <cite>20110523.log</cite>
schreiben, die ich dann mit meinem Editor anschauen kann. Also nach viel
Würgen finde ich raus, dass expat den Fehler an der folgenden Stelle
meldet:</p>
<div class="highlight-python"><div class="highlight"><pre>&lt;p&gt;&lt;span style=&quot;background-color: rgb(255, 255, 255); &quot; id=&quot;ext-gen416&quot;&gt;Also
...&lt;span style=&quot;background-color: rgb(255, 255, 255);&quot;&gt;&amp;nbsp;...&lt;/span&gt;
                                                      ^
                                                      (hier ist Position 577)
</pre></div>
</div>
<p>Na toll... kann mir nun einer erklären, was daran falsch sein soll?</p>
<p>Nach weiteren Versuchen entdecke ich, dass die Positionsnummer 577
auf das <code class="docutils literal"><span class="pre">&amp;nbsp;</span></code> zeigen wollte. Und wenn ich weniger dumm wäre,
hätte ich sogleich geahnt, dass XHTML keine <em>named entities</em> kennt.
Und das ist nicht alles:
SelfHTML erklärt die
<a class="reference external" href="http://de.selfhtml.org/html/xhtml/unterschiede.htm">Unterschiede zwischen XHTML und HTML</a>
übersichtlich.</p>
<p>Also kurz: die <cite>xhtml</cite> von <cite>appy.pod</cite> will XHTML kriegen,
und unser HtmlEditor schreibt natürlich HTML.</p>
<p>Hm, gibt es denn keinen fertigen Konverter von HTML nach XHTML?
Na klar, <a class="reference external" href="http://www.it.uc3m.es/jaf/html2xhtml/">http://www.it.uc3m.es/jaf/html2xhtml/</a>
aber der ist in C geschrieben, da müsste ich also
entweder einen Python-Extension schreiben (hab ich noch nie gemacht),
oder einen externen Prozess aufrufen
(und zwar bei jedem Rendern eines Dokuments).
Daher das neue Modul <a class="reference external" href="http://www.lino-framework.org/api/lino.utils.html2xhtml.html#module-lino.utils.html2xhtml" title="(in Lino v1.6)"><code class="xref py py-mod docutils literal"><span class="pre">lino.utils.html2xhtml</span></code></a>.</p>
<p>Aber noch bevor <a class="reference external" href="http://www.lino-framework.org/api/lino.utils.html2xhtml.html#module-lino.utils.html2xhtml" title="(in Lino v1.6)"><code class="xref py py-mod docutils literal"><span class="pre">lino.utils.html2xhtml</span></code></a> auch nur
annähernd funktionsfähig wurde, fällt mir auf:
eigentlich ist es Quatsch, mein HTML zuerst
nach XHTML zu konvertieren, um es dann von appy.pod nach ODF-XML
konvertieren zu lassen. Effizienter wäre doch, wenn ich direkt
ODF-XML schreibe. Und einen Anfang zufür habe ich ja schon,
nämlich in timtools.gendoc und timtools.oogen.
Also könnte ich es mal auf die selbstgeschneiderte Art versuchen:
<code class="xref py py-mod docutils literal"><span class="pre">lino.utils.html2odt_old</span></code>.
Dachte ich mir.
Aber nach einigem Hantieren habe ich diesen Weg wieder
aufgegeben, bevor ich erste Resultate gesehen habe.
Denn appy.pod macht ja doch eine ziemliche Arbeit beim
Generieren des ODF-XML.</p>
<p>Die xhtml-Dunktion von appy.pod ist hauptsächlich für Kupu gedacht.
Das ist der Wysiwyg-Editor von Plone, und der speichert seine
Sachen eben nicht in HTML, sondern in XHTML.
Ich habe den mal runtergeladen und probiert zu verstehen,
ob der sich für Lino nutzen lassen würde.
Aber das scheint zumindest nicht trivial.
Lassen wir das.</p>
<p>Andrew Mayorov hat eine
<a class="reference external" href="http://blogs.byte-force.com/xor/tinymce/index.html">TinyMCE-Komponente für ExtJS</a>
geschrieben, deren Demo vielversprechend aussieht.
Um die benutzen zu können, mus ich erstmal
<a class="reference external" href="http://tinymce.moxiecode.com/download/download.php">TinyMCE</a>
selber installieren
(unter Debian einfach nur <code class="docutils literal"><span class="pre">aptitude</span> <span class="pre">install</span> <span class="pre">tinymce</span></code>).</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../index.html">
              <img class="logo" src="../../_static/logo.png" alt="Logo"/>
            </a></p>
<h3><a href="../../index.html">Table Of Contents</a></h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../index.html">Blog</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../about/index.html">About me</a></li>
</ul>

<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script><p align="center">
<a href="https://github.com/lsaffre" target="_blank">GitHub</a>
<br/><a href="http://www.lino-framework.org" target="_blank">Lino</a>
<br/><a href="http://www.saffre-rumma.net" target="_blank">Rumma & Ko</a>
</p>

        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="0524.html" title="20110524"
             >next</a> |</li>
        <li class="right" >
          <a href="0521.html" title="20110521"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Home</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Blog</a> &raquo;</li>
          <li class="nav-item nav-item-2"><a href="index.html" >2011</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">

<a rel="license" href="http://creativecommons.org/licenses/by-sa/2.5/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-sa/2.5/88x31.png" /></a>
This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-sa/2.5/">Creative Commons Attribution-ShareAlike 2.5 Generic License</a>.<br />
      Last updated on 2015-03-31.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.3.
<a href="../../_sources/blog/2011/0523.txt">Show Source</a> 
    <a href="http://luc.lino-framework.org/blog/2011/0523.html">Online Link</a>
    </div>
  </body>
</html>