<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>20110727 &mdash; Luc&#39;s website</title>
    
    <link rel="stylesheet" href="../../_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/centeredlogo.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/taglist.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/taglist_tags.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/sidebar.js"></script>
    <link rel="search" type="application/opensearchdescription+xml"
          title="Search within Luc&#39;s website"
          href="../../_static/opensearch.xml"/>
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
    <link rel="top" title="Luc&#39;s website" href="../../index.html" />
    <link rel="up" title="2011" href="index.html" />
    <link rel="next" title="20110728" href="0728.html" />
    <link rel="prev" title="20110726" href="0726.html" />
   
<script src="../../.htmldata/lightbox/js/jquery-1.11.0.min.js"></script>
<script src="../../.htmldata/lightbox/js/lightbox.min.js"></script>
<link href="../../.htmldata/lightbox/css/lightbox.css" rel="stylesheet" />

  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="0728.html" title="20110728"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="0726.html" title="20110726"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Home</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Blog</a> &raquo;</li>
          <li class="nav-item nav-item-2"><a href="index.html" accesskey="U">2011</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="id1">
<h1>20110727<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h1>
<div class="section" id="upgrade-in-eupen">
<h2>Upgrade in Eupen<a class="headerlink" href="#upgrade-in-eupen" title="Permalink to this headline">¶</a></h2>
<p>Ich mache ein Upgrade in Eupen wegen des Bugs &#8220;Lino verweigerte das Löschen nicht immer&#8221;.
So ein Upgrade ist ja inzwischen Routinearbeit:
Zunächst ein <a class="reference external" href="http://www.lino-framework.org/ref/glossary.html#term-dump" title="(in Lino v1.6)"><span class="xref std std-term">dump</span></a> beim Kunden machen
und auf Jana testen, ob es mit der neuen Version eingelesen wird...
Upps, und prompt passiert was Neues:</p>
</div>
<div class="section" id="memoryerror">
<h2>MemoryError<a class="headerlink" href="#memoryerror" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python"><div class="highlight"><pre>Problem installing fixture &#39;/usr/local/django/myproject/fixtures/d20110727.py&#39;: Traceback (most recent call last):
  File &quot;/var/snapshots/django/django/core/management/commands/loaddata.py&quot;, line 169, in handle
    for obj in objects:
  File &quot;/var/snapshots/lino/lino/utils/dpy.py&quot;, line 352, in Deserializer
    module = imp.load_module(fqname, fp, fp.name, desc)
MemoryError
</pre></div>
</div>
<p>Nun ja, die Dump-Datei ist ein 6MB großes Python-Modul ohne Kommentare...
und Jana ist eine virtuelle Maschine auf einem Proxmox-Server
mit nur 512 MB Memory und 512 MB Swap.
Es reichte, den Swap-Speicher auf 1024 zu erhöhen.</p>
<p>Aber es gibt also eine theoretische Grenze für dpy-Dumps: den Arbeitsspeicher.
Falls das mal akut werden sollte, müsste man die Dump-Datei manuell in zwei Module teilen.</p>
</div>
<div class="section" id="automatische-tasks-und-lino-utils-dpy-deserializer">
<h2>Automatische Tasks und <code class="xref py py-class docutils literal"><span class="pre">lino.utils.dpy.Deserializer</span></code><a class="headerlink" href="#automatische-tasks-und-lino-utils-dpy-deserializer" title="Permalink to this headline">¶</a></h2>
<p>Dann noch eine Überraschung:</p>
<div class="highlight-python"><div class="highlight"><pre>INFO Deferred Task #436 (#436) : {&#39;id&#39;: [u&#39;Aufgabe mit diesem ID existiert bereits.&#39;]}
INFO Deferred Task #437 (#437) : {&#39;id&#39;: [u&#39;Aufgabe mit diesem ID existiert bereits.&#39;]}
INFO Deferred Task #438 (#438) : {&#39;id&#39;: [u&#39;Aufgabe mit diesem ID existiert bereits.&#39;]}
INFO Deferred Task #439 (#439) : {&#39;id&#39;: [u&#39;Aufgabe mit diesem ID existiert bereits.&#39;]}
INFO Deferred Task #440 (#440) : {&#39;id&#39;: [u&#39;Aufgabe mit diesem ID existiert bereits.&#39;]}
INFO Deferred Task #441 (#441) : {&#39;id&#39;: [u&#39;Aufgabe mit diesem ID existiert bereits.&#39;]}
INFO Deferred Task #442 (#442) : {&#39;id&#39;: [u&#39;Aufgabe mit diesem ID existiert bereits.&#39;]}
INFO Deferred Task #443 (#443) : {&#39;id&#39;: [u&#39;Aufgabe mit diesem ID existiert bereits.&#39;]}
INFO Saved 0 instances.
WARNING Abandoning with 440 unsaved instances from t:\data\luc\lino\dsbe\fixtures\d20110727.py.
Problem installing fixture &#39;t:\data\luc\lino\dsbe\fixtures\d20110727.py&#39;: Traceback (most recent call last):
  File &quot;l:\snapshots\django\django\core\management\commands\loaddata.py&quot;, line 174, in handle
    obj.save(using=using)
  File &quot;t:\hgwork\lino\lino\utils\dpy.py&quot;, line 288, in save
    &quot;See dblog for details.&quot; % len(save_later))
Exception: Abandoned with 440 unsaved instances. See dblog for details.
</pre></div>
</div>
<p>Richtig, da hatte ich bisher nicht dran gedacht: beim Einlesen eines Dumps darf er
nun nicht mehr automatische Tasks generieren.
Deshalb die neue <code class="xref py py-func docutils literal"><span class="pre">lino.utils.dpy.is_deserializing()</span></code>.</p>
</div>
<div class="section" id="noch-kleine-wunsche">
<h2>Noch kleine Wünsche<a class="headerlink" href="#noch-kleine-wunsche" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><code class="xref py py-class docutils literal"><span class="pre">lino.modlib.jobs.models.Job</span></code> ist jetzt par défaut nach &#8216;name&#8217; sortiert (<cite>Meta.ordering</cite>).
Checkin 20110727</li>
<li>Upps, das erste System mit <cite>is_deserializing</cite> zum Verhindern der automiatischen Tasks
funktionierte zwar zum Laden des
dumps, aber da war ein Denkfehler: es ist dann für <em>alle</em> Fixtures aktiv,
auch für &#8220;intelligente&#8221; fixtures wie die <code class="docutils literal"><span class="pre">demo</span></code>.
Es soll nur im Falle von dumps aktiv sein.
Deshalb jetzt die neue globale Variable
<code class="xref py py-attr docutils literal"><span class="pre">lino.modlib.cal.models.SKIP_AUTO_TASKS</span></code>,
die in <code class="xref py py-func docutils literal"><span class="pre">lino.apps.dsbe.migrate.install()</span></code> auf <cite>True</cite> gesetzt wird</li>
<li>Im Detail <cite>lino.modlib.jobs.models.Job</cite> fehlte noch die Kapazität.</li>
</ul>
<p>Installation in Eupen um 9 Uhr gerade rechtzeitig zum Tagesbeginn,
und somit erkläre ich Lino <a class="reference external" href="http://www.lino-framework.org/releases/2011/0727.html">/releases/2011/0727</a> als released.</p>
</div>
<div class="section" id="another-bug-less-in-watch-tim">
<h2>Another bug less in watch_tim<a class="headerlink" href="#another-bug-less-in-watch-tim" title="Permalink to this headline">¶</a></h2>
<p>Noch ein subtiler Bug:</p>
<div class="highlight-python"><div class="highlight"><pre>Traceback (most recent call last):
  File &quot;/var/snapshots/lino/lino/apps/dsbe/management/commands/watch_tim.py&quot;, line 430, in watch
    process_line(i,ln)
  File &quot;/var/snapshots/lino/lino/apps/dsbe/management/commands/watch_tim.py&quot;, line 403, in process_line
    m(**kw)
  File &quot;/var/snapshots/lino/lino/apps/dsbe/management/commands/watch_tim.py&quot;, line 165, in PUT
    return self.POST(**kw)
  File &quot;/var/snapshots/lino/lino/apps/dsbe/management/commands/watch_tim.py&quot;, line 298, in POST
    self.PUT(**kw)
  File &quot;/var/snapshots/lino/lino/apps/dsbe/management/commands/watch_tim.py&quot;, line 165, in PUT
  ...
  File &quot;/usr/lib/python2.6/copy.py&quot;, line 189, in deepcopy
    y = _reconstruct(x, rv, 1, memo)
  File &quot;/usr/lib/python2.6/copy.py&quot;, line 322, in _reconstruct
    args = deepcopy(args, memo)
  File &quot;/usr/lib/python2.6/copy.py&quot;, line 162, in deepcopy
    y = copier(x, memo)
  File &quot;/usr/lib/python2.6/copy.py&quot;, line 235, in _deepcopy_tuple
    y.append(deepcopy(a, memo))
  File &quot;/usr/lib/python2.6/copy.py&quot;, line 192, in deepcopy
    _keep_alive(x, memo) # Make sure x lives at least as long as d
  File &quot;/usr/lib/python2.6/copy.py&quot;, line 272, in _keep_alive
    memo[id(memo)].append(x)
KeyError: 31235952
</pre></div>
</div>
<p>Dieser Bug kam, wenn man in TIM in der PXS etwas änderte und diese
Person in Lino nicht existierte (aus welchen Gründen auch immer).
In so einem Fall bleibt Lino nichts anderes übrig, als die Information
zu ignorieren, weil er den Namen der Person nicht kennt und sie folglich
nicht implizit erstellen kann.</p>
<p>Lösung: siehe docstring von
<code class="xref py py-attr docutils literal"><span class="pre">lino.apps.dsbe.management.commands.watch_tim.PXS.allow_put2post</span></code>.
Jetzt macht er in diesem Fall eine Warnung
<code class="docutils literal"><span class="pre">PXS:0000020475</span> <span class="pre">:</span> <span class="pre">PUT</span> <span class="pre">ignored</span> <span class="pre">(row</span> <span class="pre">does</span> <span class="pre">not</span> <span class="pre">exist)</span></code>
statt eines Tracebacks.</p>
</div>
<div class="section" id="miscellaneous-bugfixes">
<h2>Miscellaneous bugfixes<a class="headerlink" href="#miscellaneous-bugfixes" title="Permalink to this headline">¶</a></h2>
<p>Das folgende Problem war ein echter kleine Bug:</p>
<ol class="arabic simple">
<li>Stellenanfragen können momentan nicht erstellt werden.
Grid ohne Detail reagiert nicht auf Doppelklick auf dem phantom record.</li>
</ol>
<p>In Grids, die auch ein unformatiertes TextField enthielten, konnte man weder
bearbeiten noch Zeilen einfügen, weil er dann fälschlicherweise versuchte,
<cite>Ext.form.TextArea.refresh()</cite> aufzurufen.</p>
<p>Dann noch ein Problem, dessen Identifizierung allein einige Mühe
gefordert hat:</p>
<ol class="arabic simple">
<li>Wenn man über das Detail einer Stelle auf einen Vertrag in dieser Stelle
geht und dort die Stelle ändert, dann kommt Lino durcheinander, weil er
den Boden unter den Füßen weggezogen bekommen hat: ContractsByJob/123
existiert plötzlich nicht mehr. Er müsste dann automagisch nach
Contracts/123 springen. Was voraussichtlich lediglich zur Folge hätte,
dass die Navigationsbuttons prev/next/last/first deaktiviert würden.
Oder das Feld &#8220;Stelle&#8221; sollte readonly sein, aber dann brauchen wir
einen neuen Button, um z.B. von ContractsByJob/123 nach Contracts/123
springen zu können.</li>
</ol>
<p>Erklärung und Lösung sind verblüffend einfach:
Wenn man im Detail-Fenster einen Record so verändert,
dass er aus der Liste verschwindet, dann merkt Lino das und springt
auf den ersten Record der Liste zurück.
Aber was passiert, wenn es keinen &#8220;ersten Record der Liste&#8221; mehr gibt,
weil der verschwundene Record der Letzte der Liste war?
Genau das oben Beschriebene.
Dieses Verhalten ist schon seit eh und je da,
aber offenbar ist der Fall noch nicht oft aufgetreten.
Jetzt kommt dann der freundliche Hinweis
&#8220;No more records to display. Detail window has been closed.&#8221;</p>
<p>Der Titel eines Detail-Fensters ist jetzt nicht mehr einfach
nur <cite>unicode(elem)</cite>, sondern &#8220;Listentitel » Element&#8221;.
Also z.B. statt bisher &#8220;Max MUSTERMANN (97)&#8221; steht dort jetzt
&#8220;Personen » Max MUSTERMANN (97)&#8221;</p>
<p>Die dummy_messages.py wurde schon seit Längerem zu früh geschrieben,
so dass die Texte aus der <a class="reference external" href="http://www.lino-framework.org/ref/files.html#xfile-linolib.js" title="(in Lino v1.6)"><code class="xref std std-xfile docutils literal"><span class="pre">linolib.js</span></code></a> nicht drin waren.
Behoben. Oder auch nicht.
Erstmals richtig eigentlich erst am <a class="reference external" href="http://code.google.com/p/lino/source/browse/docs/blog/2011/0826.rst">2011-08-26</a>.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../index.html">
              <img class="logo" src="../../_static/logo.png" alt="Logo"/>
            </a></p>
<h3><a href="../../index.html">Table Of Contents</a></h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../index.html">Blog</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../about/index.html">About me</a></li>
</ul>

<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script><p align="center">
<a href="https://github.com/lsaffre" target="_blank">GitHub</a>
<br/><a href="http://www.lino-framework.org" target="_blank">Lino</a>
<br/><a href="http://www.saffre-rumma.net" target="_blank">Rumma & Ko</a>
</p>

        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="0728.html" title="20110728"
             >next</a> |</li>
        <li class="right" >
          <a href="0726.html" title="20110726"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Home</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Blog</a> &raquo;</li>
          <li class="nav-item nav-item-2"><a href="index.html" >2011</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2001-2015 Luc Saffre.
      Last updated on 2015-03-31.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.3.
    <a href="https://raw.github.com/lsaffre/blog/master/docs/blog/2011/0727.rst"
           rel="nofollow">Show Source</a>.
    <a href="http://luc.lino-framework.org/blog/2011/0727.html">Online Link</a>
    </div>
  </body>
</html>