<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>20111001 &mdash; Luc&#39;s website</title>
    
    <link rel="stylesheet" href="../../_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/centeredlogo.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/taglist.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/taglist_tags.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/sidebar.js"></script>
    <link rel="search" type="application/opensearchdescription+xml"
          title="Search within Luc&#39;s website"
          href="../../_static/opensearch.xml"/>
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
    <link rel="top" title="Luc&#39;s website" href="../../index.html" />
    <link rel="up" title="2011" href="index.html" />
    <link rel="next" title="20111003" href="1003.html" />
    <link rel="prev" title="20110930" href="0930.html" />
   
<script src="../../.htmldata/lightbox/js/jquery-1.11.0.min.js"></script>
<script src="../../.htmldata/lightbox/js/lightbox.min.js"></script>
<link href="../../.htmldata/lightbox/css/lightbox.css" rel="stylesheet" />

  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="1003.html" title="20111003"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="0930.html" title="20110930"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Home</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Blog</a> &raquo;</li>
          <li class="nav-item nav-item-2"><a href="index.html" accesskey="U">2011</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="id1">
<h1>20111001<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h1>
<div class="section" id="enablechild-fields-on-the-children">
<h2>EnableChild fields on the children<a class="headerlink" href="#enablechild-fields-on-the-children" title="Permalink to this headline">¶</a></h2>
<p>Ha! hier noch ein subtiles fundamentales Problem, das z.B. im Detail
eines Kursanbieters auftritt:
hier stehen im Reiter &#8220;Allgemein&#8221; auch
die <a class="reference external" href="http://www.lino-framework.org/api/lino.utils.mti.html#lino.utils.mti.EnableChild" title="(in Lino v1.6)"><code class="xref py py-class docutils literal"><span class="pre">lino.utils.mti.EnableChild</span></code></a>-Felder
<cite>is_courseprovider</cite> und <cite>is_employer</cite>, die da aber nicht hingehören.
Die kommen aus dem Detail von Organisation, die dürfen aber nur auf einer
&#8220;reinen&#8221; Organisation angezeigt werden.
Wenn dieses Feld auf einem Kursanbieter angezeigt wird, muss es wenigstens
schreibgeschützt (und eingeschaltet) sein.</p>
<p>Das Feld is_employer braucht nicht schreibgeschützt zu sein, aber die
Setter-Funktionen (<a class="reference external" href="http://www.lino-framework.org/api/lino.utils.mti.html#lino.utils.mti.insert_child" title="(in Lino v1.6)"><code class="xref py py-func docutils literal"><span class="pre">lino.utils.mti.insert_child()</span></code></a> und
<a class="reference external" href="http://www.lino-framework.org/api/lino.utils.mti.html#lino.utils.mti.delete_child" title="(in Lino v1.6)"><code class="xref py py-func docutils literal"><span class="pre">lino.utils.mti.delete_child()</span></code></a>)
müssten dann berücksichtigen, dass sie auch von einem
CourseProvider aus gerufen werden können.
Was nicht einfach zu implementieren und eher unlogisch wäre.</p>
<p>Eigentlich müssten beide Felder eher einfach nur deaktiviert sein,
wenn das Detail nicht direkt auf Organisation ist.
Genau, das geht: VirtualField hat eine neue Methode <cite>is_enabled</cite>,
die von EnableChild überschrieben wird.</p>
<p>Außerdem eine neue Warnung &#8220;Cannot show MTI child if checkbox is off.&#8221;,
wenn man auf den Link &#8220;zeigen&#8221; eines <a class="reference external" href="http://www.lino-framework.org/api/lino.utils.mti.html#lino.utils.mti.EnableChild" title="(in Lino v1.6)"><code class="xref py py-class docutils literal"><span class="pre">lino.utils.mti.EnableChild</span></code></a>-Feldes klickt,
das abgeschaltet ist. Also z.B. wenn eine Organisation <em>kein</em> Kursanbieter
ist (checkbox is off) und man trotzdem bei Kursanbieter auf &#8220;zeigen&#8221;
klickt. Bisher öffnete er dann trotzdem ein Fenster und versuchte diese
Organisation als Kursanbieter anzuzeigen (was dann logischerweise misslang).</p>
</div>
<div class="section" id="a-courseprovider-cannot-be-parent-for-a-jobprovider">
<h2>A CourseProvider cannot be parent for a JobProvider<a class="headerlink" href="#a-courseprovider-cannot-be-parent-for-a-jobprovider" title="Permalink to this headline">¶</a></h2>
<p>Wenn man versuchte, einen Kursanbieter direkt zu erstellen
(nicht indem man auf einer bestehenden Organisation das Feld
&#8220;Kursanbieter&#8221; ankreuzt), dann kam dieser Traceback auf dem Server:</p>
<div class="highlight-python"><div class="highlight"><pre>Traceback (most recent call last):
  File &quot;t:\hgwork\lino\lino\ui\extjs3\ext_store.py&quot;, line 656, in form2obj
    f.form2obj(request,instance,form_values,is_new)
  File &quot;t:\hgwork\lino\lino\ui\extjs3\ext_store.py&quot;, line 344, in form2obj
    self.vf.set_value_in_object(request,obj,v)
  File &quot;t:\hgwork\lino\lino\utils\mti.py&quot;, line 186, in set_value_in_object
    insert_child(obj,self.child_model)
  File &quot;t:\hgwork\lino\lino\utils\mti.py&quot;, line 123, in insert_child
    obj.__class__.__name__,child_model.__name__))
Exception: A CourseProvider cannot be parent for a JobProvider
</pre></div>
</div>
<p>Erklärung: disabled fields werden offenbar beim Submit mit übergeben,
und Lino ruft dann die Setter-Funktion <a class="reference external" href="http://www.lino-framework.org/api/lino.utils.mti.html#lino.utils.mti.delete_child" title="(in Lino v1.6)"><code class="xref py py-func docutils literal"><span class="pre">lino.utils.mti.delete_child()</span></code></a>
auf. Außerdem war da ein Bug in meiner <cite>serializeForm</cite>:
schreibgeschützte Checkboxen wurden als <em>eingeschaltet</em> gepostet.
Das kam daher, dass ExtJS für die HTML-Definition schreibgeschützter Checkboxen
nicht mit <cite>disabled</cite>, sondern <cite>readonly</cite> verwendet.
Hier die HTML-Definition der Checkbox:</p>
<div class="highlight-python"><div class="highlight"><pre>&lt;input type=&quot;checkbox&quot;
autocomplete=&quot;off&quot; id=&quot;ext-comp-1332&quot;
name=&quot;is_jobprovider&quot;
class=&quot; x-form-checkbox x-form-field&quot;
readonly=&quot;&quot;&gt;
</pre></div>
</div>
<p>Zum Vergleich die HTML-Definition eines schreibgeschützten Textfeldes:</p>
<div class="highlight-python"><div class="highlight"><pre>&lt;input type=&quot;text&quot; size=&quot;20&quot; autocomplete=&quot;off&quot; id=&quot;ext-comp-1604&quot;
name=&quot;name&quot; class=&quot;x-form-text x-form-field x-item-disabled&quot;
style=&quot;width: 332px; &quot; disabled=&quot;&quot;&gt;
</pre></div>
</div>
<p>Lösung war, dass ich in meiner <cite>Ext.lib.Ajax.serializeForm</cite> die Zeile</p>
<dl class="docutils">
<dt>::</dt>
<dd>if (!(type == &#8216;submit&#8217; &amp;&amp; hasSubmit)) {</dd>
</dl>
<p>ersetze durch</p>
<div class="highlight-python"><div class="highlight"><pre>if (!(/radio|checkbox/i.test(type) &amp;&amp; !element.readonly) &amp;&amp; !(type == &#39;submit&#39; &amp;&amp; hasSubmit)) {
</pre></div>
</div>
<p>Diese beiden Bugfixes kommen noch mit in die <a class="reference external" href="http://www.lino-framework.org/releases/2011/0930.html">/releases/2011/0930</a>.</p>
</div>
<div class="section" id="noch-ein-serioser-bug">
<h2>Noch ein seriöser Bug<a class="headerlink" href="#noch-ein-serioser-bug" title="Permalink to this headline">¶</a></h2>
<p>Virtuelle Checkboxen funktionierten gestern noch immer nicht,
und ich würde sogar sagen, dass da auch &#8220;schon immer&#8221;
seriöse Bugs beim submitten von checkboxes waren.
Das sage ich aber nur theoretisch, denn ich habe keine Erklärung,
weshalb das nicht schon früher aufgefallen ist (das wäre eine Doktorarbeit
wert, aber dazu habe ich momentan nicht die Muße).</p>
<p>Jedenfalls deshalb noch ein Nachtrag von Checkins &#8220;20111002&#8221;,
und das Ganze kommt ebenfalls noch mit in die <a class="reference external" href="http://www.lino-framework.org/releases/2011/0930.html">/releases/2011/0930</a>.</p>
</div>
<div class="section" id="noch-kleine-bugs">
<h2>Noch kleine Bugs<a class="headerlink" href="#noch-kleine-bugs" title="Permalink to this headline">¶</a></h2>
<p>Der Link &#8220;show&#8221; auf einer EnableChild
funktionierte erstes überhaupt nicht, weil die
Warnung &#8220;Cannot show MTI child if checkbox is off.&#8221; noch nicht richtig testete.
Und zweitens öffnet er jetzt das Detail-Fenster direkt,
ohne ein neues Browserfenster zu öffnen.</p>
<p>Checkin &#8220;20111002b&#8221;</p>
<p><a class="reference external" href="http://www.lino-framework.org/api/lino.modlib.users.html#module-lino.modlib.users" title="(in Lino v1.6)"><code class="xref py py-mod docutils literal"><span class="pre">lino.modlib.users</span></code></a> wurde noch gar nicht übersetzt.
Behoben.</p>
<p>Außerdem wurde Company an manchen Stellen noch durch &#8220;Firma&#8221;
statt &#8220;Organisation&#8221; übersetzt.
Der englische Name &#8220;Company&#8221; ist eigentlich
irreführend, eigentlich müsste es auch in Englisch &#8220;Organization&#8221; heißen.
Aber das ist so ein langes Wort...</p>
<p>Checkin &#8220;20111002c&#8221;</p>
<p>Die Reihenfolge der Felder type und event_type in den Notizen
(deren Bedeutung intern ausgetauscht wurde)
war noch nicht überall so, wie die Benutzer es gewohnt sind.</p>
<p>Checkin &#8220;20111002d&#8221;</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../index.html">
              <img class="logo" src="../../_static/logo.png" alt="Logo"/>
            </a></p>
<h3><a href="../../index.html">Table Of Contents</a></h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../index.html">Blog</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../about/index.html">About me</a></li>
</ul>

<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script><p align="center">
<a href="https://github.com/lsaffre" target="_blank">GitHub</a>
<br/><a href="http://www.lino-framework.org" target="_blank">Lino</a>
<br/><a href="http://www.saffre-rumma.net" target="_blank">Rumma & Ko</a>
</p>

        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="1003.html" title="20111003"
             >next</a> |</li>
        <li class="right" >
          <a href="0930.html" title="20110930"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Home</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Blog</a> &raquo;</li>
          <li class="nav-item nav-item-2"><a href="index.html" >2011</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2001-2015 Luc Saffre.
      Last updated on 2015-03-31.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.3.
    <a href="https://raw.github.com/lsaffre/blog/master/docs/blog/2011/1001.rst"
           rel="nofollow">Show Source</a>.
    <a href="http://luc.lino-framework.org/blog/2011/1001.html">Online Link</a>
    </div>
  </body>
</html>