<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>20110303 &mdash; Luc&#39;s website</title>
    
    <link rel="stylesheet" href="../../_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/centeredlogo.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/taglist.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/taglist_tags.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/sidebar.js"></script>
    <link rel="search" type="application/opensearchdescription+xml"
          title="Search within Luc&#39;s website"
          href="../../_static/opensearch.xml"/>
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
    <link rel="top" title="Luc&#39;s website" href="../../index.html" />
    <link rel="up" title="2011" href="index.html" />
    <link rel="next" title="20110304" href="0304.html" />
    <link rel="prev" title="20110302" href="0302.html" />
   
<script src="../../.htmldata/lightbox/js/jquery-1.11.0.min.js"></script>
<script src="../../.htmldata/lightbox/js/lightbox.min.js"></script>
<link href="../../.htmldata/lightbox/css/lightbox.css" rel="stylesheet" />

  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="0304.html" title="20110304"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="0302.html" title="20110302"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Home</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Blog</a> &raquo;</li>
          <li class="nav-item nav-item-2"><a href="index.html" accesskey="U">2011</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="id1">
<h1>20110303<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h1>
<div class="section" id="vorbereitungen-demo-in-parnu">
<h2>Vorbereitungen Demo in Pärnu<a class="headerlink" href="#vorbereitungen-demo-in-parnu" title="Permalink to this headline">¶</a></h2>
<p>6.20 Uhr. Cool: Babel-Felder werden jetzt automatisch expandiert.
Also (zumindest deswegen) sind keine lokalen .dtl-Dateien mehr nötig.</p>
<p>8 Uhr. Release <a class="reference external" href="http://www.lino-framework.org/releases/2011/0303.html">/releases/2011/0303</a> and Upgrade in Pärnu.</p>
</div>
<div class="section" id="upgrade-nach-1-1-6-in-eupen">
<h2>Upgrade nach 1.1.6 in Eupen<a class="headerlink" href="#upgrade-nach-1-1-6-in-eupen" title="Permalink to this headline">¶</a></h2>
<p>10 Uhr. Ich nutze den Altweiberdonnerstag aus, um auch in Eupen
den Lino auf 1.1.6 zu heben.</p>
<p>Abgesehen von den erwarteten
Anpassungen im .dpy-Dump hatte ich
auch folgende Überraschung:</p>
<div class="highlight-python"><div class="highlight"><pre>Problem installing fixture &#39;/usr/local/django/dsbe_eupen/fixtures/d20110303u.dpy&#39;: Traceback (most recent call last):
  File &quot;/var/snapshots/django/django/core/management/commands/loaddata.py&quot;, line 174, in handle
    obj.save(using=using)
  File &quot;/var/snapshots/lino/lino/utils/dpy.py&quot;, line 246, in save
    if not self.try_save(obj,*args,**kw):
  File &quot;/var/snapshots/lino/lino/utils/dpy.py&quot;, line 292, in try_save
    dblogger.debug(&quot;Deferred %s : %s&quot;,obj2str(obj),e)
  File &quot;/var/snapshots/lino/lino/tools.py&quot;, line 95, in obj2str
    return u&quot;%s #%s (%s)&quot; % (i.__class__.__name__,i.pk,i)
  File &quot;/var/snapshots/lino/lino/modlib/properties/models.py&quot;, line 246, in __unicode__
    self.group,self.property,
  File &quot;/var/snapshots/django/django/db/models/fields/related.py&quot;, line 304, in __get__
    rel_obj = QuerySet(self.field.rel.to).using(db).get(**params)
  File &quot;/var/snapshots/django/django/db/models/query.py&quot;, line 349, in get
    % self.model._meta.object_name)
DoesNotExist: PropGroup matching query does not exist.
</pre></div>
</div>
<p>Also <cite>lino.tools.obj2str</cite> ist jetzt ein bisschen narrensicherer.</p>
<p>Und hier noch eine Überraschung.
Wenn beim <a class="reference external" href="http://www.lino-framework.org/ref/glossary.html#term-loaddata" title="(in Lino v1.6)"><span class="xref std std-term">loaddata</span></a> irgendwas nicht klappt, dann macht
<a class="reference external" href="http://www.lino-framework.org/ref/glossary.html#term-initdb" title="(in Lino v1.6)"><span class="xref std std-term">initdb</span></a> ja eine Warnung im Stil:</p>
<div class="highlight-python"><div class="highlight"><pre>WARNING Abandoning with 49 unsaved instances.
Problem installing fixture &#39;/usr/local/django/dsbe_eupen/fixtures/d20110303u.dpy&#39;: Traceback (most recent call last):
  File &quot;/var/snapshots/django/django/core/management/commands/loaddata.py&quot;, line 174, in handle
    obj.save(using=using)
  File &quot;/var/snapshots/lino/lino/utils/dpy.py&quot;, line 260, in save
    raise Exception(&quot;Abandoned with %d unsaved instances. See dblog for details.&quot; % len(save_later))
Exception: Abandoned with 49 unsaved instances. See dblog for details.
</pre></div>
</div>
<p>Also man muss die <code class="xref std std-xfile docutils literal"><span class="pre">system.log</span></code> konsultieren um zu sehen,
welches denn diese 49 Records waren.
Dumm ist dann nur, wenn in der lokalen <a class="reference external" href="http://www.lino-framework.org/ref/settings.html#setting-LOGGING" title="(in Lino v1.6)"><code class="xref std std-setting docutils literal"><span class="pre">LOGGING</span></code></a>
etwas anderes als <code class="docutils literal"><span class="pre">level='DEBUG'</span></code> stand.
Dann sieht man nämlich die Debug-Meldungen nicht.</p>
<p>Zunächst habe ich daraufhin über eine halbe Stunde gewurstelt,
damit <a class="reference external" href="http://www.lino-framework.org/ref/glossary.html#term-initdb" title="(in Lino v1.6)"><span class="xref std std-term">initdb</span></a> folgenden Test macht,
um mich vor meiner eigenen Dummheit zu schützen:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">if</span> <span class="ow">not</span> <span class="n">dblogger</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">isEnabledFor</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">):</span>
    <span class="k">raise</span> <span class="n">CommandError</span><span class="p">(</span><span class="s">&quot;System logger must be enabled for DEBUG&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Man kann dort nicht einfach nur auf <cite>dblogger.logger.level</cite> schauen,
weil die praktisch immer 0 (<code class="docutils literal"><span class="pre">UNSET</span></code>) ist. Und es hat auch keinen Zweck,
mit <cite>dblogger.logger.setLevel</cite> den level dort zu heben, weil ja schon
der root logger die Meldungen rausfängt.</p>
<p>Danach fiel mir noch ein, dass es eigentlich logischer ist,
außerdem in <a class="reference external" href="http://www.lino-framework.org/api/lino.utils.dpy.html#lino.utils.dpy.FakeDeserializedObject" title="(in Lino v1.6)"><code class="xref py py-class docutils literal"><span class="pre">lino.utils.dpy.FakeDeserializedObject</span></code></a> die
&#8220;Deferred&#8221;-Meldungen mit <cite>info</cite> statt <cite>debug</cite> zu machen.
Und den Test in <a class="reference external" href="http://www.lino-framework.org/ref/glossary.html#term-initdb" title="(in Lino v1.6)"><span class="xref std std-term">initdb</span></a> entschärfe ich dann: er braucht
nicht auf DEBUG zu stehen, wohl aber auf INFO.</p>
<p>Hier ist nun auch der Schuldige:</p>
<div class="highlight-python"><div class="highlight"><pre>201103-03 10:51:13 DEBUG dpy : Deferred PropType #1 (Bewertung) :
{&#39;choicelist&#39;: [u&quot;Value u&#39;HowWellDoYouKnow&#39; is not a valid choice.&quot;]}
</pre></div>
</div>
<p>Logisch, da waren also noch ein paar Details in der .dpy-Datei zu beachten:</p>
<div class="highlight-python"><div class="highlight"><pre>def create_properties_proptype(id,name,choicelist,limit_to_choices,multiple_choices,name_fr):
    if name_fr is None: name_fr = &#39;&#39;
    if choicelist == &#39;HowWellDoYouKnow&#39;:
        choicelist = &#39;HowWell&#39;
    return PropType(id=id,name=name,choicelist=choicelist,limit_to_choices=limit_to_choices,multiple_choices=
</pre></div>
</div>
<p>(Wenn irgendwann mal mehr Linos in der Welt rumlaufen, muss ich solche
Upgrades natürlich automatisiseren: <a class="reference external" href="https://github.com/lsaffre/lino/blob/master/docs/tickets/28">docs/tickets/28</a>.</p>
<p>Das Resultat ist jetzt richtig schön. Weil die Deferred-Meldungen
nun INFO sind, werden sie live am Bildschirm angezeigt:</p>
<div class="highlight-python"><div class="highlight"><pre>INFO Deferred PersonProperty #1 (Fachkompetenzen.Führerschein=Klasse B) : {&#39;person&#39;: [u&#39;Model person with pk 200007 does not exist.&#39;]}
INFO Deferred PersonProperty #2 (Hindernisse.Motivationsmangel=) : {&#39;person&#39;: [u&#39;Model person with pk 200007 does not exist.&#39;]}
INFO Deferred PersonProperty #3 (Fachkompetenzen.Clark-Führerschein=) : {&#39;person&#39;: [u&#39;Model person with pk 22406 does not exist.&#39;]}
INFO Deferred PersonProperty #4 (Fachkompetenzen.Führerschein=Klasse B) : {&#39;person&#39;: [u&#39;Model person with pk 22406 does not exist.&#39;]}
INFO Deferred PersonProperty #5 (Hindernisse.Juristische Probleme=) : {&#39;person&#39;: [u&#39;Model person with pk 22406 does not exist.&#39;]}
INFO Deferred PersonProperty #6 (Hindernisse.Gesundheitliche Einschränkung=) : {&#39;person&#39;: [u&#39;Model person with pk 22315 does not exist.&#39;]}
INFO Deferred PersonProperty #8 (Sozialkompetenzen.Führungsfähigkeit=gut) : {&#39;person&#39;: [u&#39;Model person with pk 200007 does not exist.&#39;]}
INFO Deferred PersonProperty #9 (Fachkompetenzen.Clark-Führerschein=) : {&#39;person&#39;: [u&#39;Model person with pk 200007 does not exist.&#39;]}
INFO Deferred PersonProperty #10 (Fachkompetenzen.Verkäufer=) : {&#39;person&#39;: [u&#39;Model person with pk 200007 does not exist.&#39;]}
INFO Deferred PersonProperty #11 (Hindernisse.Suchtprobleme=) : {&#39;person&#39;: [u&#39;Model person with pk 200007 does not exist.&#39;]}
INFO Deferred PersonProperty #12 (Hindernisse.Geistige Einschränkung=) : {&#39;person&#39;: [u&#39;Model person with pk 200007 does not exist.&#39;]}
INFO Deferred PersonProperty #13 (Fachkompetenzen.Führerschein=) : {&#39;person&#39;: [u&#39;Model person with pk 22315 does not exist.&#39;]}
INFO Deferred Unprintable Contact(pk=1,error=Person matching query does not exist. : {&#39;person&#39;: [u&#39;Model person with pk 200001 does not exist.&#39;]}
INFO Deferred Unprintable Contact(pk=3,error=Person matching query does not exist. : {&#39;person&#39;: [u&#39;Model person with pk 22314 does not exist.&#39;]}
INFO Deferred Unprintable Contact(pk=4,error=Person matching query does not exist. : {&#39;person&#39;: [u&#39;Model person with pk 200005 does not exist.&#39;]}
INFO Deferred Unprintable Contact(pk=5,error=Person matching query does not exist. : {&#39;person&#39;: [u&#39;Model person with pk 200006 does not exist.&#39;]}
</pre></div>
</div>
<p>Und <em>diese</em> Meldungen hier sind ja normal. Sie kommen daher, dass diese
Records erst in der zweiten Runde gespeichert werden können.</p>
</div>
<div class="section" id="unsterblicher-damon">
<h2>Unsterblicher Dämon ?<a class="headerlink" href="#unsterblicher-damon" title="Permalink to this headline">¶</a></h2>
<p>Noch eine Überraschung, nachdem die Daten zurückgeladen sind:
<a class="reference external" href="http://www.lino-framework.org/ref/glossary.html#term-watch-tim" title="(in Lino v1.6)"><span class="xref std std-term">watch_tim</span></a> lässt sich nicht stoppen.</p>
<p><strong class="command">ps aux | grep watch_tim</strong> meldet:</p>
<div class="highlight-python"><div class="highlight"><pre>root      3042  0.0  2.4  87216 25200 ?        S    Feb18   0:27 python /usr/local/django/dsbe_eupen/manage.py watch_tim
</pre></div>
</div>
<p>Hatte ich etwa vergessen, ihn zu stoppen? Nochmal:</p>
<div class="highlight-python"><div class="highlight"><pre>lsaffre@lino:/usr/local/django/dsbe_eupen$ ./stop
Stopped process in pidfile &#39;/usr/local/django/dsbe_eupen/watch_tim/pid&#39; (pid 3042).
Done.
Stopping web server: apache2.
</pre></div>
</div>
<p>Aber <strong class="command">ps aux | grep watch_tim</strong> meldet anschließend noch
immer genau das Gleiche.</p>
<p>Auch <strong class="command">/etc/init.d/apache2 stop</strong> meldet keinen Fehler,
wenn der Server gar nicht lief. Oder noch genauer: das Folgende
kann ich so lange spielen wie ich will:</p>
<div class="highlight-python"><div class="highlight"><pre>$ sudo /etc/init.d/apache2 stop &amp;&amp; echo $?
Stopping web server: apache2.
0
$ sudo /etc/init.d/apache2 stop &amp;&amp; echo $?
Stopping web server: apache2.
0
$ sudo /etc/init.d/apache2 stop &amp;&amp; echo $?
Stopping web server: apache2.
0
</pre></div>
</div>
<p>Das verstehe ich nicht...</p>
<p>Jetzt sehe ich wohl, dass <a class="reference external" href="http://www.lino-framework.org/ref/glossary.html#term-watch-tim" title="(in Lino v1.6)"><span class="xref std std-term">watch_tim</span></a>
noch nicht angepasst worden war an die Änderung vom <a class="reference external" href="http://www.lino-framework.org0214.html">0214</a>
(<a class="reference external" href="http://www.lino-framework.org/api/lino.utils.dblogger.html#module-lino.utils.dblogger" title="(in Lino v1.6)"><code class="xref py py-mod docutils literal"><span class="pre">lino.utils.dblogger</span></code></a> jetzt nur noch ein Wrapper
zur <code class="xref std std-xfile docutils literal"><span class="pre">system.log</span></code>).
Aber ich sehe auf Anhieb nicht, was das damit zu tun haben
sollte.</p>
<p>Aha, hier ist was:
der Auslöser scheint mal wieder das Mount zum Novell-Dateiserver
zu sein. Auch das Folgende funktioniert nicht:</p>
<div class="highlight-python"><div class="highlight"><pre>$ ls -l /mnt/oeshz_home_server
ls: reading directory /mnt/oeshz_home_server: Input/output error
total 0
</pre></div>
</div>
<p>Mit anderen Worten: <strong class="command">reboot</strong> und bis auf weiteres <em>ad acta</em> damit.
Alaaf!</p>
<p>(Check-in-Serie &#8220;20110303c&#8221;)</p>
</div>
<div class="section" id="twintriggerfield-for-foreignkeys">
<h2>TwinTriggerField for ForeignKeys<a class="headerlink" href="#twintriggerfield-for-foreignkeys" title="Permalink to this headline">¶</a></h2>
<p>Cool: ForeignKeys, die auf ein Modell verweisen, das ein Detail hat,
haben jetzt einen weiteren Trigger-Button: der erste ist der normale
Button zum Öffnen der Auswahlliste, und daneben ist ein Button
(der mit der Lupe), mit dem man direkt ins Detail des ausgewählten
Records springen kann.</p>
<p>Vorher:</p>
<a class="reference internal image-reference" href="../../_images/0303a.jpg"><img alt="../../_images/0303a.jpg" src="../../_images/0303a.jpg" style="width: 732.9px; height: 584.5px;" /></a>
<p>Nachher:</p>
<a class="reference internal image-reference" href="../../_images/0303b.jpg"><img alt="../../_images/0303b.jpg" src="../../_images/0303b.jpg" style="width: 732.9px; height: 584.5px;" /></a>
<p>Dank eines Tipps von Animal aus dem Jahre 2007
<a class="reference external" href="http://www.sencha.com/forum/showthread.php?15842-2.0-SOLVED-Combobox-twintrigger-clear&amp;p=76130&amp;viewfull=1#post76130">im ExtJS-Forum</a>
war der erste Schritt ein Kinderspiel.
Lino.TwinCombo ist eine Kombination von ComboBox und TwinTriggerField.
Anschließend kamen noch zwei Lino-spezifische Subtilitäten hinzu.
Zum Beispiel haben die Felder <cite>imode</cite>, <cite>shipping_mode</cite> und <cite>payment_term</cite>
im obigen Beispiel keinen solchen Zusatzknopf (obwohl das auch ForeignKeys
sind), weil diese Modelle
(<code class="xref py py-class docutils literal"><span class="pre">ShippingMode</span></code>, <code class="xref py py-class docutils literal"><span class="pre">InvoicingMode</span></code> und <code class="xref py py-class docutils literal"><span class="pre">PayementTerm</span></code>)
kein Detail-Fenster definiert haben.</p>
<p>(Siehe Änderungen im Check-in
<a class="reference external" href="http://code.google.com/p/lino/source/detail?r=fb8f47627b9c6907bd731fb6e635013745fceb93">20110303d</a>,
Dateien
<a class="reference external" href="https://github.com/lsaffre/lino/blob/master/lino/ui/extjs/ext_elems.py">lino/ui/extjs/ext_elems.py</a>
und <a class="reference external" href="https://github.com/lsaffre/lino/blob/master/linouiextjslinolib.js">linouiextjslinolib.js</a>)</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../index.html">
              <img class="logo" src="../../_static/logo.png" alt="Logo"/>
            </a></p>
<h3><a href="../../index.html">Table Of Contents</a></h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../index.html">Blog</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../about/index.html">About me</a></li>
</ul>

<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script><p align="center">
<a href="https://github.com/lsaffre" target="_blank">GitHub</a>
<br/><a href="http://www.lino-framework.org" target="_blank">Lino</a>
<br/><a href="http://www.saffre-rumma.net" target="_blank">Rumma & Ko</a>
</p>

        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="0304.html" title="20110304"
             >next</a> |</li>
        <li class="right" >
          <a href="0302.html" title="20110302"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Home</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Blog</a> &raquo;</li>
          <li class="nav-item nav-item-2"><a href="index.html" >2011</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2001-2015 Luc Saffre.
      Last updated on 2015-03-31.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.3.
    <a href="https://raw.github.com/lsaffre/blog/master/docs/blog/2011/0303.rst"
           rel="nofollow">Show Source</a>.
    <a href="http://luc.lino-framework.org/blog/2011/0303.html">Online Link</a>
    </div>
  </body>
</html>