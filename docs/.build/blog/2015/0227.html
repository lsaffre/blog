<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Friday, February 27, 2015 &mdash; Luc&#39;s website</title>
    
    <link rel="stylesheet" href="../../_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/centeredlogo.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/taglist.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/taglist_tags.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/sidebar.js"></script>
    <link rel="search" type="application/opensearchdescription+xml"
          title="Search within Luc&#39;s website"
          href="../../_static/opensearch.xml"/>
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
    <link rel="top" title="Luc&#39;s website" href="../../index.html" />
    <link rel="up" title="2015" href="index.html" />
    <link rel="next" title="Saturday, February 28, 2015" href="0228.html" />
    <link rel="prev" title="Thursday, February 26, 2015" href="0226.html" />
   
<script src="../../.htmldata/lightbox/js/jquery-1.11.0.min.js"></script>
<script src="../../.htmldata/lightbox/js/lightbox.min.js"></script>
<link href="../../.htmldata/lightbox/css/lightbox.css" rel="stylesheet" />

  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="0228.html" title="Saturday, February 28, 2015"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="0226.html" title="Thursday, February 26, 2015"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Home</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Blog</a> &raquo;</li>
          <li class="nav-item nav-item-2"><a href="index.html" accesskey="U">2015</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="friday-february-27-2015">
<h1>Friday, February 27, 2015<a class="headerlink" href="#friday-february-27-2015" title="Permalink to this headline">¶</a></h1>
<div class="section" id="plugin-dependence">
<h2>Plugin dependence<a class="headerlink" href="#plugin-dependence" title="Permalink to this headline">¶</a></h2>
<p>The <a class="reference external" href="http://www.lino-framework.org/api/lino.core.plugin.html#lino.core.plugin.Plugin.needs_plugins" title="(in Lino v1.6)"><code class="xref py py-attr docutils literal"><span class="pre">needs_plugins</span></code></a>
attribute is relatively new, and many dependencies are not yet managed
automatically just because I did not yet take the time to declare
them.  Now I started to make more consistent usage of this attribute
by declaring ot for two plugins:</p>
<ul class="simple">
<li><a class="reference external" href="http://www.lino-framework.org/api/lino.modlib.contacts.html#module-lino.modlib.contacts" title="(in Lino v1.6)"><code class="xref py py-mod docutils literal"><span class="pre">lino.modlib.contacts</span></code></a>  needs <a class="reference external" href="http://www.lino-framework.org/api/lino.modlib.countries.html#module-lino.modlib.countries" title="(in Lino v1.6)"><code class="xref py py-mod docutils literal"><span class="pre">lino.modlib.countries</span></code></a></li>
<li><a class="reference external" href="http://www.lino-framework.org/api/lino.modlib.cal.html#module-lino.modlib.cal" title="(in Lino v1.6)"><code class="xref py py-mod docutils literal"><span class="pre">lino.modlib.cal</span></code></a> needs <a class="reference external" href="http://www.lino-framework.org/api/lino.modlib.contenttypes.html#module-lino.modlib.contenttypes" title="(in Lino v1.6)"><code class="xref py py-mod docutils literal"><span class="pre">lino.modlib.contenttypes</span></code></a></li>
</ul>
<p>This required a little optimization: in <a class="reference external" href="http://www.lino-framework.org/api/lino.core.site.html#lino.core.site.Site" title="(in Lino v1.6)"><code class="xref py py-class docutils literal"><span class="pre">lino.core.site.Site</span></code></a>,
the <a class="reference external" href="http://www.lino-framework.org/api/lino.core.site.html#lino.core.site.Site.load_plugins" title="(in Lino v1.6)"><code class="xref py py-meth docutils literal"><span class="pre">load_plugins</span></code></a> method now
has a more natural behaviour: when a plugin requested by
<a class="reference external" href="http://www.lino-framework.org/api/lino.core.site.html#lino.core.site.Site.get_installed_apps" title="(in Lino v1.6)"><code class="xref py py-meth docutils literal"><span class="pre">get_installed_apps</span></code></a>
needs some other plugin, then this other plugin is inserted into the
resulting <a class="reference external" href="http://www.lino-framework.org/ref/settings.html#setting-INSTALLED_APPS" title="(in Lino v1.6)"><code class="xref std std-setting docutils literal"><span class="pre">INSTALLED_APPS</span></code></a> <em>before</em> the plugin who needs
it. Until now these automatically installed plugins went to the end of
the list. Which was disturbing when using the above dependencies
because the demo fixtures need to get loaded in the right order.</p>
<p>Side effect: This change requires a database dump &amp; restore because
the primary keys ContentType may have changed.</p>
<p>Another side effect : the order of some menu items in
<a class="reference external" href="http://welfare.lino-framework.org/index.html#welfare" title="(in Lino Welfare Reference Manual v1.1)"><span>Lino Welfare</span></a> changed.</p>
</div>
<div class="section" id="miscellaneous">
<h2>Miscellaneous<a class="headerlink" href="#miscellaneous" title="Permalink to this headline">¶</a></h2>
<p>I discovered that <a class="reference external" href="http://welfare.lino-framework.org/api/lino_welfare.modlib.debts.models.html#lino_welfare.modlib.debts.models.Budget" title="(in Lino Welfare Reference Manual v1.1)"><code class="xref py py-class docutils literal"><span class="pre">lino_welfare.modlib.debts.models.Budget</span></code></a> has
no CharField at all. which resulted in a strange behaviour: the quick
search did not work. Now I added an explicit
<a class="reference external" href="http://www.lino-framework.org/api/lino.core.model.html#lino.core.model.Model.quick_search_fields" title="(in Lino v1.6)"><code class="xref py py-attr docutils literal"><span class="pre">quick_search_fields</span></code></a> so that they can now
search by partner name at least:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">quick_search_fields</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;partner__name&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="section" id="new-choicelist-overlap-groups">
<h2>New choicelist &#8220;Overlap groups&#8221;<a class="headerlink" href="#new-choicelist-overlap-groups" title="Permalink to this headline">¶</a></h2>
<p>I fixed <a class="reference external" href="http://trac.lino-framework.org/ticket/104">#104</a> (Overlapping contracts are sometimes allowed),
which required a change in database structure: a new database field
<a class="reference external" href="http://welfare.lino-framework.org/api/lino_welfare.modlib.isip.mixins.html#lino_welfare.modlib.isip.mixins.ContractTypeBase.overlap_group" title="(in Lino Welfare Reference Manual v1.1)"><code class="xref py py-attr docutils literal"><span class="pre">overlap_group</span></code></a>
which points to the new choicelist <a class="reference external" href="http://welfare.lino-framework.org/api/lino_welfare.modlib.isip.choicelists.html#lino_welfare.modlib.isip.choicelists.OverlapGroups" title="(in Lino Welfare Reference Manual v1.1)"><code class="xref py py-class docutils literal"><span class="pre">isip.OverlapGroups</span></code></a>.</p>
</div>
<div class="section" id="stupid-luc">
<h2>Stupid Luc<a class="headerlink" href="#stupid-luc" title="Permalink to this headline">¶</a></h2>
<p>Oops, I noticed that yesterdy I accidentally removed some code from
<a class="reference external" href="http://welfare.lino-framework.org/api/lino_welfare.modlib.reception.models.html#module-lino_welfare.modlib.reception.models" title="(in Lino Welfare Reference Manual v1.1)"><code class="xref py py-mod docutils literal"><span class="pre">lino_welfare.modlib.reception.models</span></code></a> which was was still
used. It is an outfashioned method for getting the partner field of
cal.Guest to look like a client. The good way to do it would be to add
a setting <code class="xref py py-attr docutils literal"><span class="pre">lino.modlib.cal.Plugin.partner_model</span></code> and to set this
to <cite>pcsw.Client</cite> in <a class="reference external" href="http://welfare.lino-framework.org/index.html#welfare" title="(in Lino Welfare Reference Manual v1.1)"><span>Lino Welfare</span></a>.</p>
</div>
<div class="section" id="reception-clerk-cannot-checkin-visitors">
<h2>Reception clerk cannot checkin visitors<a class="headerlink" href="#reception-clerk-cannot-checkin-visitors" title="Permalink to this headline">¶</a></h2>
<p>This was due to the following lines in
<a class="reference external" href="http://welfare.lino-framework.org/api/lino_welfare.modlib.reception.models.html#module-lino_welfare.modlib.reception.models" title="(in Lino Welfare Reference Manual v1.1)"><code class="xref py py-mod docutils literal"><span class="pre">lino_welfare.modlib.reception.models</span></code></a>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">MyWaitingVisitors</span><span class="o">.</span><span class="n">required</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">user_groups</span><span class="o">=</span><span class="s">&#39;coaching&#39;</span><span class="p">)</span>
<span class="n">MyBusyVisitors</span><span class="o">.</span><span class="n">required</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">user_groups</span><span class="o">=</span><span class="s">&#39;coaching&#39;</span><span class="p">)</span>
<span class="n">MyGoneVisitors</span><span class="o">.</span><span class="n">required</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">user_groups</span><span class="o">=</span><span class="s">&#39;coaching&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Replaced these by usage of a new plugin setting
<a class="reference external" href="http://www.lino-framework.org/api/lino.modlib.reception.html#lino.modlib.reception.Plugin.required_user_groups" title="(in Lino v1.6)"><code class="xref py py-attr docutils literal"><span class="pre">required_user_groups</span></code></a>
for <a class="reference external" href="http://www.lino-framework.org/api/lino.modlib.reception.html#module-lino.modlib.reception" title="(in Lino v1.6)"><code class="xref py py-mod docutils literal"><span class="pre">lino.modlib.reception</span></code></a></p>
<p>Started a new tested document <a class="reference external" href="http://welfare.lino-framework.org/tested/cal.html#welfare-tested-cal" title="(in Lino Welfare Reference Manual v1.1)"><span>Calendar (tested)</span></a>. Changed
several details in the demo fixtures, but also found two optimizations
to the module:</p>
<ul class="simple">
<li><cite>cal.EventType.__unicode__</cite> now returns the <cite>event_label</cite>.</li>
<li>It is no longer allowed to close a meeting which lies in the future.</li>
</ul>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../index.html">
              <img class="logo" src="../../_static/logo.png" alt="Logo"/>
            </a></p>
<h3><a href="../../index.html">Table Of Contents</a></h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../index.html">Blog</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../about/index.html">About me</a></li>
</ul>

<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script><p align="center">
<a href="https://github.com/lsaffre" target="_blank">GitHub</a>
<br/><a href="http://www.lino-framework.org" target="_blank">Lino</a>
<br/><a href="http://www.saffre-rumma.net" target="_blank">Rumma & Ko</a>
</p>

        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="0228.html" title="Saturday, February 28, 2015"
             >next</a> |</li>
        <li class="right" >
          <a href="0226.html" title="Thursday, February 26, 2015"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Home</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Blog</a> &raquo;</li>
          <li class="nav-item nav-item-2"><a href="index.html" >2015</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2001-2015 Luc Saffre.
      Last updated on 2015-03-31.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.3.
    <a href="https://raw.github.com/lsaffre/blog/master/docs/blog/2015/0227.rst"
           rel="nofollow">Show Source</a>.
    <a href="http://luc.lino-framework.org/blog/2015/0227.html">Online Link</a>
    </div>
  </body>
</html>