<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Linux on a Compaq Presario CQ61-310EN &mdash; Luc&#39;s website</title>
    
    <link rel="stylesheet" href="../_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/centeredlogo.css" type="text/css" />
    <link rel="stylesheet" href="../_static/taglist.css" type="text/css" />
    <link rel="stylesheet" href="../_static/taglist_tags.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/sidebar.js"></script>
    <link rel="search" type="application/opensearchdescription+xml"
          title="Search within Luc&#39;s website"
          href="../_static/opensearch.xml"/>
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="top" title="Luc&#39;s website" href="../index.html" />
    <link rel="up" title="All tickets" href="all.html" />
    <link rel="next" title="Ubuntu and Estonian ID cards" href="3.html" />
    <link rel="prev" title="#1 : Thunderbird uses wrong character encoding" href="1.html" />
   
<script src="../.htmldata/lightbox/js/jquery-1.11.0.min.js"></script>
<script src="../.htmldata/lightbox/js/lightbox.min.js"></script>
<link href="../.htmldata/lightbox/css/lightbox.css" rel="stylesheet" />

  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="3.html" title="Ubuntu and Estonian ID cards"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="1.html" title="#1 : Thunderbird uses wrong character encoding"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">Home</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="index.html" >Tickets</a> &raquo;</li>
          <li class="nav-item nav-item-2"><a href="all.html" accesskey="U">All tickets</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="linux-on-a-compaq-presario-cq61-310en">
<h1>Linux on a Compaq Presario CQ61-310EN<a class="headerlink" href="#linux-on-a-compaq-presario-cq61-310en" title="Permalink to this headline">¶</a></h1>
<p>In January 2010 I bought <a class="reference internal" href="../ref/rose.html#rose"><span>Rose</span></a>, a Compaq Presario CQ61-310EN notebook
computer and spent quite some time to get Linux running on it. This
page summarizes my experiences with this machine. Disclaimer: I write
and maintain this report in my spare time. I&#8217;ve been playing with Unix
and Debian for more than 10 years, but I am mainly a software
developer and my knowlegde about hardware is rather humble.</p>
<p>I started with <em>Debian Lenny</em> and used it for a few months despite of
the low video resolution and wrong width/height ratio. I wrote a post
to <a class="reference external" href="http://www.linuxquestions.org/questions/linux-laptop-and-netbook-25/display-driver-for-my-compaq-presario-cq61-806302">LinuxQuestions.org</a>,
but never got it solved.</p>
<p>In May 2010, frustrated of not getting further with these problems, I
tried <em>Ubuntu 10.04</em>. Ubuntu solved all video problems automatically,
but I must disable certain power management features because they
cause the machine to freeze.</p>
<p>One thing still doesn&#8217;t work in August 2010:</p>
<ul class="simple">
<li>I can provocate a &#8220;non-persistent&#8221; freeze by trying to change the
<span class="guilabel">Set display brightness to</span> field in
<span class="menuselection">System ‣ Preferences ‣ Power Management</span>. This
freezes the machine instantly: SysRq or switching to a text terminal
using Ctrl-Alt-F1 don&#8217;t work, only a hard reset does.</li>
</ul>
<div class="section" id="persistent-freezes">
<h2>Persistent freezes<a class="headerlink" href="#persistent-freezes" title="Permalink to this headline">¶</a></h2>
<p>Until July 2010 I had &#8220;persistent&#8221; freezes: Once they were there, they
happened on each startup, shortly after the Ubuntu logo and the mouse
cursor is displayed. They would stop only after executing &#8220;Restore
setup defaults&#8221; in the BIOS setup menu (independently of whether there
were manual BIOS changes or not). I guess that something wrote some
buggy information into the BIOS.</p>
<p>The following phenomens stopped suddenly in August 2010, probably
after a routine upgrade:</p>
<ul class="simple">
<li>When I shut down normally (using the Gnome menu command or using the
<code class="docutils literal"><span class="pre">halt</span></code> command), everything is okay. But when I shut down by
pressing the power button (and choosing &#8220;shutdown&#8221; in the menu),
then a persistent freeze starts.</li>
<li>Persistent freezes seem to be related to the settings specified in
<span class="menuselection">System ‣ Preferences ‣ Power Management</span>, the
<span class="guilabel">When laptop lid is closed</span> option has 4 choices:<ul>
<li>blank screen : works well.</li>
<li>suspend : after reopening the lid it asks for the password and
continues to work, but the monitor remains dimmed. When I later
shut down the machine (even normally), then it will freeze on each
startup attempt until I do a BIOS reset.</li>
<li>hibernate : after reopening the lid and pushing the power button,
it asks for the password and continues to work, but (same
situation as after suspend).</li>
<li>shutdown : when i close the lid, it shuts down correctly... but
afterwards it will freeze persistently.</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="historic-notes">
<h2>Historic notes<a class="headerlink" href="#historic-notes" title="Permalink to this headline">¶</a></h2>
<p>This problem is rather complex, and it&#8217;s funny to see how quickly my
own problem descriptions get obsolote...</p>
<p>Before I knew the BIOS reset trick, at some moment I had disabled the &#8220;Fan Always On&#8221; BIOS option, and after this the computer started to freeze systematically after less than 30 seconds. <a class="reference external" href="http://forum.ubuntuusers.de/topic/live-cd-funktioniert-installierte-version-fri/">ubuntuusers.de</a> advised to do a BIOS reset. This helped, and so I believed that the freezes have to do with this option. The BIOS reset helped just because it fixed the buggy BIOS information.</p>
<p>Once I wrote:</p>
<blockquote>
<div><ul class="simple">
<li>When I run Ubunto from LiveCD (using the &#8220;Try Ubuntu 10.04 LTS&#8221; button), everything works fine. No problems.</li>
<li>When I install Ubunto to the hard disk (taking the full space), the installation works well and smoothly (except for the <a class="reference external" href="https://wiki.ubuntu.com/LucidLynx/ReleaseNotes#I/O%20error%20after%20CD%20is%20ejected%20at%20end%20of%20install">small problem mentioned in the release notes</a>), but after restarting I have a &#8220;boot failure without message&#8221; as described in my post to <a class="reference external" href="http://ubuntuforums.org/showthread.php?p=9394135#post9394135">ubuntuforums.org</a>.</li>
<li>When I press F6 while booting from the CD and choose &#8220;Boot from first hard disk&#8221;, then it goes further, X starts and the login screen appears (or even the desktop if i chose &#8220;automatic login&#8221; during previous install), but also here the machine freezes after a short time (10 to 60 seconds).</li>
</ul>
<p>I tried the following boot options without any success:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">acpi</span><span class="o">=</span><span class="n">off</span>
<span class="n">all_generic_ide</span>
<span class="n">hpet</span><span class="o">=</span><span class="n">force</span>
<span class="n">noapm</span>
<span class="n">pci</span><span class="o">=</span><span class="n">nomsi</span>
</pre></div>
</div>
<p>I ran the memory and hard disk test utilities provided on the Ubuntu CD: they detected no problem.
I also ran the memory and hard disk self test provided by the BIOS. Again no problem.</p>
<p>When I manage to log in before the freeze occurs, then I get the following message in a GUI window which I try to reproduce here:</p>
<div class="highlight-python"><div class="highlight"><pre>A program is still running:
 Power Manager
  Not responding

Waiting for program to finish.
Interrupting program may cause you to
lose work
[Lock Screen] [Cancel] [Logout anyway]
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="debian">
<h2>Debian<a class="headerlink" href="#debian" title="Permalink to this headline">¶</a></h2>
<p>Here is how I described the situation on Debian Lenny shortly before I changed to Ubuntu:</p>
<p>It works quite well, but doesn&#8217;t autodetect a correct video driver: the highest screen resolution offered is 1024x768, which looks distorted on the wide monitor. I can watch videos on YouTube, but the quality is really bad.</p>
<p>It took me some time to understand that my notebook has an ATI controller.</p>
<p>My <cite>/etc/X11/xconf.org</cite> contains only:</p>
<div class="highlight-python"><div class="highlight"><pre>Section &quot;InputDevice&quot;
        Identifier      &quot;Generic Keyboard&quot;
        Driver          &quot;kbd&quot;
        Option          &quot;XkbRules&quot;      &quot;xorg&quot;
        Option          &quot;XkbModel&quot;      &quot;pc105&quot;
        Option          &quot;XkbLayout&quot;     &quot;ee&quot;
EndSection

Section &quot;InputDevice&quot;
        Identifier      &quot;Configured Mouse&quot;
        Driver          &quot;mouse&quot;
EndSection

Section &quot;Device&quot;
        Identifier      &quot;Configured Video Device&quot;
EndSection

Section &quot;Monitor&quot;
        Identifier      &quot;Configured Monitor&quot;
EndSection

Section &quot;Screen&quot;
        Identifier      &quot;Default Screen&quot;
        Monitor         &quot;Configured Monitor&quot;
EndSection
</pre></div>
</div>
<p>Here are some more diagnostics:</p>
<div class="highlight-python"><div class="highlight"><pre>rose:~# lshw -class video
  *-display UNCLAIMED
       description: VGA compatible controller
       product: ATI Technologies Inc
       vendor: ATI Technologies Inc
       physical id: 5
       bus info: pci@0000:01:05.0
       version: 00
       width: 32 bits
       clock: 33MHz
       capabilities: pm msi vga_controller bus_master cap_list
       configuration: latency=0
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>rose:~# hwinfo --gfxcard
11: PCI 105.0: 0300 VGA compatible controller (VGA)
  [Created at pci.310]
  UDI: /org/freedesktop/Hal/devices/pci_1002_9712
  Unique ID: ul7N.hoF65UtRFT7
  Parent ID: vSkL.Wwwe8lyjkRE
  SysFS ID: /devices/pci0000:00/0000:00:01.0/0000:01:05.0
  SysFS BusID: 0000:01:05.0
  Hardware Class: graphics card
  Model: &quot;ATI VGA compatible controller&quot;
  Vendor: pci 0x1002 &quot;ATI Technologies Inc&quot;
  Device: pci 0x9712
  SubVendor: pci 0x103c &quot;Hewlett-Packard Company&quot;
  SubDevice: pci 0x363f
  Memory Range: 0x80000000-0x8fffffff (rw,prefetchable)
  I/O Ports: 0x3000-0x3fff (rw)
  Memory Range: 0x90300000-0x9030ffff (rw,non-prefetchable)
  Memory Range: 0x90200000-0x902fffff (rw,non-prefetchable)
  IRQ: 10 (no events)
  I/O Ports: 0x3c0-0x3df (rw)
  Module Alias: &quot;pci:v00001002d00009712sv0000103Csd0000363Fbc03sc00i00&quot;
  Config Status: cfg=new, avail=yes, need=no, active=unknown
  Attached to: #30 (PCI bridge)
Primary display adapter: #11
</pre></div>
</div>
<p>According to <a class="reference external" href="http://wiki.debianforum.de/AtiTreiberInstallation">http://wiki.debianforum.de/AtiTreiberInstallation</a> or
<a class="reference external" href="http://www.debianhelp.org/node/9347">http://www.debianhelp.org/node/9347</a>, I must download these drivers from
<a class="reference external" href="http://support.amd.com/us/gpudownload/Pages/index.aspx">http://support.amd.com/us/gpudownload/Pages/index.aspx</a></p>
<p>But which one to choose there? The only answer I could imagine was &#8220;Linux x86&#8221; / &#8220;Notebook&#8221; / &#8220;HP&#8221;, which lead to a statement:</p>
<blockquote>
<div><p>Advisory:
The display driver supplied by the laptop manufacturer is customized for the
built-in flat panel display, and the graphics features and functions specific to the
laptop. It is strongly recommended to use the supplied drivers.</p>
<p>If installing a different operating system other than the one included with the laptop,
the laptop may not meet all the requirements, and supported drivers may not be
available.</p>
<p>The laptop manufacturer is the exclusive provider of driver updates.  If the required
driver update is not available at the laptop manufacturers’ website, it is recommended
to contact the manufacturer directly, to see if an updated driver will be made
available in the future.</p>
<p>AMD cannot provide driver updates directly from AMD.com.</p>
<p>AMD has provided a list of the major laptop manufacturers and corresponding support
websites below for your convenience.</p>
</div></blockquote>
<p>(They also asked &#8220;What can we do to improve this information?&#8221;, which I answered with &#8220;Provide useful information for Linux users who are trying to find a driver for your product.&#8221;)</p>
<p>They then link me to <a class="reference external" href="http://welcome.hp.com/country/us/en/support.html">http://welcome.hp.com/country/us/en/support.html</a></p>
<p>HP asks me for the product number, then &#8220;Which operating system is used with your product?&#8221;. There are 6 possible answers, all starting with &#8220;Microsoft Windows&#8221;.
And then the laconic explanation:</p>
<blockquote>
<div>Don&#8217;t see your operating system?
If your operating system is not listed above, HP does not have software or driver
downloads available for this product in that operating system.</div></blockquote>
</div>
<div class="section" id="the-compaq-presario-cq61">
<h2>The Compaq Presario CQ61<a class="headerlink" href="#the-compaq-presario-cq61" title="Permalink to this headline">¶</a></h2>
<p>Overview:</p>
<blockquote>
<div><ul class="simple">
<li>Product Number: VJ539EA#B1R</li>
<li>System Board ID : 363F</li>
<li>Processor Type : AMD Sempron(tm) M100</li>
<li>Processor Speed : 2000 MHz</li>
<li>Total Memory : 2048 MB</li>
<li>BIOS Version F.07</li>
<li>BIOS Vendor : Insyde</li>
<li>Factory installed OS : non Vista</li>
</ul>
</div></blockquote>
<p>By pressing Escape shortly after switching power on, I can start the
BIOS setup menu (<a class="reference external" href="http://www.insydesw.com/products/products-efi-h2o.htm">InsydeH20 Setup utility</a> Rev 3.5):</p>
<blockquote>
<div><ul class="simple">
<li>Main<ul>
<li>Sytem time &amp; date</li>
<li>Diagnostics log</li>
<li>(as well as the system information mentioned above)</li>
</ul>
</li>
<li>Security<ul>
<li>Admininstrator password</li>
<li>Power-on password</li>
</ul>
</li>
<li>Diagnostics<ul>
<li>Primary Hard Disk Self Test</li>
<li>Memory test</li>
</ul>
</li>
<li>System Configuration<ul>
<li>Language : English</li>
<li>Virtualization Technology : disabled</li>
<li>Fan Always On : disabled</li>
<li>Boot options:<ul>
<li>POST Hotkey Delay : 0 secs</li>
<li>CD-ROM Boot : enabled</li>
<li>Floppy boot : disabled</li>
<li>Internal Network Adapter Boot : disabled</li>
<li>Boot order :<ul>
<li>Internal CD/DVD ROM Drive</li>
<li>Notebook Hard Drive</li>
<li>USB Diskette on Key/USB Hard Disk</li>
<li>USB CD/DVD ROM Drive</li>
<li>! USB Floppy</li>
<li>! Network Adapter</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>Exit</li>
</ul>
</div></blockquote>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../index.html">
              <img class="logo" src="../_static/logo.png" alt="Logo"/>
            </a></p>
<h3><a href="../index.html">Table Of Contents</a></h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../blog/index.html">Blog</a></li>
<li class="toctree-l1"><a class="reference internal" href="../about/index.html">About me</a></li>
</ul>

<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script><p align="center">
<a href="https://github.com/lsaffre" target="_blank">GitHub</a>
<br/><a href="http://www.lino-framework.org" target="_blank">Lino</a>
<br/><a href="http://www.saffre-rumma.net" target="_blank">Rumma & Ko</a>
</p>

        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="3.html" title="Ubuntu and Estonian ID cards"
             >next</a> |</li>
        <li class="right" >
          <a href="1.html" title="#1 : Thunderbird uses wrong character encoding"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">Home</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="index.html" >Tickets</a> &raquo;</li>
          <li class="nav-item nav-item-2"><a href="all.html" >All tickets</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2001-2015 Luc Saffre.
      Last updated on 2015-03-31.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.3.
    <a href="https://raw.github.com/lsaffre/blog/master/docs/tickets/2.rst"
           rel="nofollow">Show Source</a>.
    <a href="http://luc.lino-framework.org/tickets/2.html">Online Link</a>
    </div>
  </body>
</html>